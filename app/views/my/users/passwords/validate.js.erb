if (MySublimeVideo.passwordCheckerManager) {
  <% if @valid_password %>
    var password_input = new Element('input', {
                                                type:  'password',
                                                name:  'user[current_password]',
                                                value: "<%= params[:password] %>",
                                                style: "display:none"
                                              });
    if (/\/sites/.test(MySublimeVideo.passwordCheckerManager.originForm.action)) {
      password_input.name = "site[user_attributes][current_password]";
    }

    MySublimeVideo.passwordCheckerManager.originForm.insert({
      bottom: password_input
    });
    MySublimeVideo.popupHandler.close();
    MySublimeVideo.passwordCheckerManager.originForm.submit();

  <% else %>
    MySublimeVideo.passwordCheckerManager.popup.setStyle({
      background: '#f00'
    });
    MySublimeVideo.passwordCheckerManager.popup.shake();
    $('password_check').clear();
  <% end %>
}
