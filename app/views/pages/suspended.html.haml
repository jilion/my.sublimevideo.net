= title_and_content_header("Your account is suspended")

- failed_invoices = current_user.invoices.failed
- if failed_invoices.empty? && current_user.failed_invoices_count_on_suspend > 0
  %h3.section_title{ :style => "color:green;" }= "Your account will be re-activated"
  %p= t("user.will_be_reactivated")
- elsif failed_invoices.present? && failed_invoices.all? { |invoice| invoice.will_be_charged? }
  %h3.section_title{ :style => "color:orange;" }= "Charging in progress"
  %p= t("user.failed_invoices_are_being_processed")
  
%h3.section_title= "Suspension reason"
- if current_user.failed_invoices_count_on_suspend > 0
  = "Your account has been suspended because you have #{t('failed_invoices', :count => current_user.failed_invoices_count_on_suspend)}."
- else
  = "Unknown reason."
  = raw t("please_link_to_know_more_about_it", :link => link_to("contact us", new_ticket_path))
  
#credit_card_summary
  %h3.section_title= "Your credit card info"
  - if current_user.cc_expired?
    %span{ :style => "color:red;" }= t("user.credit_card.expired")
  %p{ :class => current_user.cc_type }
    = raw "#{t("user.credit_card.type.#{current_user.cc_type}")} ending in #{content_tag(:strong, current_user.cc_last_digits)}"
    = link_to edit_credit_card_path do
      %strong= "Change credit card"
      
- if failed_invoices.present?
  %h3.section_title= "Your Failed Invoices"
  #failed_invoices
    = t("user.have_to_pay_following_invoices")
    %ul
      - failed_invoices.each do |invoice|
        %li
          = link_to "#{invoice_dates(invoice)} - #{charging_status(invoice)}", invoice_path(invoice)
          - if !invoice.will_be_charged? && !current_user.cc_expired?
            = form_for invoice, :url => pay_invoice_path(invoice), :html => { :method => 'post', "data-password-protected" => true } do |f|
              .entry.update
                = f.submit "Pay the #{invoice_dates(invoice)} invoice"