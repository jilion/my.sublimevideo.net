= title_and_content_header("Edit My Account")

- if current_user.credit_card?
  #credit_card_summary
    %h3.section_title= "Billing Info"
    %p{ :class => current_user.cc_type }<
      = raw "#{t("user.credit_card.type.#{current_user.cc_type}")} ending in #{content_tag(:strong, current_user.cc_last_digits)}"
      = link_to 'Change credit card', edit_credit_card_path
      
  #current_usage
    %h3.section_title= "Current Usage"
    %p#current_usage_amount
      = "Calculating current usage..."
      
- if current_user.invoices.present?
  #past_invoices
    %h3.section_title= "Past invoices"
    %ul
      - current_user.invoices.each do |invoice|
        %li= link_to "#{invoice_dates(invoice)} - #{charging_status(invoice)}", invoice_path(invoice)
        
= render 'users/form'
.spacer

= form_for @user, :url => "/account/credentials", :html => { :method => :put, :class => "main_form", :id => "edit_credentials", "data-password-protected" => true } do |f|
  %h3.section_title= "Email & Password"
  .entry.email
    = f.label :email, "", :class => "icon"
    = f.email_field :email, :class => "text", :placeholder => "Email", :required => true
  %p.note= "Leave blank if you don't want to change it"
  .entry.password
    = f.label :password, "", :class => "icon"
    = f.password_field :password, :class => "text show_password", :placeholder => "New password", :autocomplete => "off"
    
  #current_password_wrap{ :style => (@user.errors[:current_password].empty? ? "display:none;" : "") }
    %p.note= "We need your current password to confirm your changes"
    .entry.password
      = f.label :current_password, "", :class => "icon"
      = f.password_field :current_password, :class => "text show_password", :placeholder => "Current password", :required => true
    
  .entry.update
    = f.submit "Update", :class => "submit small", :id => "user_credentials_submit"
.spacer

= render 'users/email_notifications_form'

-# %h3 Cancel my account
-# 
-# %p
-#   = "Unhappy? #{link_to "Cancel my account", registration_path(resource_name), :confirm => "Are you sure?", :method => :delete}."