%tr{ :id => dom_id(site), :class => cycle("", "alt") }
  %td.site{ :class => site.hostname.present? ? "has_domain" : "empty"}
    .wrap
      - if site.hostname.present?
        -# TODO: Remove condition when no more site in beta state and remove if production on default icon for favicon
        = link_to [:edit, site], :class => "domain", :title => "Edit #{hostname_with_path(site)}" do
          %span.settings_icon
          = image_tag "https://getfavicon.appspot.com/http://#{hostname_with_path(site)}?defaulticon=http://#{hostname_with_path(site)}/favicon.ico", :onerror => "this.src='/images/embed/sites/default_favicon.png';", :alt => "Favicon", :size => "16x16", :id => "site_favicon_#{site.id}"
          = truncate_middle(site.hostname, :length => 35)
        - if site.need_path?
          .warning.box_hovering_zone
            = link_to [:edit, site], :class => "icon" do
              %span= "warning"
            = info_box do
              %p
                %em= "You should probably add a path to restrict the validity of the player to your site, not on the whole domain."
      - else
        = link_to [:edit, site], :class => "domain" do
          %span.settings_icon
          = "add a hostname"
      .plan
        - if site.plan_id?
          = link_to [:edit, site, :plan] do
            = site.plan.title
            - if site.next_cycle_plan_id?
              %span.disabled= " => #{site.next_cycle_plan.title}"
      .cycle
        - if site.in_paid_plan?
          = l(site.plan_cycle_started_at, :format => :d_b_Y) + ' - ' + l(site.plan_cycle_ended_at, :format => :d_b_Y)
      .spacer

  %td.usage{ :class => td_usage_class(site) }
    - if site.plan_id?
      = render 'td_usage', site: site
    - else
      = "—"

  %td.code
    - if site.plan_id?
      = link_to "Embed code", "", :class => "embed_code", :onclick => "return MySublimeVideo.showSiteEmbedCode('#{site.token}')"
    - else
      = "—"

  %td.status.box_hovering_zone
    .wrap
      - if site.invoices_failed? # TODO: Handle case when the transaction is in the "waiting_d3d" state
        = link_to [site, :invoices] do
          %span.icon.payment_issue
          = info_box do
            %p=t 'site.status.payment_issue'
      - else
        - if site.cdn_up_to_date?
          %span.icon.ok
          = info_box do
            %p=t 'site.status.ok'
        - else
          %span.icon.in_progress
          = info_box do
            %p=t 'site.status.in_progress'
          .completed{ style: "display:none;" }
            %span.icon.ok
            = info_box do
              %p=t 'site.status.ok'
