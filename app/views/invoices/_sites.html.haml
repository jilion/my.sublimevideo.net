- invoice_items_grouped_by_site(invoice).each do |site, invoice_items|
  %h3= "#{site.hostname} (token: #{site.token})"
  
  - plan_invoice_item    = get_plan_invoice_item(invoice_items)
  - overage_invoice_item = get_overage_invoice_item(invoice_items)
  - addons_invoice_items = get_addons_invoice_items_grouped_by_item(invoice_items)
  
  = render 'plan_invoice_item', :plan_invoice_item => plan_invoice_item
  
  = render('overage_invoice_item', :overage_invoice_item => overage_invoice_item) if overage_invoice_item.amount > 0
  
  - if addons_invoice_items.present?
    %h4 Add-ons
    - addons_invoice_items.each do |addon, addon_invoice_items|
      %h4= addon.name.humanize
      = render :partial => 'addon_invoice_item', :collection => addon_invoice_items
      
  %table{ :border => 2 }
    %tr
      %td{ :colspan => 2 } Total
      %td= number_to_currency((plan_invoice_item.amount + overage_invoice_item.amount + addons_invoice_items.sum(&:amount)) / 100.0)
      
  %hr