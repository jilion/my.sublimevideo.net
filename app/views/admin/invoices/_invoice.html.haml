%tr[invoice]{ class: cycle("", "alt") }
  %td.id
    %small= link_to "##{invoice.id}", [:admin, invoice]

  %td.reference
    %small= link_to invoice.reference, [:admin, invoice]

  %td.user
    %small
      = link_to invoice.user.name_or_email, [:admin, invoice.user], title: invoice.user.email
      - if invoice.user.beta?
        = "("
        = "beta" if invoice.user.beta?
        = "#{', ' if invoice.user.beta?}archived" if invoice.user.archived?
        = ")"

  %td.site
    %small
      = links_to_hostnames(invoice.site)
      = "(#{invoice.site.state})" unless invoice.site.active?

  %td.period
    %small
      - if invoice.paid_at
        = "Paid: #{display_time(invoice.paid_at)}"
        = ", Refund. #{display_time(invoice.site.refunded_at)}" if invoice.refunded?
      - elsif invoice.canceled?
        = "Canceled"
      - elsif invoice.last_failed_at
        = "Failed: #{display_time(invoice.last_failed_at)}"
      - else
        = "Created: #{display_time(invoice.created_at)}"

  %td.invoice_items_count
    %small
      %strong
        - if invoice.invoice_items_count > 1
          = "Upgrade"
        - elsif invoice.renew
          = "Renew"
        - else
          = "New"
      = "/ #{invoice.paid_plan.cycle}"

  %td.amount
    %small= display_amount(invoice.amount)

  %td.state
    %small
      - case invoice.state
      - when "open", "waiting", "canceled", "refunded"
        %span{ style: "color:orange" }= invoice.state
      - when "failed"
        %strong{ style: "color:red" }= 'failed'
      - when "paid"
        %span{ style: "color:green" }= invoice.refunded? ? 'refunded' : 'paid'
