<%
stats_from = 2.months.ago.beginning_of_day
interval   = 1.day
max_zoom   = 3.days
%>
<script type = "text/javascript" charset="utf-8">
  document.observe("dom:loaded", function() {
    var chart = new Highcharts.Chart({
      chart: {
        renderTo: 'chart',
        defaultSeriesType: 'area',
        zoomType: 'x'
      },
      title: {
        text: 'Video pageviews per day'
      },
      subtitle: {
        text: ''
      },
      xAxis: {
        type: 'datetime',
        maxZoom: <%= max_zoom * 1000 %>,
      },
      yAxis: {
        title: {
          text: 'Video pageviews',
          min: 0,
          startOnTick: false,
          showFirstLabel: false,
          margin: 70
        },
        labels: {
          formatter: function() {
            return Highcharts.numberFormat(this.value, 0, '.', "'");
          }
        }
      },
      tooltip: {
        formatter: function() {
          return Highcharts.dateFormat("%e. %b %y", this.x) + ': ' + Highcharts.numberFormat(this.y, 0);
        }
      },
      series: [
        {
          name: 'Video pageviews per day',
          pointInterval: <%= interval * 1000 %>,
          pointStart: <%= stats_from.to_i * 1000 %>,
          data: <%= Stat::Global.video_pageviews_per_day(start_time)(stats_from).map { |vpvpd| vpvpd.vpv["new"] } %>
        }
      ],
      plotOptions: {
        area: {
          // fillColor: {
          //   linearGradient: [0, 0, 0, 300],
          //   stops: [[0, 'rgba(0,2,0,0)'], [1, 'rgba(2,0,0,0)']]
          // },
          fillColor: "#405f92",
          lineColor: "#5d6778",
          lineWidth: 3,
          // showCheckbox: true,
          marker: {
            lineWidth: 1,
            enabled: false,
            symbol: 'circle',
            radius: 3,
            states: {
              hover: {
                enabled: true
              }
            }
          }
        }
      },
      credits: {
        enabled: true,
        text: "Generation time: <%= Time.now.to_s(:format => :fully_full) %> / Copyright © <%= Date.today.year %> - SublimeVideo®",
        href: "http://sublimevideo.net"
      }
    });
    // chart.showLoading();
  });
</script>
