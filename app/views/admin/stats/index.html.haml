- title("Statistics")
:coffeescript
  $(document).ready ->
    selectedPeriod = #{@selected_period.to_json}
    selectedSeries = #{@selected_series.to_json}
    selectedSeriesString = _.map(selectedSeries, (selectedSerie) -> selectedSerie.join('.'))
    window.AdminSublimeVideo.stats = {}
    window.AdminSublimeVideo.statsRouter = new AdminSublimeVideo.Routers.StatsRouter
      selectedPeriod: selectedPeriod
      selectedSeries: selectedSeries

    $('a.selector').each () ->
      if _.any(selectedSeriesString, (selectedSerieString) => selectedSerieString is $(this).data('value'))
        $(this).addClass('active')

%h2#page_title

.stats
  #dates_range
    %h3#time_range_title
    #date_pickers

  .spacer

  %ul#period_selectors
    %li.all
      %a{ href: '#' } All
    %li.years-1
      %a{ href: '#' } 1 Year
    %li.months-6
      %a{ href: '#' } 6 Months
    %li.months-3
      %a{ href: '#' } 3 Months
    %li.days-30
      %a{ href: '#' } 30 Days
    %li.days-7
      %a{ href: '#' } 7 Days

  .spacer

  #chart{ style: "height:400px" }

  .spacer

  %p
    %small Tip: Press 'r' to reset the graph!

  #series_selectors
    %table
      %tr
        %td.sales
          %h2 Sales
          %ul
            %li
              %a.title.selector{ href: "?sales.total", data: { value: 'sales.total' }, title: "All sales (new & renew subscriptions)" } Total
              %ul
                %li
                  %a.selector{ href: "?sales.ne", data: { value: 'sales.ne' }, title: "Revenue from new subscriptions" } New
                  %ul
                    %li
                      %a.selector{ href: "?sales.ne.plus", data: { value: 'sales.ne.plus' }, title: "Revenue from new Plus plan subscriptions" } Plus
                    %li
                      %a.selector{ href: "?sales.ne.premium", data: { value: 'sales.ne.premium' }, title: "Revenue from new Premium plan subscriptions" } Premium
                    %li
                      %a.selector{ href: "?sales.ne.comet", data: { value: 'sales.ne.comet' }, title: "Revenue from new Comet plan subscriptions" } Comet
                    %li
                      %a.selector{ href: "?sales.ne.planet", data: { value: 'sales.ne.planet' }, title: "Revenue from new Planet plan subscriptions" } Planet
                    - Addon.with_paid_plans.each do |addon|
                      %li
                        %a.selector{ href: "?sales.ne.#{addon.name}", data: { value: "sales.ne.#{addon.name}" }, title: "Revenue from new #{addon.title} add-on subscriptions" }= addon.title
                        %ul
                          - addon.plans.paid.each do |addon_plan|
                            %li
                              %a.selector{ href: "?sales.ne.#{addon.name}.#{addon_plan.name}", data: { value: "sales.ne.#{addon.name}.#{addon_plan.name}" }, title: "Revenue from new #{addon_plan.title} add-on plan subscriptions" }= addon_plan.title
                %li
                  %a.selector{ href: "?sales.re", data: { value: 'sales.re' }, title: "Revenue from renewed subscriptions" } Renew
                  %ul
                    %li
                      %a.selector{ href: "?sales.re.plus", data: { value: 'sales.re.plus' }, title: "Revenue from renewed Plus plan subscriptions" } Plus
                    %li
                      %a.selector{ href: "?sales.re.premium", data: { value: 'sales.re.premium' }, title: "Revenue from renewed Premium plan subscriptions" } Premium
                    %li
                      %a.selector{ href: "?sales.re.comet", data: { value: 'sales.re.comet' }, title: "Revenue from renewed Comet plan subscriptions" } Comet
                    %li
                      %a.selector{ href: "?sales.re.planet", data: { value: 'sales.re.planet' }, title: "Revenue from renewed Planet plan subscriptions" } Planet
                    - Addon.with_paid_plans.each do |addon|
                      %li
                        %a.selector{ href: "?sales.re.#{addon.name}", data: { value: "sales.re.#{addon.name}" }, title: "Revenue from renewed #{addon.title} add-on subscriptions" }= addon.title
                        %ul
                          - addon.plans.paid.each do |addon_plan|
                            %li
                              %a.selector{ href: "?sales.re.#{addon.name}.#{addon_plan.name}", data: { value: "sales.re.#{addon.name}.#{addon_plan.name}" }, title: "Revenue from renewed #{addon_plan.title} add-on plan subscriptions" }= addon_plan.title

        %td.billable_items
          %h2 Billable items
          %ul
            %li
              %a.selector{ href: "?billable_items.be", data: { value: 'billable_items.be' }, title: "Beta billable items" } Beta
              %ul
                - App::Design.paid.each do |design|
                  %li
                    %a.selector{ href: "?billable_items.be.design.#{design.name}", title: "#{design.title} design in beta", data: { value: "billable_items.be.design.#{design.name}" } }= "[Design] #{design.title}"
                - Addon.public.visible.each do |addon|
                  %li
                    %a.selector{ href: "?billable_items.be.#{addon.name}", title: "#{addon.title} add-on in beta", data: { value: "billable_items.be.#{addon.name}" } }= addon.title
                    %ul
                      - addon.plans.includes(:addon).order(:price).each do |addon_plan|
                        %li
                          %a.selector{ href: "?billable_items.be.#{addon.name}.#{addon_plan.name}", title: "#{addon_plan.addon.title}/#{addon_plan.title} add-on in beta", data: { value: "billable_items.be.#{addon.name}.#{addon_plan.name}" } }= addon_plan.title
            %li
              %a.selector{ href: "?billable_items.tr", data: { value: 'billable_items.tr' }, title: "Trial billable items" } Trial
              %ul
                - App::Design.paid.each do |design|
                  %li
                    %a.selector{ href: "?billable_items.tr.design.#{design.name}", title: "#{design.title} design in trial", data: { value: "billable_items.tr.design.#{design.name}" } }= "[Design] #{design.title}"
                - Addon.public.visible.each do |addon|
                  %li
                    %a.selector{ href: "?billable_items.tr.#{addon.name}", title: "#{addon.title} add-on in trial", data: { value: "billable_items.tr.#{addon.name}" } }= addon.title
                    %ul
                      - addon.plans.order(:price).each do |addon_plan|
                        %li
                          %a.selector{ href: "?billable_items.tr.#{addon.name}.#{addon_plan.name}", title: "#{addon_plan.addon.title}/#{addon_plan.title} add-on in trial", data: { value: "billable_items.tr.#{addon.name}.#{addon_plan.name}" } }= addon_plan.title
            %li
              %a.selector{ href: "?billable_items.sb", data: { value: 'billable_items.sb' }, title: "Subscribed billable items" } Subscribed
              %ul
                - App::Design.paid.each do |design|
                  %li
                    %a.selector{ href: "?billable_items.sb.design.#{design.name}", title: "#{design.title} design subscribed", data: { value: "billable_items.sb.design.#{design.name}" } }= "[Design] #{design.title}"
                - Addon.public.visible.each do |addon|
                  %li
                    %a.selector{ href: "?billable_items.sb.#{addon.name}", title: "#{addon.title} add-on subscribed", data: { value: "billable_items.sb.#{addon.name}" } }= addon.title
                    %ul
                      - addon.plans.order(:price).each do |addon_plan|
                        %li
                          %a.selector{ href: "?billable_items.sb.#{addon.name}.#{addon_plan.name}", title: "#{addon_plan.addon.title}/#{addon_plan.title} add-on subscribed", data: { value: "billable_items.sb.#{addon.name}.#{addon_plan.name}" } }= addon_plan.title
            %li
              %a.selector{ href: "?billable_items.sp", data: { value: 'billable_items.sp' }, title: "Sponsored billable items" } Sponsored
              %ul
                - App::Design.paid.each do |design|
                  %li
                    %a.selector{ href: "?billable_items.sp.design.#{design.name}", title: "#{design.title} design sponsored", data: { value: "billable_items.sp.design.#{design.name}" } }= "[Design] #{design.title}"
                - Addon.public.visible.each do |addon|
                  %li
                    %a.selector{ href: "?billable_items.sp.#{addon.name}", title: "#{addon.title} add-on sponsored", data: { value: "billable_items.sp.#{addon.name}" } }= addon.title
                    %ul
                      - addon.plans.order(:price).each do |addon_plan|
                        %li
                          %a.selector{ href: "?billable_items.sp.#{addon.name}.#{addon_plan.name}", title: "#{addon_plan.addon.title}/#{addon_plan.title} add-on sponsored", data: { value: "billable_items.sp.#{addon.name}.#{addon_plan.name}" } }= addon_plan.title
            %li
              %a.selector{ href: "?billable_items.su", data: { value: 'billable_items.su' }, title: "Suspended billable items" } Suspended
              %ul
                - App::Design.paid.each do |design|
                  %li
                    %a.selector{ href: "?billable_items.su.design.#{design.name}", title: "#{design.title} design suspended", data: { value: "billable_items.su.design.#{design.name}" } }= "[Design] #{design.title}"
                - Addon.public.visible.each do |addon|
                  %li
                    %a.selector{ href: "?billable_items.su.#{addon.name}", title: "#{addon.title} add-on suspended", data: { value: "billable_items.su.#{addon.name}" } }= addon.title
                    %ul
                      - addon.plans.order(:price).each do |addon_plan|
                        %li
                          %a.selector{ href: "?billable_items.su.#{addon.name}.#{addon_plan.name}", title: "#{addon_plan.addon.title}/#{addon_plan.title} add-on suspended", data: { value: "billable_items.su.#{addon.name}.#{addon_plan.name}" } }= addon_plan.title

        %td.users
          %h2 Users
          %ul
            %li
              %a.title.selector{ href: "?users.active", data: { value: 'users.active' }, title: "Beta users, users with no paying sites and users with at least 1 paying sites" } Active
              %ul
                %li
                  %a.selector{ href: "?users.be", data: { value: 'users.be' }, title: "Beta users" } Beta
                %li
                  %a.selector{ href: "?users.fr", data: { value: 'users.fr' }, title: "Users with no paying sites" } Free
                %li
                  %a.selector{ href: "?users.pa", data: { value: 'users.pa' }, title: "Users with at least 1 paying sites" } Paying
            %li
              %a.title.selector{ href: "?users.passive", data: { value: 'users.passive' } } Passive
              %ul
                %li
                  %a.selector{ href: "?users.su", data: { value: 'users.su' }, title: "Users with too many payment issues" } Suspended
                %li
                  %a.selector{ href: "?users.ar", data: { value: 'users.ar' }, title: "Users who chose to delete their account OR who never accept their beta invitation" } Archived

        %td.sites
          %h2 Sites
          %ul
            %li
              %a.title.selector{ href: "?sites.active", data: { value: 'sites.active' }, title: "Sites in beta, dev, free, trial or any paying plan" } Active
              %ul
                %li
                  %a.selector{ href: "?sites.fr.beta", data: { value: 'sites.fr.beta' }, title: "Sites in the beta plan" } Beta
                %li
                  %a.selector{ href: "?sites.fr.dev", data: { value: 'sites.fr.dev' }, title: "Sites in the dev plan" } Dev
                %li
                  %a.selector{ href: "?sites.fr.free", data: { value: 'sites.fr.free' }, title: "Sites in the free plan" } Free
                %li
                  %a.selector{ href: "?sites.sp", data: { value: 'sites.sp' }, title: "Sites we sponsor" } Sponsored

                %li
                  %a.selector{ href: "?sites.tr", data: { value: 'sites.tr' }, title: "Sites in trial" } Trial
                %li
                  %a.selector{ href: "?sites.pa", data: { value: 'sites.pa' } } Paying
                  %ul
                    %li
                      %a.selector{ href: "?sites.pa.addons", data: { value: 'sites.pa.addons' }, title: "Sites with add-ons" } Add-ons
                  %ul
                    %li
                      %a.selector{ href: "?sites.pa.plus", data: { value: 'sites.pa.plus' }, title: "Sites in the Plus plan" } Plus
                      -#%ul
                      -#  %li
                      -#    %a.selector{ href: "?sites.pa.plus.m", data: { value: 'sites.pa.plus.m' } } Monthly
                      -#  %li
                      -#    %a.selector{ href: "?sites.pa.plus.y", data: { value: 'sites.pa.plus.y' } } Yearly
                    %li
                      %a.selector{ href: "?sites.pa.premium", data: { value: 'sites.pa.premium' }, title: "Sites in the Premium plan" } Premium
                      -#%ul
                      -#  %li
                      -#    %a.selector{ href: "?sites.pa.premium.m", data: { value: 'sites.pa.premium.m' } } Monthly
                      -#  %li
                      -#    %a.selector{ href: "?sites.pa.premium.y", data: { value: 'sites.pa.premium.y' } } Yearly
            %li
              %a.title.selector{ href: "?sites.passive", data: { value: 'sites.passive' } } Passive
              %ul
                %li
                  %a.selector{ href: "?sites.su", data: { value: 'sites.su' }, title: "Sites for which the user is suspended" } Suspended
                %li
                  %a.selector{ href: "?sites.ar", data: { value: 'sites.ar' }, title: "Sites deleted by their owner" } Archived

        %td.site_stats
          %h2 Site Stats
          %ul
            %li
              %a.title.selector{ href: "?site_stats.pv.all", data: { value: 'site_stats.pv.all' } } Page visits
              %ul
                %li
                  %a.selector{ href: "?site_stats.pv.billable", data: { value: 'site_stats.pv.billable' } } Billable
                  %ul
                    %li
                      %a.selector{ href: "?site_stats.pv.m", data: { value: 'site_stats.pv.m' } } Main
                    %li
                      %a.selector{ href: "?site_stats.pv.e", data: { value: 'site_stats.pv.e' } } Extra
                    %li
                      %a.selector{ href: "?site_stats.pv.em", data: { value: 'site_stats.pv.em' }, title: "Extra & Main embed only" } Embed
                %li
                  %a.selector{ href: "?site_stats.pv.d", data: { value: 'site_stats.pv.d' } } Dev
                %li
                  %a.selector{ href: "?site_stats.pv.i", data: { value: 'site_stats.pv.i' } } Invalid
            %li
              %a.title.selector{ href: "?site_stats.vv.all", data: { value: 'site_stats.vv.all' } } Video plays
              %ul
                %li
                  %a.selector{ href: "?site_stats.vv.billable", data: { value: 'site_stats.vv.billable' } } Billable
                  %ul
                    %li
                      %a.selector{ href: "?site_stats.vv.m", data: { value: 'site_stats.vv.m' } } Main
                    %li
                      %a.selector{ href: "?site_stats.vv.e", data: { value: 'site_stats.vv.e' } } Extra
                    %li
                      %a.selector{ href: "?site_stats.vv.em", data: { value: 'site_stats.vv.em' }, title: "Extra & Main embed only" } Embed
                %li
                  %a.selector{ href: "?site_stats.vv.d", data: { value: 'site_stats.vv.d' } } Dev
                %li
                  %a.selector{ href: "?site_stats.vv.i", data: { value: 'site_stats.vv.i' } } Invalid
            %li
              %a.title.selector{ href: "?site_stats.md.html5_proportion", data: { value: 'site_stats.md.html5_proportion' } } HTML5 Mode %
            %li
              %a.title.selector{ href: "?site_stats.md.mobile_proportion", data: { value: 'site_stats.md.mobile_proportion' }, title: "Mobile (tablet included) %" } Mobile %

          %h2 Site Usages (old)
          %ul
            %li
              %a.title.selector{ href: "?site_usages.lh.all", data: { value: 'site_usages.lh.all' } } Loader hits
              %ul
                %li
                  %a.selector{ href: "?site_usages.lh.ns", data: { value: 'site_usages.lh.ns' } } Non-SSL
                %li
                  %a.selector{ href: "?site_usages.lh.s", data: { value: 'site_usages.lh.s' } } SSL
            %li
              %a.title.selector{ href: "?site_usages.ph.all", data: { value: 'site_usages.ph.all' } } Player hits
              %ul
                %li
                  %a.selector{ href: "?site_usages.ph.billable", data: { value: 'site_usages.ph.billable' } } Billable
                  %ul
                    %li
                      %a.selector{ href: "?site_usages.ph.m", data: { value: 'site_usages.ph.m' } } Main
                    %li
                      %a.selector{ href: "?site_usages.ph.e", data: { value: 'site_usages.ph.e' } } Extra
                %li
                  %a.selector{ href: "?site_usages.ph.d", data: { value: 'site_usages.ph.d' } } Dev
                %li
                  %a.selector{ href: "?site_usages.ph.i", data: { value: 'site_usages.ph.i' } } Invalid
            %li
              %a.title.selector{ href: "?site_usages.fh", data: { value: 'site_usages.fh' } } Flash hits
            %li
              %a.title.selector{ href: "?site_usages.sr", data: { value: 'site_usages.sr' } } S3 requests
            %li
              %a.title.selector{ href: "?site_usages.tr.s", data: { value: 'site_usages.tr.s' } } Traffic S3 (GB)
            %li
              %a.title.selector{ href: "?site_usages.tr.v", data: { value: 'site_usages.tr.v' } } Traffic Voxcast (GB)

        %td
          %h2 Tweets
          %ul
            - Tweet::KEYWORDS.each do |keyword|
              %li
                %a.selector{ href: "?tweets.#{keyword}", data: { value: "tweets.#{keyword}" } }= keyword.titleize
          %h2 Tailor-made player requests
          %ul
            %li
              %a.title.selector{ href: "?tailor_made_player_requests.all", data: { value: 'tailor_made_player_requests.all' } } All
              %ul
                - TailorMadePlayerRequest.topics.each do |topic|
                  %li
                    %a.selector{ href: "?tailor_made_player_requests.n.#{topic}", data: { value: "tailor_made_player_requests.n.#{topic}" } }= topic.titleize
