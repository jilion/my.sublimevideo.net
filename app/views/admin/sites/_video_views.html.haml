- last_30_days_video_views = SiteStat.where(t: site.token).d_between(31.days.ago.utc, Time.now.utc.yesterday.end_of_day).inject(0) { |sum, ss| sum + ss.vv['m'] + ss.vv['e'] }.to_i
- total_video_views = SiteStat.collection.group(cond: { t: site.token }, initial: { sum: 0 }, reduce: 'function(doc, prev){ prev.sum += (isNaN(doc.vv.m) ? 0 : doc.vv.m) + (isNaN(doc.vv.e) ? doc.vv.e : 0); }').first['sum'].to_i

%h3 Video views

%p
  Last 30 days traffic:&nbsp;&nbsp;&nbsp;
  = "#{number_with_delimiter(last_30_days_video_views, :significant => false, :precision => 2, :delimiter => "'")} video views"
%p
  Last 30 days avg/day:
  = "#{number_with_delimiter(last_30_days_video_views / 30, :significant => false, :precision => 2, :delimiter => "'")} video views"
%p
  All time traffic:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  = "#{number_with_delimiter(total_video_views, :significant => false, :precision => 2, :delimiter => "'")} video views"