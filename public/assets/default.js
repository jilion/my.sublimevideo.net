var Prototype={Version:"1.7_rc2",Browser:function(){var a=navigator.userAgent,b=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!b,Opera:b,WebKit:a.indexOf("AppleWebKit/")>-1,Gecko:a.indexOf("Gecko")>-1&&a.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(a)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var a=window.Element||window.HTMLElement;return!!(a&&a.prototype)}(),SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!==
"undefined")return true;var a=document.createElement("div"),b=document.createElement("form"),c=false;if(a.__proto__&&a.__proto__!==b.__proto__)c=true;return c}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;
var Abstract={},Try={these:function(){for(var a,b=0,c=arguments.length;b<c;b++){var e=arguments[b];try{a=e();break}catch(g){}}return a}},Class=function(){function a(){}function b(){function g(){this.initialize.apply(this,arguments)}var j=null,n=$A(arguments);if(Object.isFunction(n[0]))j=n.shift();Object.extend(g,Class.Methods);g.superclass=j;g.subclasses=[];if(j){a.prototype=j.prototype;g.prototype=new a;j.subclasses.push(g)}j=0;for(var q=n.length;j<q;j++)g.addMethods(n[j]);if(!g.prototype.initialize)g.prototype.initialize=
Prototype.emptyFunction;return g.prototype.constructor=g}function c(g){var j=this.superclass&&this.superclass.prototype,n=Object.keys(g);if(e){g.toString!=Object.prototype.toString&&n.push("toString");g.valueOf!=Object.prototype.valueOf&&n.push("valueOf")}for(var q=0,x=n.length;q<x;q++){var F=n[q],C=g[F];if(j&&Object.isFunction(C)&&C.argumentNames()[0]=="$super"){var i=C;C=function(r){return function(){return j[r].apply(this,arguments)}}(F).wrap(i);C.valueOf=i.valueOf.bind(i);C.toString=i.toString.bind(i)}this.prototype[F]=
C}return this}var e=function(){for(var g in{toString:1})if(g==="toString")return false;return true}();return{create:b,Methods:{addMethods:c}}}();
(function(){function a(D){switch(D){case null:return l;case void 0:return m}switch(typeof D){case "boolean":return w;case "number":return o;case "string":return s}return p}function b(D,H){for(var B in H)D[B]=H[B];return D}function c(D){try{if(d(D))return"undefined";if(D===null)return"null";return D.inspect?D.inspect():String(D)}catch(H){if(H instanceof RangeError)return"...";throw H;}}function e(D){return g("",{"":D},[])}function g(D,H,B){H=H[D];var G=typeof H;if(a(H)===p&&typeof H.toJSON==="function")H=
H.toJSON(D);D=f.call(H);switch(D){case v:case h:case E:H=H.valueOf()}switch(H){case null:return"null";case true:return"true";case false:return"false"}G=typeof H;switch(G){case "string":return H.inspect(true);case "number":return isFinite(H)?String(H):"null";case "object":G=0;for(var J=B.length;G<J;G++)if(B[G]===H)throw new TypeError;B.push(H);var K=[];if(D===L){G=0;for(J=H.length;G<J;G++){var M=g(G,H,B);K.push(typeof M==="undefined"?"null":M)}K="["+K.join(",")+"]"}else{var N=Object.keys(H);G=0;for(J=
N.length;G<J;G++){D=N[G];M=g(D,H,B);typeof M!=="undefined"&&K.push(D.inspect(true)+":"+M)}K="{"+K.join(",")+"}"}B.pop();return K}}function j(D){return JSON.stringify(D)}function n(D){return $H(D).toQueryString()}function q(D){return D&&D.toHTML?D.toHTML():String.interpret(D)}function x(D){if(a(D)!==p)throw new TypeError;var H=[];for(var B in D)D.hasOwnProperty(B)&&H.push(B);return H}function F(D){var H=[];for(var B in D)H.push(D[B]);return H}function C(D){return b({},D)}function i(D){return!!(D&&
D.nodeType==1)}function r(D){return f.call(D)===L}function y(D){return D instanceof Hash}function A(D){return typeof D==="function"}function u(D){return f.call(D)===E}function z(D){return f.call(D)===v}function d(D){return typeof D==="undefined"}var f=Object.prototype.toString,l="Null",m="Undefined",w="Boolean",o="Number",s="String",p="Object",h="[object Boolean]",v="[object Number]",E="[object String]",L="[object Array]",I=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&
typeof JSON.stringify(Prototype.K)==="undefined";if(typeof Array.isArray=="function"&&Array.isArray([])&&!Array.isArray({}))r=Array.isArray;b(Object,{extend:b,inspect:c,toJSON:I?j:e,toQueryString:n,toHTML:q,keys:Object.keys||x,values:F,clone:C,isElement:i,isArray:r,isHash:y,isFunction:A,isString:u,isNumber:z,isUndefined:d})})();
Object.extend(Function.prototype,function(){function a(i,r){for(var y=i.length,A=r.length;A--;)i[y+A]=r[A];return i}function b(i,r){i=C.call(i,0);return a(i,r)}function c(){var i=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return i.length==1&&!i[0]?[]:i}function e(i){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var r=this,y=C.call(arguments,1);return function(){var A=b(y,arguments);
return r.apply(i,A)}}function g(i){var r=this,y=C.call(arguments,1);return function(A){A=a([A||window.event],y);return r.apply(i,A)}}function j(){if(!arguments.length)return this;var i=this,r=C.call(arguments,0);return function(){var y=b(r,arguments);return i.apply(this,y)}}function n(i){var r=this,y=C.call(arguments,1);i*=1E3;return window.setTimeout(function(){return r.apply(r,y)},i)}function q(){return this.delay.apply(this,a([0.01],arguments))}function x(i){var r=this;return function(){var y=
a([r.bind(this)],arguments);return i.apply(this,y)}}function F(){if(this._methodized)return this._methodized;var i=this;return this._methodized=function(){var r=a([this],arguments);return i.apply(null,r)}}var C=Array.prototype.slice;return{argumentNames:c,bind:e,bindAsEventListener:g,curry:j,delay:n,defer:q,wrap:x,methodize:F}}());
(function(a){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function c(){return this.toISOString()}if(!a.toISOString)a.toISOString=b;if(!a.toJSON)a.toJSON=c})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;
RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(a,b){this.callback=a;this.frequency=b;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1E3)},execute:function(){this.callback(this)},stop:function(){if(this.timer){clearInterval(this.timer);this.timer=null}},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(a){this.currentlyExecuting=
false;throw a;}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function a(B){if(Object.isFunction(B))return B;var G=new Template(B);return function(J){return G.evaluate(J)}}function b(B,G){var J="",K=this,M;G=a(G);if(Object.isString(B))B=RegExp.escape(B);if(!(B.length||B.source)){G=G("");return G+K.split("").join(G)+G}for(;K.length>0;)if(M=K.match(B)){J+=K.slice(0,M.index);J+=String.interpret(G(M));K=K.slice(M.index+M[0].length)}else{J+=K;K=""}return J}function c(B,G,J){G=a(G);J=Object.isUndefined(J)?1:J;return this.gsub(B,
function(K){if(--J<0)return K[0];return G(K)})}function e(B,G){this.gsub(B,G);return String(this)}function g(B,G){B=B||30;G=Object.isUndefined(G)?"...":G;return this.length>B?this.slice(0,B-G.length)+G:String(this)}function j(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function n(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function q(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function x(){var B=new RegExp(Prototype.ScriptFragment,"img"),
G=new RegExp(Prototype.ScriptFragment,"im");return(this.match(B)||[]).map(function(J){return(J.match(G)||["",""])[1]})}function F(){return this.extractScripts().map(function(B){return eval(B)})}function C(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function r(B){var G=this.strip().match(/([^?#]*)(#.*)?$/);if(!G)return{};return G[1].split(B||"&").inject({},function(J,
K){if((K=K.split("="))[0]){var M=decodeURIComponent(K.shift());K=K.length>1?K.join("="):K[0];if(K!=undefined)K=decodeURIComponent(K);if(M in J){Object.isArray(J[M])||(J[M]=[J[M]]);J[M].push(K)}else J[M]=K}return J})}function y(){return this.split("")}function A(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function u(B){return B<1?"":(new Array(B+1)).join(this)}function z(){return this.replace(/-+(.)?/g,function(B,G){return G?G.toUpperCase():""})}function d(){return this.charAt(0).toUpperCase()+
this.substring(1).toLowerCase()}function f(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function l(){return this.replace(/_/g,"-")}function m(B){var G=this.replace(/[\x00-\x1f\\]/g,function(J){if(J in String.specialChar)return String.specialChar[J];return"\\u00"+J.charCodeAt().toPaddedString(2,16)});if(B)return'"'+G.replace(/"/g,'\\"')+'"';return"'"+G.replace(/'/g,"\\'")+"'"}function w(B){return this.replace(B||
Prototype.JSONFilter,"$1")}function o(){var B=this;if(B.blank())return false;B=B.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");B=B.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");B=B.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(B)}function s(B){var G=this.unfilterJSON(),J=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(J.test(G))G=G.replace(J,function(M){return"\\u"+("0000"+M.charCodeAt(0).toString(16)).slice(-4)});
try{if(!B||G.isJSON())return eval("("+G+")")}catch(K){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}function p(){var B=this.unfilterJSON();return JSON.parse(B)}function h(B){return this.indexOf(B)>-1}function v(B){return this.lastIndexOf(B,0)===0}function E(B){var G=this.length-B.length;return G>=0&&this.indexOf(B,G)===G}function L(){return this==""}function I(){return/^\s*$/.test(this)}function D(B,G){return(new Template(this,G)).evaluate(B)}var H=window.JSON&&typeof JSON.parse===
"function"&&JSON.parse('{"test": true}').test;return{gsub:b,sub:c,scan:e,truncate:g,strip:String.prototype.trim||j,stripTags:n,stripScripts:q,extractScripts:x,evalScripts:F,escapeHTML:C,unescapeHTML:i,toQueryParams:r,parseQuery:r,toArray:y,succ:A,times:u,camelize:z,capitalize:d,underscore:f,dasherize:l,inspect:m,unfilterJSON:w,isJSON:o,evalJSON:H?p:s,include:h,startsWith:v,endsWith:E,empty:L,blank:I,interpolate:D}}());
var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(a&&Object.isFunction(a.toTemplateReplacements))a=a.toTemplateReplacements();return this.template.gsub(this.pattern,function(b){if(a==null)return b[1]+"";var c=b[1]||"";if(c=="\\")return b[2];var e=a,g=b[3],j=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;b=j.exec(g);if(b==null)return c;for(;b!=null;){var n=b[1].startsWith("[")?b[2].replace(/\\\\]/g,"]"):b[1];e=e[n];if(null==
e||""==b[3])break;g=g.substring("["==b[3]?b[1].length:b[0].length);b=j.exec(g)}return c+String.interpret(e)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function a(o,s){var p=0;try{this._each(function(v){o.call(s,v,p++)})}catch(h){if(h!=$break)throw h;}return this}function b(o,s,p){var h=-o,v=[],E=this.toArray();if(o<1)return E;for(;(h+=o)<E.length;)v.push(E.slice(h,h+o));return v.collect(s,p)}function c(o,s){o=o||Prototype.K;var p=true;this.each(function(h,v){p=p&&!!o.call(s,h,v);if(!p)throw $break;});return p}function e(o,s){o=o||Prototype.K;var p=false;this.each(function(h,v){if(p=!!o.call(s,h,v))throw $break;
});return p}function g(o,s){o=o||Prototype.K;var p=[];this.each(function(h,v){p.push(o.call(s,h,v))});return p}function j(o,s){var p;this.each(function(h,v){if(o.call(s,h,v)){p=h;throw $break;}});return p}function n(o,s){var p=[];this.each(function(h,v){o.call(s,h,v)&&p.push(h)});return p}function q(o,s,p){s=s||Prototype.K;var h=[];if(Object.isString(o))o=new RegExp(RegExp.escape(o));this.each(function(v,E){o.match(v)&&h.push(s.call(p,v,E))});return h}function x(o){if(Object.isFunction(this.indexOf))if(this.indexOf(o)!=
-1)return true;var s=false;this.each(function(p){if(p==o){s=true;throw $break;}});return s}function F(o,s){s=Object.isUndefined(s)?null:s;return this.eachSlice(o,function(p){for(;p.length<o;)p.push(s);return p})}function C(o,s,p){this.each(function(h,v){o=s.call(p,o,h,v)});return o}function i(o){var s=$A(arguments).slice(1);return this.map(function(p){return p[o].apply(p,s)})}function r(o,s){o=o||Prototype.K;var p;this.each(function(h,v){h=o.call(s,h,v);if(p==null||h>=p)p=h});return p}function y(o,
s){o=o||Prototype.K;var p;this.each(function(h,v){h=o.call(s,h,v);if(p==null||h<p)p=h});return p}function A(o,s){o=o||Prototype.K;var p=[],h=[];this.each(function(v,E){(o.call(s,v,E)?p:h).push(v)});return[p,h]}function u(o){var s=[];this.each(function(p){s.push(p[o])});return s}function z(o,s){var p=[];this.each(function(h,v){o.call(s,h,v)||p.push(h)});return p}function d(o,s){return this.map(function(p,h){return{value:p,criteria:o.call(s,p,h)}}).sort(function(p,h){p=p.criteria;h=h.criteria;return p<
h?-1:p>h?1:0}).pluck("value")}function f(){return this.map()}function l(){var o=Prototype.K,s=$A(arguments);if(Object.isFunction(s.last()))o=s.pop();var p=[this].concat(s).map($A);return this.map(function(h,v){return o(p.pluck(v))})}function m(){return this.toArray().length}function w(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:a,eachSlice:b,all:c,every:c,any:e,some:e,collect:g,map:g,detect:j,findAll:n,select:n,filter:n,grep:q,include:x,member:x,inGroupsOf:F,inject:C,invoke:i,
max:r,min:y,partition:A,pluck:u,reject:z,sortBy:d,toArray:f,entries:f,zip:l,size:m,inspect:w,find:j}}();function $A(a){if(!a)return[];if("toArray"in Object(a))return a.toArray();for(var b=a.length||0,c=new Array(b);b--;)c[b]=a[b];return c}function $w(a){if(!Object.isString(a))return[];return(a=a.strip())?a.split(/\s+/):[]}Array.from=$A;
(function(){function a(l){for(var m=0,w=this.length;m<w;m++)l(this[m])}function b(){this.length=0;return this}function c(){return this[0]}function e(){return this[this.length-1]}function g(){return this.select(function(l){return l!=null})}function j(){return this.inject([],function(l,m){if(Object.isArray(m))return l.concat(m.flatten());l.push(m);return l})}function n(){var l=d.call(arguments,0);return this.select(function(m){return!l.include(m)})}function q(l){return(l===false?this.toArray():this)._reverse()}
function x(l){return this.inject([],function(m,w,o){if(0==o||(l?m.last()!=w:!m.include(w)))m.push(w);return m})}function F(l){return this.uniq().findAll(function(m){return l.detect(function(w){return m===w})})}function C(){return d.call(this,0)}function i(){return this.length}function r(){return"["+this.map(Object.inspect).join(", ")+"]"}function y(l,m){m||(m=0);var w=this.length;if(m<0)m=w+m;for(;m<w;m++)if(this[m]===l)return m;return-1}function A(l,m){m=isNaN(m)?this.length:(m<0?this.length+m:m)+
1;l=this.slice(0,m).reverse().indexOf(l);return l<0?l:m-l-1}function u(){for(var l=d.call(this,0),m,w=0,o=arguments.length;w<o;w++){m=arguments[w];if(Object.isArray(m)&&!("callee"in m))for(var s=0,p=m.length;s<p;s++)l.push(m[s]);else l.push(m)}return l}var z=Array.prototype,d=z.slice,f=z.forEach;f||(f=a);Object.extend(z,Enumerable);if(!z._reverse)z._reverse=z.reverse;Object.extend(z,{_each:f,clear:b,first:c,last:e,compact:g,flatten:j,without:n,reverse:q,uniq:x,intersect:F,clone:C,toArray:C,size:i,
inspect:r});if(function(){return[].concat(arguments)[0][0]!==1}(1,2))z.concat=u;if(!z.indexOf)z.indexOf=y;if(!z.lastIndexOf)z.lastIndexOf=A})();function $H(a){return new Hash(a)}
var Hash=Class.create(Enumerable,function(){function a(u){this._object=Object.isHash(u)?u.toObject():Object.clone(u)}function b(u){for(var z in this._object){var d=this._object[z],f=[z,d];f.key=z;f.value=d;u(f)}}function c(u,z){return this._object[u]=z}function e(u){if(this._object[u]!==Object.prototype[u])return this._object[u]}function g(u){var z=this._object[u];delete this._object[u];return z}function j(){return Object.clone(this._object)}function n(){return this.pluck("key")}function q(){return this.pluck("value")}
function x(u){var z=this.detect(function(d){return d.value===u});return z&&z.key}function F(u){return this.clone().update(u)}function C(u){return(new Hash(u)).inject(this,function(z,d){z.set(d.key,d.value);return z})}function i(u,z){if(Object.isUndefined(z))return u;return u+"="+encodeURIComponent(String.interpret(z))}function r(){return this.inject([],function(u,z){var d=encodeURIComponent(z.key);if((z=z.value)&&typeof z=="object"){if(Object.isArray(z))return u.concat(z.map(i.curry(d)))}else u.push(i(d,
z));return u}).join("&")}function y(){return"#<Hash:{"+this.map(function(u){return u.map(Object.inspect).join(": ")}).join(", ")+"}>"}function A(){return new Hash(this)}return{initialize:a,_each:b,set:c,get:e,unset:g,toObject:j,toTemplateReplacements:j,keys:n,values:q,index:x,merge:F,update:C,toQueryString:r,inspect:y,toJSON:j,clone:A}}());Hash.from=$H;
Object.extend(Number.prototype,function(){function a(){return this.toPaddedString(2,16)}function b(){return this+1}function c(x,F){$R(0,this,true).each(x,F);return this}function e(x,F){F=this.toString(F||10);return"0".times(x-F.length)+F}function g(){return Math.abs(this)}function j(){return Math.round(this)}function n(){return Math.ceil(this)}function q(){return Math.floor(this)}return{toColorPart:a,succ:b,times:c,toPaddedString:e,abs:g,round:j,ceil:n,floor:q}}());
function $R(a,b,c){return new ObjectRange(a,b,c)}
var ObjectRange=Class.create(Enumerable,function(){function a(e,g,j){this.start=e;this.end=g;this.exclusive=j}function b(e){for(var g=this.start;this.include(g);){e(g);g=g.succ()}}function c(e){if(e<this.start)return false;if(this.exclusive)return e<this.end;return e<=this.end}return{initialize:a,_each:b,include:c}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||
false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,c,e){this.each(function(g){if(Object.isFunction(g[a]))try{g[a].apply(g,[b,c,e])}catch(j){}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});
Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters))this.options.parameters=this.options.parameters.toObject()}});
Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,c){$super(c);this.transport=Ajax.getTransport();this.request(b)},request:function(a){this.url=a;this.method=this.options.method;a=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){a+=(a?"&":"")+"_method="+this.method;this.method="post"}if(a)if(this.method=="get")this.url+=(this.url.include("?")?"&":"?")+a;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))a+=
"&_=";this.parameters=a.toQueryParams();try{var b=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(b);Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||a:null;this.transport.send(this.body);!this.options.asynchronous&&
this.transport.overrideMimeType&&this.onStateChange()}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;a>1&&!(a==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){a["Content-type"]=this.options.contentType+(this.options.encoding?
"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)a.Connection="close"}if(typeof this.options.requestHeaders=="object"){var b=this.options.requestHeaders;if(Object.isFunction(b.push))for(var c=0,e=b.length;c<e;c+=2)a[b[c]]=b[c+1];else $H(b).each(function(j){a[j.key]=j.value})}for(var g in a)this.transport.setRequestHeader(g,a[g])},success:function(){var a=this.getStatus();return!a||a>=200&&a<300},getStatus:function(){try{return this.transport.status||
0}catch(a){return 0}},respondToReadyState:function(a){a=Ajax.Request.Events[a];var b=new Ajax.Response(this);if(a=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(c){this.dispatchException(c)}var e=b.getHeader("Content-type");if(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&e&&e.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))this.evalResponse()}try{(this.options["on"+
a]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+a,this,b,b.headerJSON)}catch(g){this.dispatchException(g)}if(a=="Complete")this.transport.onreadystatechange=Prototype.emptyFunction},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return!a||a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(a){try{return this.transport.getResponseHeader(a)||
null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(a){this.dispatchException(a)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(a){this.request=a;a=this.transport=a.transport;var b=this.readyState=a.readyState;if(b>2&&!Prototype.Browser.IE||b==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(a.responseText);this.headerJSON=this._getHeaderJSON()}if(b==4){a=a.responseXML;this.responseXML=Object.isUndefined(a)?null:a;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,
getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a)return null;a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||
!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,b,c,e){this.container={success:b.success||b,failure:b.failure||(b.success?null:b)};e=Object.clone(e);var g=e.onComplete;e.onComplete=function(j,n){this.updateContent(j.responseText);Object.isFunction(g)&&g(j,n)}.bind(this);$super(c,e)},updateContent:function(a){var b=this.container[this.success()?"success":"failure"],c=this.options;c.evalScripts||(a=a.stripScripts());if(b=$(b))if(c.insertion)if(Object.isString(c.insertion)){var e=
{};e[c.insertion]=a;b.insert(e)}else c.insertion(b,a);else b.update(a)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,b,c,e){$super(e);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=b;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(a){if(this.options.decay){this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1;this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(a){if(arguments.length>1){for(var b=0,c=[],e=arguments.length;b<e;b++)c.push($(arguments[b]));return c}if(Object.isString(a))a=document.getElementById(a);return Element.extend(a)}if(Prototype.BrowserFeatures.XPath)document._getElementsByXPath=function(a,b){var c=[];a=document.evaluate(a,$(b)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);b=0;for(var e=a.snapshotLength;b<e;b++)c.push(Element.extend(a.snapshotItem(b)));return c};if(!Node)var Node={};
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(a){var b=function(){try{var e=document.createElement('<input name="x">');return e.tagName.toLowerCase()==="input"&&e.name==="x"}catch(g){return false}}(),c=a.Element;a.Element=function(e,g){g=g||{};e=e.toLowerCase();var j=Element.cache;if(b&&g.name){e="<"+e+' name="'+g.name+'">';delete g.name;return Element.writeAttribute(document.createElement(e),g)}j[e]||(j[e]=Element.extend(document.createElement(e)));return Element.writeAttribute(j[e].cloneNode(false),g)};Object.extend(a.Element,c||
{});if(c)a.Element.prototype=c.prototype})(this);Element.idCounter=1;Element.cache={};function purgeElement(a){var b=a._prototypeUID;if(b){Element.stopObserving(a);a._prototypeUID=void 0;delete Element.Storage[b]}}
Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:function(){function a(g,j){g=$(g);for(var n=g.getElementsByTagName("*"),q=n.length;q--;)purgeElement(n[q]);if(j&&j.toElement)j=j.toElement();if(Object.isElement(j))return g.update().insert(j);
j=Object.toHTML(j);n=g.tagName.toUpperCase();if(n==="SCRIPT"&&e){g.text=j;return g}if(b||c)if(n in Element._insertionTranslations.tags){for(;g.firstChild;)g.removeChild(g.firstChild);Element._getContentFromAnonymousElement(n,j.stripScripts()).each(function(x){g.appendChild(x)})}else g.innerHTML=j.stripScripts();else g.innerHTML=j.stripScripts();j.evalScripts.bind(j).defer();return g}var b=function(){var g=document.createElement("select"),j=true;g.innerHTML='<option value="test">test</option>';if(g.options&&
g.options[0])j=g.options[0].nodeName.toUpperCase()!=="OPTION";return j}(),c=function(){try{var g=document.createElement("table");if(g&&g.tBodies){g.innerHTML="<tbody><tr><td>test</td></tr></tbody>";return typeof g.tBodies[0]=="undefined"}}catch(j){return true}}(),e=function(){var g=document.createElement("script"),j=false;try{g.appendChild(document.createTextNode(""));j=!g.firstChild||g.firstChild&&g.firstChild.nodeType!==3}catch(n){j=true}return j}();return a}(),replace:function(a,b){a=$(a);if(b&&
b.toElement)b=b.toElement();else if(!Object.isElement(b)){b=Object.toHTML(b);var c=a.ownerDocument.createRange();c.selectNode(a);b.evalScripts.bind(b).defer();b=c.createContextualFragment(b.stripScripts())}a.parentNode.replaceChild(b,a);return a},insert:function(a,b){a=$(a);if(Object.isString(b)||Object.isNumber(b)||Object.isElement(b)||b&&(b.toElement||b.toHTML))b={bottom:b};var c,e,g;for(var j in b){c=b[j];j=j.toLowerCase();e=Element._insertionTranslations[j];if(c&&c.toElement)c=c.toElement();if(Object.isElement(c))e(a,
c);else{c=Object.toHTML(c);g=(j=="before"||j=="after"?a.parentNode:a).tagName.toUpperCase();g=Element._getContentFromAnonymousElement(g,c.stripScripts());if(j=="top"||j=="after")g.reverse();g.each(e.curry(a));c.evalScripts.bind(c).defer()}}return a},wrap:function(a,b,c){a=$(a);if(Object.isElement(b))$(b).writeAttribute(c||{});else b=Object.isString(b)?new Element(b,c):new Element("div",b);a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b},inspect:function(a){a=$(a);var b="<"+
a.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(c){var e=c.first();c=c.last();if(e=(a[e]||"").toString())b+=" "+c+"="+e.inspect(true)});return b+">"},recursivelyCollect:function(a,b,c){a=$(a);c=c||-1;for(var e=[];a=a[b];){a.nodeType==1&&e.push(Element.extend(a));if(e.length==c)break}return e},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){for(a=$(a).firstChild;a&&a.nodeType!=
1;)a=a.nextSibling;return $(a)},immediateDescendants:function(a){var b=[];for(a=$(a).firstChild;a;){a.nodeType===1&&b.push(Element.extend(a));a=a.nextSibling}return b},previousSiblings:function(a){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(a,b){a=$(a);if(Object.isString(b))return Prototype.Selector.match(a,
b);return b.match(a)},up:function(a,b,c){a=$(a);if(arguments.length==1)return $(a.parentNode);var e=Element.ancestors(a);return Object.isNumber(b)?e[b]:Prototype.Selector.find(e,b,c)},down:function(a,b,c){a=$(a);if(arguments.length==1)return Element.firstDescendant(a);return Object.isNumber(b)?Element.descendants(a)[b]:Element.select(a,b)[c||0]},previous:function(a,b,c){a=$(a);if(Object.isNumber(b)){c=b;b=false}Object.isNumber(c)||(c=0);return b?Prototype.Selector.find(a.previousSiblings(),b,c):a.recursivelyCollect("previousSibling",
c+1)[c]},next:function(a,b,c){a=$(a);if(Object.isNumber(b)){c=b;b=false}Object.isNumber(c)||(c=0);if(b)return Prototype.Selector.find(a.nextSiblings(),b,c);else{Object.isNumber(c);return a.recursivelyCollect("nextSibling",c+1)[c]}},select:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a)},adjacent:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a.parentNode).without(a)},identify:function(a){a=
$(a);var b=Element.readAttribute(a,"id");if(b)return b;do b="anonymous_element_"+Element.idCounter++;while($(b));Element.writeAttribute(a,"id",b);return b},readAttribute:function(a,b){a=$(a);if(Prototype.Browser.IE){var c=Element._attributeTranslations.read;if(c.values[b])return c.values[b](a,b);if(c.names[b])b=c.names[b];if(b.include(":"))return!a.attributes||!a.attributes[b]?null:a.attributes[b].value}return a.getAttribute(b)},writeAttribute:function(a,b,c){a=$(a);var e={},g=Element._attributeTranslations.write;
if(typeof b=="object")e=b;else e[b]=Object.isUndefined(c)?true:c;for(var j in e){b=g.names[j]||j;c=e[j];if(g.values[j])b=g.values[j](a,c);if(c===false||c===null)a.removeAttribute(b);else c===true?a.setAttribute(b,b):a.setAttribute(b,c)}return a},getHeight:function(a){return Element.getDimensions(a).height},getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(a=$(a)){a=a.className;return a.length>0&&(a==b||
(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(a))}},addClassName:function(a,b){if(a=$(a)){Element.hasClassName(a,b)||(a.className+=(a.className?" ":"")+b);return a}},removeClassName:function(a,b){if(a=$(a)){a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a}},toggleClassName:function(a,b){if(a=$(a))return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(a){a=$(a);for(var b=a.firstChild;b;){var c=b.nextSibling;b.nodeType==
3&&!/\S/.test(b.nodeValue)&&a.removeChild(b);b=c}return a},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(a,b){a=$(a);b=$(b);if(a.compareDocumentPosition)return(a.compareDocumentPosition(b)&8)===8;if(b.contains)return b.contains(a)&&b!==a;for(;a=a.parentNode;)if(a==b)return true;return false},scrollTo:function(a){a=$(a);var b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(a,b){a=$(a);b=b=="float"?"cssFloat":b.camelize();var c=a.style[b];
if(!c||c=="auto")c=(a=document.defaultView.getComputedStyle(a,null))?a[b]:null;if(b=="opacity")return c?parseFloat(c):1;return c=="auto"?null:c},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(a,b){a=$(a);var c=a.style;if(Object.isString(b)){a.style.cssText+=";"+b;return b.include("opacity")?a.setOpacity(b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a}for(var e in b)if(e=="opacity")a.setOpacity(b[e]);else c[e=="float"||e=="cssFloat"?Object.isUndefined(c.styleFloat)?"cssFloat":"styleFloat":
e]=b[e];return a},setOpacity:function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;return a},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=
$(a);if(a._overflow)return a;a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden")a.style.overflow="hidden";return a},undoClipping:function(a){a=$(a);if(!a._overflow)return a;a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},cumulativeOffset:function(a){var b=0,c=0;if(a.parentNode){do{b+=a.offsetTop||0;c+=a.offsetLeft||0;a=a.offsetParent}while(a)}return Element._returnOffset(c,b)},positionedOffset:function(a){var b=0,c=0;do{b+=a.offsetTop||0;c+=
a.offsetLeft||0;if(a=a.offsetParent){if(a.tagName.toUpperCase()=="BODY")break;if(Element.getStyle(a,"position")!=="static")break}}while(a);return Element._returnOffset(c,b)},absolutize:function(a){a=$(a);if(Element.getStyle(a,"position")=="absolute")return a;var b=Element.positionedOffset(a),c=b[1];b=b[0];var e=a.clientWidth,g=a.clientHeight;a._originalLeft=b-parseFloat(a.style.left||0);a._originalTop=c-parseFloat(a.style.top||0);a._originalWidth=a.style.width;a._originalHeight=a.style.height;a.style.position=
"absolute";a.style.top=c+"px";a.style.left=b+"px";a.style.width=e+"px";a.style.height=g+"px";return a},relativize:function(a){a=$(a);if(Element.getStyle(a,"position")=="relative")return a;a.style.position="relative";var b=parseFloat(a.style.top||0)-(a._originalTop||0),c=parseFloat(a.style.left||0)-(a._originalLeft||0);a.style.top=b+"px";a.style.left=c+"px";a.style.height=a._originalHeight;a.style.width=a._originalWidth;return a},cumulativeScrollOffset:function(a){var b=0,c=0;do{b+=a.scrollTop||0;
c+=a.scrollLeft||0;a=a.parentNode}while(a);return Element._returnOffset(c,b)},getOffsetParent:function(a){if(a.offsetParent)return $(a.offsetParent);if(a==document.body)return $(a);for(;(a=a.parentNode)&&a!=document.body;)if(Element.getStyle(a,"position")!="static")return $(a);return $(document.body)},viewportOffset:function(a){var b=0,c=0,e=a;do{b+=e.offsetTop||0;c+=e.offsetLeft||0;if(e.offsetParent==document.body&&Element.getStyle(e,"position")=="absolute")break}while(e=e.offsetParent);e=a;do if(!Prototype.Browser.Opera||
e.tagName&&e.tagName.toUpperCase()=="BODY"){b-=e.scrollTop||0;c-=e.scrollLeft||0}while(e=e.parentNode);return Element._returnOffset(c,b)},clonePosition:function(a,b,c){c=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},c||{});b=$(b);var e=Element.viewportOffset(b),g=[0,0],j=null;a=$(a);if(Element.getStyle(a,"position")=="absolute"){j=Element.getOffsetParent(a);g=Element.viewportOffset(j)}if(j==document.body){g[0]-=document.body.offsetLeft;g[1]-=document.body.offsetTop}if(c.setLeft)a.style.left=
e[0]-g[0]+c.offsetLeft+"px";if(c.setTop)a.style.top=e[1]-g[1]+c.offsetTop+"px";if(c.setWidth)a.style.width=b.offsetWidth+"px";if(c.setHeight)a.style.height=b.offsetHeight+"px";return a}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(a,b,c){switch(c){case "left":case "top":case "right":case "bottom":if(a(b,"position")==="static")return null;case "height":case "width":if(!Element.visible(b))return null;var e=parseInt(a(b,c),10);if(e!==b["offset"+c.capitalize()])return e+"px";return(c==="height"?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(e,
function(g,j){j=a(b,j);return j===null?g:g-parseInt(j,10)})+"px";default:return a(b,c)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(a,b,c){if(c==="title")return b.title;return a(b,c)})}else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(a,b){b=$(b);if(!b.parentNode)return $(document.body);var c=b.getStyle("position");if(c!=="static")return a(b);b.setStyle({position:"relative"});a=a(b);b.setStyle({position:c});
return a});$w("positionedOffset viewportOffset").each(function(a){Element.Methods[a]=Element.Methods[a].wrap(function(b,c){c=$(c);if(!c.parentNode)return Element._returnOffset(0,0);var e=c.getStyle("position");if(e!=="static")return b(c);var g=c.getOffsetParent();g&&g.getStyle("position")==="fixed"&&g.setStyle({zoom:1});c.setStyle({position:"relative"});b=b(c);c.setStyle({position:e});return b})});Element.Methods.getStyle=function(a,b){a=$(a);b=b=="float"||b=="cssFloat"?"styleFloat":b.camelize();
var c=a.style[b];if(!c&&a.currentStyle)c=a.currentStyle[b];if(b=="opacity"){if(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))if(c[1])return parseFloat(c[1])/100;return 1}if(c=="auto"){if((b=="width"||b=="height")&&a.getStyle("display")!="none")return a["offset"+b.capitalize()]+"px";return null}return c};Element.Methods.setOpacity=function(a,b){function c(j){return j.replace(/alpha\([^\)]*\)/gi,"")}a=$(a);var e=a.currentStyle;if(e&&!e.hasLayout||!e&&a.style.zoom=="normal")a.style.zoom=
1;e=a.getStyle("filter");var g=a.style;if(b==1||b===""){(e=c(e))?(g.filter=e):g.removeAttribute("filter");return a}else if(b<1.0E-5)b=0;g.filter=c(e)+"alpha(opacity="+b*100+")";return a};Element._attributeTranslations=function(){var a="className",b="for",c=document.createElement("div");c.setAttribute(a,"x");if(c.className!=="x"){c.setAttribute("class","x");if(c.className==="x")a="class"}c=null;c=document.createElement("label");c.setAttribute(b,"x");if(c.htmlFor!=="x"){c.setAttribute("htmlFor","x");
if(c.htmlFor==="x")b="htmlFor"}c=null;return{read:{names:{"class":a,className:a,"for":b,htmlFor:b},values:{_getAttr:function(e,g){return e.getAttribute(g)},_getAttr2:function(e,g){return e.getAttribute(g,2)},_getAttrNode:function(e,g){return(e=e.getAttributeNode(g))?e.value:""},_getEv:function(){var e=document.createElement("div"),g;e.onclick=Prototype.emptyFunction;e=e.getAttribute("onclick");if(String(e).indexOf("{")>-1)g=function(j,n){n=j.getAttribute(n);if(!n)return null;n=n.toString();n=n.split("{")[1];
n=n.split("}")[0];return n.strip()};else if(e==="")g=function(j,n){n=j.getAttribute(n);if(!n)return null;return n.strip()};e=null;return g}(),_flag:function(e,g){return $(e).hasAttribute(g)?g:null},style:function(e){return e.style.cssText.toLowerCase()},title:function(e){return e.title}}}}}();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,
b){a.style.cssText=b?b:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,
onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values);Prototype.BrowserFeatures.ElementExtensions&&function(){function a(b){b=b.getElementsByTagName("*");for(var c=[],e=0,g;g=b[e];e++)g.tagName!=="!"&&c.push(g);
return c}Element.Methods.down=function(b,c,e){b=$(b);if(arguments.length==1)return b.firstDescendant();return Object.isNumber(c)?a(b)[c]:Element.select(b,c)[e||0]}}()}else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent))Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=b==1?0.999999:b===""?"":b<1.0E-5?0:b;return a};else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;if(b==1)if(a.tagName.toUpperCase()==
"IMG"&&a.width){a.width++;a.width--}else try{var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(e){}return a};Element.Methods.cumulativeOffset=function(a){var b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0;if(a.offsetParent==document.body)if(Element.getStyle(a,"position")=="absolute")break;a=a.offsetParent}while(a);return Element._returnOffset(c,b)}}
if("outerHTML"in document.documentElement)Element.Methods.replace=function(a,b){a=$(a);if(b&&b.toElement)b=b.toElement();if(Object.isElement(b)){a.parentNode.replaceChild(b,a);return a}b=Object.toHTML(b);var c=a.parentNode,e=c.tagName.toUpperCase();if(Element._insertionTranslations.tags[e]){var g=a.next();e=Element._getContentFromAnonymousElement(e,b.stripScripts());c.removeChild(a);g?e.each(function(j){c.insertBefore(j,g)}):e.each(function(j){c.appendChild(j)})}else a.outerHTML=b.stripScripts();
b.evalScripts.bind(b).defer();return a};Element._returnOffset=function(a,b){var c=[a,b];c.left=a;c.top=b;return c};Element._getContentFromAnonymousElement=function(a,b){var c=new Element("div");if(a=Element._insertionTranslations.tags[a]){c.innerHTML=a[0]+b+a[1];for(b=a[2];b--;)c=c.firstChild}else c.innerHTML=b;return $A(c.childNodes)};
Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,b){b=Element._attributeTranslations.has[b]||b;a=$(a).getAttributeNode(b);return!!(a&&a.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__){window.HTMLElement={};window.HTMLElement.prototype=a.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}})(document.createElement("div"));
Element.extend=function(){function a(j){if(typeof window.Element!="undefined"){var n=window.Element.prototype;if(n){var q="_"+(Math.random()+"").slice(2);j=document.createElement(j);n[q]="x";j=j[q]!=="x";delete n[q];return j}}return false}function b(j,n){for(var q in n){var x=n[q];if(Object.isFunction(x)&&!(q in j))j[q]=x.methodize()}}var c=a("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(c)return function(j){if(j&&typeof j._extendedByPrototype=="undefined"){var n=j.tagName;
if(n&&/^(?:object|applet|embed)$/i.test(n)){b(j,Element.Methods);b(j,Element.Methods.Simulated);b(j,Element.Methods.ByTag[n.toUpperCase()])}}return j};return Prototype.K}var e={},g=Element.Methods.ByTag;c=Object.extend(function(j){if(!j||typeof j._extendedByPrototype!="undefined"||j.nodeType!=1||j==window)return j;var n=Object.clone(e),q=j.tagName.toUpperCase();g[q]&&Object.extend(n,g[q]);b(j,n);j._extendedByPrototype=Prototype.emptyFunction;return j},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(e,
Element.Methods);Object.extend(e,Element.Methods.Simulated)}}});c.refresh();return c}();Element.hasAttribute=document.documentElement.hasAttribute?function(a,b){return a.hasAttribute(b)}:Element.Methods.Simulated.hasAttribute;
Element.addMethods=function(a){function b(x){x=x.toUpperCase();Element.Methods.ByTag[x]||(Element.Methods.ByTag[x]={});Object.extend(Element.Methods.ByTag[x],a)}function c(x,F,C){C=C||false;for(var i in x){var r=x[i];if(Object.isFunction(r))if(!C||!(i in F))F[i]=r.methodize()}}function e(x){var F,C={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",
Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(C[x])F="HTML"+C[x]+"Element";if(window[F])return window[F];F="HTML"+x+"Element";if(window[F])return window[F];F="HTML"+x.capitalize()+"Element";if(window[F])return window[F];x=document.createElement(x);return x.__proto__||x.constructor.prototype}
var g=Prototype.BrowserFeatures,j=Element.Methods.ByTag;if(!a){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var n=a;a=arguments[1]}if(n)Object.isArray(n)?n.each(b):b(n);else Object.extend(Element.Methods,a||{});n=window.HTMLElement?HTMLElement.prototype:
Element.prototype;if(g.ElementExtensions){c(Element.Methods,n);c(Element.Methods.Simulated,n,true)}if(g.SpecificElementExtensions)for(var q in Element.Methods.ByTag){g=e(q);Object.isUndefined(g)||c(j[q],g.prototype)}Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(a){function b(){if(e.WebKit&&!g.evaluate)return document;if(e.Opera&&window.parseFloat(window.opera.version())<9.5)return document.body;return document.documentElement}function c(q){j||(j=b());n[q]="client"+q;a["get"+q]=function(){return j[n[q]]};return a["get"+q]()}var e=Prototype.Browser,g=document,j,n={};a.getWidth=c.curry("Width");a.getHeight=c.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(a){if(a=$(a)){if(a===window)a=0;else{if(typeof a._prototypeUID==="undefined")a._prototypeUID=Element.Storage.UID++;a=a._prototypeUID}Element.Storage[a]||(Element.Storage[a]=$H());return Element.Storage[a]}},store:function(a,b,c){if(a=$(a)){arguments.length===2?Element.getStorage(a).update(b):Element.getStorage(a).set(b,c);return a}},retrieve:function(a,b,c){if(a=$(a)){a=Element.getStorage(a);var e=a.get(b);if(Object.isUndefined(e)){a.set(b,c);e=c}return e}},
clone:function(a,b){if(a=$(a)){a=a.cloneNode(b);a._prototypeUID=void 0;if(b){b=Element.select(a,"*");for(var c=b.length;c--;)b[c]._prototypeUID=void 0}return Element.extend(a)}},purge:function(a){if(a=$(a)){purgeElement(a);a=a.getElementsByTagName("*");for(var b=a.length;b--;)purgeElement(a[b]);return null}}});
(function(){function a(d){d=d.match(/^(\d+)%?$/i);if(!d)return null;return Number(d[1])/100}function b(d,f){if(Object.isElement(d)){element=d;d=element.getStyle(f)}if(d===null)return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(d))return window.parseFloat(d);if(/\d/.test(d)&&element.runtimeStyle){f=element.style.left;var l=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=d||0;d=element.style.pixelLeft;element.style.left=f;element.runtimeStyle.left=l;return d}if(d.include("%")){d=
a(d);if(f.include("left")||f.include("right")||f.include("width"))l=$(element.parentNode).measure("width");else if(f.include("top")||f.include("bottom")||f.include("height"))l=$(element.parentNode).measure("height");return l*d}return 0}function c(d){for(;d&&d.parentNode;){if(d.getStyle("display")==="none")return false;d=$(d.parentNode)}return true}function e(d){if(d.include("border"))d+="-width";return d.camelize()}function g(d,f){return new Element.Layout(d,f)}function j(d,f){return $(d).getLayout().get(f)}
function n(d){d=$(d).getLayout();return{width:d.get("width"),height:d.get("height")}}function q(d){if(u(d))return $(document.body);if(Element.getStyle(d,"display")!=="inline"&&d.offsetParent)return $(d.offsetParent);if(d===document.body)return $(d);for(;(d=d.parentNode)&&d!==document.body;)if(Element.getStyle(d,"position")!=="static")return d.nodeName==="HTML"?$(document.body):$(d);return $(document.body)}function x(d){var f=0,l=0;do{f+=d.offsetTop||0;l+=d.offsetLeft||0;d=d.offsetParent}while(d);
return new Element.Offset(l,f)}function F(d){var f=d.getLayout(),l=0,m=0;do{l+=d.offsetTop||0;m+=d.offsetLeft||0;if(d=d.offsetParent){if(A(d))break;if(Element.getStyle(d,"position")!=="static")break}}while(d);m-=f.get("margin-top");l-=f.get("margin-left");return new Element.Offset(m,l)}function C(d){var f=0,l=0;do{f+=d.scrollTop||0;l+=d.scrollLeft||0;d=d.parentNode}while(d);return new Element.Offset(l,f)}function i(d){var f=0,l=0,m=document.body,w=d;do{f+=w.offsetTop||0;l+=w.offsetLeft||0;if(w.offsetParent==
m&&Element.getStyle(w,"position")=="absolute")break}while(w=w.offsetParent);w=d;do if(w!=m){f-=w.scrollTop||0;l-=w.scrollLeft||0}while(w=w.parentNode);return new Element.Offset(l,f)}function r(d){d=$(d);if(Element.getStyle(d,"position")==="absolute")return d;var f=q(d),l=d.viewportOffset();f=f.viewportOffset();l=l.relativeTo(f);f=d.getLayout();d.store("prototype_absolutize_original_styles",{left:d.getStyle("left"),top:d.getStyle("top"),width:d.getStyle("width"),height:d.getStyle("height")});d.setStyle({position:"absolute",
top:l.top+"px",left:l.left+"px",width:f.get("width")+"px",height:f.get("height")+"px"});return d}function y(d){d=$(d);if(Element.getStyle(d,"position")==="relative")return d;var f=d.retrieve("prototype_absolutize_original_styles");f&&d.setStyle(f);return d}function A(d){return d.nodeName.toUpperCase()==="BODY"}function u(d){return d!==document.body&&!Element.descendantOf(d,document.body)}var z=Prototype.K;if("currentStyle"in document.documentElement)z=function(d){if(!d.currentStyle.hasLayout)d.style.zoom=
1;return d};Element.Layout=Class.create(Hash,{initialize:function($super,f,l){$super();this.element=$(f);Element.Layout.PROPERTIES.each(function(m){this._set(m,null)},this);if(l){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(d,f){return Hash.prototype.set.call(this,d,f)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,f){var l=$super(f);return l===null?this._compute(f):
l},_begin:function(){if(!this._prepared){var d=this.element;if(!c(d)){d.store("prototype_original_styles",{position:d.style.position||"",width:d.style.width||"",visibility:d.style.visibility||"",display:d.style.display||""});var f=d.getStyle("position"),l=d.getStyle("width");d.setStyle({position:"absolute",visibility:"hidden",display:"block"});var m=d.getStyle("width");f=l&&m===l?b(l):l&&(f==="absolute"||f==="fixed")?b(l):$(d.parentNode).getLayout().get("width")-this.get("margin-left")-this.get("border-left")-
this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");d.setStyle({width:f+"px"})}this._prepared=true}},_end:function(){var d=this.element,f=d.retrieve("prototype_original_styles");d.store("prototype_original_styles",null);d.setStyle(f);this._prepared=false},_compute:function(d){var f=Element.Layout.COMPUTATIONS;if(!(d in f))throw"Property not found.";return this._set(d,f[d].call(this,this.element))},toObject:function(){var d=$A(arguments),f={};(d.length===
0?Element.Layout.PROPERTIES:d.join(" ").split(" ")).each(function(l){if(Element.Layout.PROPERTIES.include(l)){var m=this.get(l);if(m!=null)f[l]=m}},this);return f},toHash:function(){var d=this.toObject.apply(this,arguments);return new Hash(d)},toCSS:function(){var d=$A(arguments),f={};(d.length===0?Element.Layout.PROPERTIES:d.join(" ").split(" ")).each(function(l){if(Element.Layout.PROPERTIES.include(l))if(!Element.Layout.COMPOSITE_PROPERTIES.include(l)){var m=this.get(l);if(m!=null)f[e(l)]=m+"px"}},
this);return f},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),
COMPUTATIONS:{height:function(){this._preComputing||this._begin();var d=this.get("border-box-height");if(d<=0)return 0;var f=this.get("border-top"),l=this.get("border-bottom"),m=this.get("padding-top"),w=this.get("padding-bottom");this._preComputing||this._end();return d-f-l-m-w},width:function(){this._preComputing||this._begin();var d=this.get("border-box-width");if(d<=0)return 0;var f=this.get("border-left"),l=this.get("border-right"),m=this.get("padding-left"),w=this.get("padding-right");this._preComputing||
this._end();return d-f-l-m-w},"padding-box-height":function(){var d=this.get("height"),f=this.get("padding-top"),l=this.get("padding-bottom");return d+f+l},"padding-box-width":function(){var d=this.get("width"),f=this.get("padding-left"),l=this.get("padding-right");return d+f+l},"border-box-height":function(d){return d.offsetHeight},"border-box-width":function(d){return d.offsetWidth},"margin-box-height":function(){var d=this.get("border-box-height"),f=this.get("margin-top"),l=this.get("margin-bottom");
if(d<=0)return 0;return d+f+l},"margin-box-width":function(){var d=this.get("border-box-width"),f=this.get("margin-left"),l=this.get("margin-right");if(d<=0)return 0;return d+f+l},top:function(d){return d.positionedOffset().top},bottom:function(d){var f=d.positionedOffset();d=d.getOffsetParent().measure("height");var l=this.get("border-box-height");return d-l-f.top},left:function(d){return d.positionedOffset().left},right:function(d){var f=d.positionedOffset();d=d.getOffsetParent().measure("width");
var l=this.get("border-box-width");return d-l-f.left},"padding-top":function(d){return b(d,"paddingTop")},"padding-bottom":function(d){return b(d,"paddingBottom")},"padding-left":function(d){return b(d,"paddingLeft")},"padding-right":function(d){return b(d,"paddingRight")},"border-top":function(d){return Object.isNumber(d.clientTop)?d.clientTop:b(d,"borderTopWidth")},"border-bottom":function(d){return Object.isNumber(d.clientBottom)?d.clientBottom:b(d,"borderBottomWidth")},"border-left":function(d){return Object.isNumber(d.clientLeft)?
d.clientLeft:b(d,"borderLeftWidth")},"border-right":function(d){return Object.isNumber(d.clientRight)?d.clientRight:b(d,"borderRightWidth")},"margin-top":function(d){return b(d,"marginTop")},"margin-bottom":function(d){return b(d,"marginBottom")},"margin-left":function(d){return b(d,"marginLeft")},"margin-right":function(d){return b(d,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(d){var f=z(d.getOffsetParent());d=d.getBoundingClientRect();
return(f.getBoundingClientRect().right-d.right).round()},bottom:function(d){var f=z(d.getOffsetParent());d=d.getBoundingClientRect();return(f.getBoundingClientRect().bottom-d.bottom).round()}});Element.Offset=Class.create({initialize:function(d,f){this.left=d.round();this.top=f.round();this[0]=this.left;this[1]=this.top},relativeTo:function(d){return new Element.Offset(this.left-d.left,this.top-d.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},
toArray:function(){return[this.left,this.top]}});Element.addMethods({getLayout:g,measure:j,getDimensions:n,getOffsetParent:q,cumulativeOffset:x,positionedOffset:F,cumulativeScrollOffset:C,viewportOffset:i,absolutize:r,relativize:y});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(d){d=$(d);if(u(d))return new Element.Offset(0,0);d=d.getBoundingClientRect();var f=document.documentElement;return new Element.Offset(d.left-f.clientLeft,d.top-f.clientTop)},
positionedOffset:function(d){d=$(d);var f=d.getOffsetParent();if(u(d))return new Element.Offset(0,0);if(d.offsetParent&&d.offsetParent.nodeName.toUpperCase()==="HTML")return F(d);var l=d.viewportOffset();f=A(f)?i(f):f.viewportOffset();l=l.relativeTo(f);f=d.getLayout();d=l.top-f.get("margin-top");l=l.left-f.get("margin-left");return new Element.Offset(l,d)}})})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};
Prototype.Selector=function(){function a(){throw new Error('Method "Prototype.Selector.select" must be defined.');}function b(){throw new Error('Method "Prototype.Selector.match" must be defined.');}function c(j,n,q){q=q||0;var x=Prototype.Selector.match,F=j.length,C=0,i;for(i=0;i<F;i++)if(x(j[i],n)&&q==C++)return Element.extend(j[i])}function e(j){for(var n=0,q=j.length;n<q;n++)Element.extend(j[n]);return j}var g=Prototype.K;return{select:a,match:b,find:c,extendElements:Element.extend===g?g:e,extendElement:Element.extend}}();
Prototype._original_property=window.Sizzle;
(function(){function a(d,f,l,m,w,o){w=d=="previousSibling"&&!o;for(var s=0,p=m.length;s<p;s++){var h=m[s];if(h){if(w&&h.nodeType===1){h.sizcache=l;h.sizset=s}h=h[d];for(var v=false;h;){if(h.sizcache===l){v=m[h.sizset];break}if(h.nodeType===1&&!o){h.sizcache=l;h.sizset=s}if(h.nodeName===f){v=h;break}h=h[d]}m[s]=v}}}function b(d,f,l,m,w,o){w=d=="previousSibling"&&!o;for(var s=0,p=m.length;s<p;s++){var h=m[s];if(h){if(w&&h.nodeType===1){h.sizcache=l;h.sizset=s}h=h[d];for(var v=false;h;){if(h.sizcache===
l){v=m[h.sizset];break}if(h.nodeType===1){if(!o){h.sizcache=l;h.sizset=s}if(typeof f!=="string"){if(h===f){v=true;break}}else if(q.filter(f,[h]).length>0){v=h;break}}h=h[d]}m[s]=v}}}var c=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,g=Object.prototype.toString,j=false,n=true;[0,0].sort(function(){n=false;return 0});var q=function(d,f,l,m){l=l||[];var w=f=f||document;if(f.nodeType!==1&&f.nodeType!==9)return[];
if(!d||typeof d!=="string")return l;for(var o=[],s,p,h,v,E=true,L=u(f),I=d;(c.exec(""),s=c.exec(I))!==null;){I=s[3];o.push(s[1]);if(s[2]){v=s[3];break}}if(o.length>1&&F.exec(d))if(o.length===2&&x.relative[o[0]])p=z(o[0]+o[1],f);else for(p=x.relative[o[0]]?[f]:q(o.shift(),f);o.length;){d=o.shift();if(x.relative[d])d+=o.shift();p=z(d,p)}else{if(!m&&o.length>1&&f.nodeType===9&&!L&&x.match.ID.test(o[0])&&!x.match.ID.test(o[o.length-1])){s=q.find(o.shift(),f,L);f=s.expr?q.filter(s.expr,s.set)[0]:s.set[0]}if(f){s=
m?{expr:o.pop(),set:i(m)}:q.find(o.pop(),o.length===1&&(o[0]==="~"||o[0]==="+")&&f.parentNode?f.parentNode:f,L);p=s.expr?q.filter(s.expr,s.set):s.set;if(o.length>0)h=i(p);else E=false;for(;o.length;){var D=o.pop();s=D;if(x.relative[D])s=o.pop();else D="";if(s==null)s=f;x.relative[D](h,s,L)}}else h=[]}h||(h=p);if(!h)throw"Syntax error, unrecognized expression: "+(D||d);if(g.call(h)==="[object Array]")if(E)if(f&&f.nodeType===1)for(d=0;h[d]!=null;d++){if(h[d]&&(h[d]===true||h[d].nodeType===1&&A(f,h[d])))l.push(p[d])}else for(d=
0;h[d]!=null;d++)h[d]&&h[d].nodeType===1&&l.push(p[d]);else l.push.apply(l,h);else i(h,l);if(v){q(v,w,l,m);q.uniqueSort(l)}return l};q.uniqueSort=function(d){if(y){j=n;d.sort(y);if(j)for(var f=1;f<d.length;f++)d[f]===d[f-1]&&d.splice(f--,1)}return d};q.matches=function(d,f){return q(d,null,null,f)};q.find=function(d,f,l){var m,w;if(!d)return[];for(var o=0,s=x.order.length;o<s;o++){var p=x.order[o];if(w=x.leftMatch[p].exec(d)){var h=w[1];w.splice(1,1);if(h.substr(h.length-1)!=="\\"){w[1]=(w[1]||"").replace(/\\/g,
"");m=x.find[p](w,f,l);if(m!=null){d=d.replace(x.match[p],"");break}}}}m||(m=f.getElementsByTagName("*"));return{set:m,expr:d}};q.filter=function(d,f,l,m){for(var w=d,o=[],s=f,p,h,v=f&&f[0]&&u(f[0]);d&&f.length;){for(var E in x.filter)if((p=x.match[E].exec(d))!=null){var L=x.filter[E],I,D;h=false;if(s==o)o=[];if(x.preFilter[E])if(p=x.preFilter[E](p,s,l,o,m,v)){if(p===true)continue}else h=I=true;if(p)for(var H=0;(D=s[H])!=null;H++)if(D){I=L(D,p,H,s);var B=m^!!I;if(l&&I!=null)if(B)h=true;else s[H]=
false;else if(B){o.push(D);h=true}}if(I!==undefined){l||(s=o);d=d.replace(x.match[E],"");if(!h)return[];break}}if(d==w)if(h==null)throw"Syntax error, unrecognized expression: "+d;else break;w=d}return s};var x=q.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,
CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(d){return d.getAttribute("href")}},relative:{"+":function(d,f,l){var m=typeof f==="string",w=m&&!/\W/.test(f);m=m&&!w;if(w&&!l)f=f.toUpperCase();l=0;w=d.length;for(var o;l<w;l++)if(o=d[l]){for(;(o=o.previousSibling)&&
o.nodeType!==1;);d[l]=m||o&&o.nodeName===f?o||false:o===f}m&&q.filter(f,d,true)},">":function(d,f,l){var m=typeof f==="string";if(m&&!/\W/.test(f)){f=l?f:f.toUpperCase();l=0;for(var w=d.length;l<w;l++){var o=d[l];if(o){m=o.parentNode;d[l]=m.nodeName===f?m:false}}}else{l=0;for(w=d.length;l<w;l++)if(o=d[l])d[l]=m?o.parentNode:o.parentNode===f;m&&q.filter(f,d,true)}},"":function(d,f,l){var m=e++,w=b;if(!/\W/.test(f)){var o=f=l?f:f.toUpperCase();w=a}w("parentNode",f,m,d,o,l)},"~":function(d,f,l){var m=
e++,w=b;if(typeof f==="string"&&!/\W/.test(f)){var o=f=l?f:f.toUpperCase();w=a}w("previousSibling",f,m,d,o,l)}},find:{ID:function(d,f,l){if(typeof f.getElementById!=="undefined"&&!l)return(d=f.getElementById(d[1]))?[d]:[]},NAME:function(d,f){if(typeof f.getElementsByName!=="undefined"){var l=[];f=f.getElementsByName(d[1]);for(var m=0,w=f.length;m<w;m++)f[m].getAttribute("name")===d[1]&&l.push(f[m]);return l.length===0?null:l}},TAG:function(d,f){return f.getElementsByTagName(d[1])}},preFilter:{CLASS:function(d,
f,l,m,w,o){d=" "+d[1].replace(/\\/g,"")+" ";if(o)return d;o=0;for(var s;(s=f[o])!=null;o++)if(s)if(w^(s.className&&(" "+s.className+" ").indexOf(d)>=0))l||m.push(s);else if(l)f[o]=false;return false},ID:function(d){return d[1].replace(/\\/g,"")},TAG:function(d,f){for(var l=0;f[l]===false;l++);return f[l]&&u(f[l])?d[1]:d[1].toUpperCase()},CHILD:function(d){if(d[1]=="nth"){var f=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(d[2]=="even"&&"2n"||d[2]=="odd"&&"2n+1"||!/\D/.test(d[2])&&"0n+"+d[2]||d[2]);d[2]=f[1]+(f[2]||
1)-0;d[3]=f[3]-0}d[0]=e++;return d},ATTR:function(d,f,l,m,w,o){f=d[1].replace(/\\/g,"");if(!o&&x.attrMap[f])d[1]=x.attrMap[f];if(d[2]==="~=")d[4]=" "+d[4]+" ";return d},PSEUDO:function(d,f,l,m,w){if(d[1]==="not")if((c.exec(d[3])||"").length>1||/^\w/.test(d[3]))d[3]=q(d[3],null,null,f);else{d=q.filter(d[3],f,l,true^w);l||m.push.apply(m,d);return false}else if(x.match.POS.test(d[0])||x.match.CHILD.test(d[0]))return true;return d},POS:function(d){d.unshift(true);return d}},filters:{enabled:function(d){return d.disabled===
false&&d.type!=="hidden"},disabled:function(d){return d.disabled===true},checked:function(d){return d.checked===true},selected:function(d){return d.selected===true},parent:function(d){return!!d.firstChild},empty:function(d){return!d.firstChild},has:function(d,f,l){return!!q(l[3],d).length},header:function(d){return/h\d/i.test(d.nodeName)},text:function(d){return"text"===d.type},radio:function(d){return"radio"===d.type},checkbox:function(d){return"checkbox"===d.type},file:function(d){return"file"===
d.type},password:function(d){return"password"===d.type},submit:function(d){return"submit"===d.type},image:function(d){return"image"===d.type},reset:function(d){return"reset"===d.type},button:function(d){return"button"===d.type||d.nodeName.toUpperCase()==="BUTTON"},input:function(d){return/input|select|textarea|button/i.test(d.nodeName)}},setFilters:{first:function(d,f){return f===0},last:function(d,f,l,m){return f===m.length-1},even:function(d,f){return f%2===0},odd:function(d,f){return f%2===1},
lt:function(d,f,l){return f<l[3]-0},gt:function(d,f,l){return f>l[3]-0},nth:function(d,f,l){return l[3]-0==f},eq:function(d,f,l){return l[3]-0==f}},filter:{PSEUDO:function(d,f,l,m){var w=f[1],o=x.filters[w];if(o)return o(d,l,f,m);else if(w==="contains")return(d.textContent||d.innerText||"").indexOf(f[3])>=0;else if(w==="not"){f=f[3];l=0;for(m=f.length;l<m;l++)if(f[l]===d)return false;return true}},CHILD:function(d,f){var l=f[1],m=d;switch(l){case "only":case "first":for(;m=m.previousSibling;)if(m.nodeType===
1)return false;if(l=="first")return true;m=d;case "last":for(;m=m.nextSibling;)if(m.nodeType===1)return false;return true;case "nth":l=f[2];var w=f[3];if(l==1&&w==0)return true;f=f[0];var o=d.parentNode;if(o&&(o.sizcache!==f||!d.nodeIndex)){var s=0;for(m=o.firstChild;m;m=m.nextSibling)if(m.nodeType===1)m.nodeIndex=++s;o.sizcache=f}d=d.nodeIndex-w;return l==0?d==0:d%l==0&&d/l>=0}},ID:function(d,f){return d.nodeType===1&&d.getAttribute("id")===f},TAG:function(d,f){return f==="*"&&d.nodeType===1||d.nodeName===
f},CLASS:function(d,f){return(" "+(d.className||d.getAttribute("class"))+" ").indexOf(f)>-1},ATTR:function(d,f){var l=f[1];d=x.attrHandle[l]?x.attrHandle[l](d):d[l]!=null?d[l]:d.getAttribute(l);l=d+"";var m=f[2];f=f[4];return d==null?m==="!=":m==="="?l===f:m==="*="?l.indexOf(f)>=0:m==="~="?(" "+l+" ").indexOf(f)>=0:!f?l&&d!==false:m==="!="?l!=f:m==="^="?l.indexOf(f)===0:m==="$="?l.substr(l.length-f.length)===f:m==="|="?l===f||l.substr(0,f.length+1)===f+"-":false},POS:function(d,f,l,m){var w=x.setFilters[f[2]];
if(w)return w(d,l,f,m)}}},F=x.match.POS;for(var C in x.match){x.match[C]=new RegExp(x.match[C].source+/(?![^\[]*\])(?![^\(]*\))/.source);x.leftMatch[C]=new RegExp(/(^(?:.|\r|\n)*?)/.source+x.match[C].source)}var i=function(d,f){d=Array.prototype.slice.call(d,0);if(f){f.push.apply(f,d);return f}return d};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(r){i=function(d,f){f=f||[];if(g.call(d)==="[object Array]")Array.prototype.push.apply(f,d);else if(typeof d.length==="number")for(var l=
0,m=d.length;l<m;l++)f.push(d[l]);else for(l=0;d[l];l++)f.push(d[l]);return f}}var y;if(document.documentElement.compareDocumentPosition)y=function(d,f){if(!d.compareDocumentPosition||!f.compareDocumentPosition){if(d==f)j=true;return 0}d=d.compareDocumentPosition(f)&4?-1:d===f?0:1;if(d===0)j=true;return d};else if("sourceIndex"in document.documentElement)y=function(d,f){if(!d.sourceIndex||!f.sourceIndex){if(d==f)j=true;return 0}d=d.sourceIndex-f.sourceIndex;if(d===0)j=true;return d};else if(document.createRange)y=
function(d,f){if(!d.ownerDocument||!f.ownerDocument){if(d==f)j=true;return 0}var l=d.ownerDocument.createRange(),m=f.ownerDocument.createRange();l.setStart(d,0);l.setEnd(d,0);m.setStart(f,0);m.setEnd(f,0);d=l.compareBoundaryPoints(Range.START_TO_END,m);if(d===0)j=true;return d};(function(){var d=document.createElement("div"),f="script"+(new Date).getTime();d.innerHTML="<a name='"+f+"'/>";var l=document.documentElement;l.insertBefore(d,l.firstChild);if(document.getElementById(f)){x.find.ID=function(m,
w,o){if(typeof w.getElementById!=="undefined"&&!o)return(w=w.getElementById(m[1]))?w.id===m[1]||typeof w.getAttributeNode!=="undefined"&&w.getAttributeNode("id").nodeValue===m[1]?[w]:undefined:[]};x.filter.ID=function(m,w){var o=typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id");return m.nodeType===1&&o&&o.nodeValue===w}}l.removeChild(d);l=d=null})();(function(){var d=document.createElement("div");d.appendChild(document.createComment(""));if(d.getElementsByTagName("*").length>0)x.find.TAG=
function(f,l){l=l.getElementsByTagName(f[1]);if(f[1]==="*"){f=[];for(var m=0;l[m];m++)l[m].nodeType===1&&f.push(l[m]);l=f}return l};d.innerHTML="<a href='#'></a>";if(d.firstChild&&typeof d.firstChild.getAttribute!=="undefined"&&d.firstChild.getAttribute("href")!=="#")x.attrHandle.href=function(f){return f.getAttribute("href",2)};d=null})();document.querySelectorAll&&function(){var d=q,f=document.createElement("div");f.innerHTML="<p class='TEST'></p>";if(!(f.querySelectorAll&&f.querySelectorAll(".TEST").length===
0)){q=function(m,w,o,s){w=w||document;if(!s&&w.nodeType===9&&!u(w))try{return i(w.querySelectorAll(m),o)}catch(p){}return d(m,w,o,s)};for(var l in d)q[l]=d[l];f=null}}();document.getElementsByClassName&&document.documentElement.getElementsByClassName&&function(){var d=document.createElement("div");d.innerHTML="<div class='test e'></div><div class='test'></div>";if(d.getElementsByClassName("e").length!==0){d.lastChild.className="e";if(d.getElementsByClassName("e").length!==1){x.order.splice(1,0,"CLASS");
x.find.CLASS=function(f,l,m){if(typeof l.getElementsByClassName!=="undefined"&&!m)return l.getElementsByClassName(f[1])};d=null}}}();var A=document.compareDocumentPosition?function(d,f){return d.compareDocumentPosition(f)&16}:function(d,f){return d!==f&&(d.contains?d.contains(f):true)},u=function(d){return d.nodeType===9&&d.documentElement.nodeName!=="HTML"||!!d.ownerDocument&&d.ownerDocument.documentElement.nodeName!=="HTML"},z=function(d,f){var l=[],m="",w;for(f=f.nodeType?[f]:f;w=x.match.PSEUDO.exec(d);){m+=
w[0];d=d.replace(x.match.PSEUDO,"")}d=x.relative[d]?d+"*":d;w=0;for(var o=f.length;w<o;w++)q(d,f[w],l);return q.filter(m,l)};window.Sizzle=q})();(function(a){function b(g,j){return e(a(g,j||document))}function c(g,j){return a.matches(j,[g]).length==1}var e=Prototype.Selector.extendElements;Prototype.Selector.engine=a;Prototype.Selector.select=b;Prototype.Selector.match=c})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;
var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(a,b){if(typeof b!="object")b={hash:!!b};else if(Object.isUndefined(b.hash))b.hash=true;var c,e,g=false,j=b.submit,n;if(b.hash){b={};n=function(q,x,F){if(x in q){Object.isArray(q[x])||(q[x]=[q[x]]);q[x].push(F)}else q[x]=F;return q}}else{b="";n=function(q,x,F){return q+(q?"&":"")+encodeURIComponent(x)+"="+encodeURIComponent(F)}}return a.inject(b,function(q,x){if(!x.disabled&&x.name){c=x.name;e=$(x).getValue();if(e!=null&&
x.type!="file"&&(x.type!="submit"||!g&&j!==false&&(!j||c==j)&&(g=true)))q=n(q,c,e)}return q})}};
Form.Methods={serialize:function(a,b){return Form.serializeElements(Form.getElements(a),b)},getElements:function(a){a=$(a).getElementsByTagName("*");for(var b,c=[],e=Form.Element.Serializers,g=0;b=a[g];g++)c.push(b);return c.inject([],function(j,n){e[n.tagName.toLowerCase()]&&j.push(Element.extend(n));return j})},getInputs:function(a,b,c){a=$(a);a=a.getElementsByTagName("input");if(!b&&!c)return $A(a).map(Element.extend);for(var e=0,g=[],j=a.length;e<j;e++){var n=a[e];b&&n.type!=b||c&&n.name!=c||
g.push(Element.extend(n))}return g},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(a){a=$(a).getElements().findAll(function(c){return"hidden"!=c.type&&!c.disabled});var b=a.findAll(function(c){return c.hasAttribute("tabIndex")&&c.tabIndex>=0}).sortBy(function(c){return c.tabIndex}).first();return b?b:a.find(function(c){return/^(?:input|select|textarea)$/i.test(c.tagName)})},
focusFirstElement:function(a){a=$(a);a.findFirstElement().activate();return a},request:function(a,b){a=$(a);b=Object.clone(b||{});var c=b.parameters,e=a.readAttribute("action")||"";if(e.blank())e=window.location.href;b.parameters=a.serialize(true);if(c){if(Object.isString(c))c=c.toQueryParams();Object.extend(b.parameters,c)}if(a.hasAttribute("method")&&!b.method)b.method=a.method;return new Ajax.Request(e,b)}};
Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};
Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();
if(a.select&&(a.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(a.type)))a.select()}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers={input:function(a,b){switch(a.type.toLowerCase()){case "checkbox":case "radio":return Form.Element.Serializers.inputSelector(a,b);default:return Form.Element.Serializers.textarea(a,b)}},inputSelector:function(a,b){if(Object.isUndefined(b))return a.checked?a.value:null;else a.checked=!!b},textarea:function(a,b){if(Object.isUndefined(b))return a.value;else a.value=b},select:function(a,b){if(Object.isUndefined(b))return this[a.type=="select-one"?"selectOne":"selectMany"](a);
else for(var c,e,g=!Object.isArray(b),j=0,n=a.length;j<n;j++){c=a.options[j];e=this.optionValue(c);if(g){if(e==b){c.selected=true;return}}else c.selected=b.include(e)}},selectOne:function(a){var b=a.selectedIndex;return b>=0?this.optionValue(a.options[b]):null},selectMany:function(a){var b,c=a.length;if(!c)return null;var e=0;for(b=[];e<c;e++){var g=a.options[e];g.selected&&b.push(this.optionValue(g))}return b},optionValue:function(a){return Element.extend(a).hasAttribute("value")?a.value:a.text}};
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,b,c,e){$super(e,c);this.element=$(b);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case "checkbox":case "radio":Event.observe(a,
"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function a(h){return f(h,0)}function b(h){return f(h,1)}function c(h){return f(h,2)}function e(h){h=u.extend(h);var v=h.target,E=h.type;if((h=h.currentTarget)&&h.tagName)if(E==="load"||E==="error"||E==="click"&&h.tagName.toLowerCase()==="input"&&h.type==="radio")v=h;if(v.nodeType==Node.TEXT_NODE)v=v.parentNode;return Element.extend(v)}function g(h,v){h=u.element(h);if(!v)return h;for(;h;){if(Object.isElement(h)&&Prototype.Selector.match(h,v))return Element.extend(h);h=h.parentNode}}function j(h){return{x:n(h),
y:q(h)}}function n(h){var v=document.documentElement,E=document.body||{scrollLeft:0};return h.pageX||h.clientX+(v.scrollLeft||E.scrollLeft)-(v.clientLeft||0)}function q(h){var v=document.documentElement,E=document.body||{scrollTop:0};return h.pageY||h.clientY+(v.scrollTop||E.scrollTop)-(v.clientTop||0)}function x(h){u.extend(h);h.preventDefault();h.stopPropagation();h.stopped=true}function F(h,v,E){var L=Element.retrieve(h,"prototype_event_registry");if(Object.isUndefined(L)){o.push(h);L=Element.retrieve(h,
"prototype_event_registry",$H())}var I=L.get(v);if(Object.isUndefined(I)){I=[];L.set(v,I)}if(I.pluck("handler").include(E))return false;var D;if(v.include(":"))D=function(H){if(Object.isUndefined(H.eventName))return false;if(H.eventName!==v)return false;u.extend(H,h);E.call(h,H)};else if(!d&&(v==="mouseenter"||v==="mouseleave")){if(v==="mouseenter"||v==="mouseleave")D=function(H){u.extend(H,h);for(var B=H.relatedTarget;B&&B!==h;)try{B=B.parentNode}catch(G){B=h}B!==h&&E.call(h,H)}}else D=function(H){u.extend(H,
h);E.call(h,H)};D.handler=E;I.push(D);return D}function C(){for(var h=0,v=o.length;h<v;h++){u.stopObserving(o[h]);o[h]=null}}function i(h,v,E){h=$(h);E=F(h,v,E);if(!E)return h;if(v.include(":"))if(h.addEventListener)h.addEventListener("dataavailable",E,false);else{h.attachEvent("ondataavailable",E);h.attachEvent("onfilterchange",E)}else{v=s(v);h.addEventListener?h.addEventListener(v,E,false):h.attachEvent("on"+v,E)}return h}function r(h,v,E){h=$(h);var L=Element.retrieve(h,"prototype_event_registry");
if(!L)return h;if(!v){L.each(function(B){r(h,B.key)});return h}var I=L.get(v);if(!I)return h;if(!E){I.each(function(B){r(h,v,B.handler)});return h}var D=I.find(function(B){return B.handler===E});if(!D)return h;if(v.include(":"))if(h.removeEventListener)h.removeEventListener("dataavailable",D,false);else{h.detachEvent("ondataavailable",D);h.detachEvent("onfilterchange",D)}else{var H=s(v);h.removeEventListener?h.removeEventListener(H,D,false):h.detachEvent("on"+H,D)}L.set(v,I.without(D));return h}function y(h,
v,E,L){h=$(h);if(Object.isUndefined(L))L=true;if(h==document&&document.createEvent&&!h.dispatchEvent)h=document.documentElement;var I;if(document.createEvent){I=document.createEvent("HTMLEvents");I.initEvent("dataavailable",true,true)}else{I=document.createEventObject();I.eventType=L?"ondataavailable":"onfilterchange"}I.eventName=v;I.memo=E||{};document.createEvent?h.dispatchEvent(I):h.fireEvent(I.eventType,I);return u.extend(I)}function A(h,v,E,L){h=$(h);if(Object.isFunction(E)&&Object.isUndefined(L)){L=
E;E=null}return(new u.Handler(h,v,E,L)).start()}var u={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},z=document.documentElement,d="onmouseenter"in z&&"onmouseleave"in z,f;if(Prototype.Browser.IE){var l={0:1,1:4,2:2};f=function(h,v){return h.button===l[v]}}else f=Prototype.Browser.WebKit?function(h,v){switch(v){case 0:return h.which==1&&!h.metaKey;case 1:return h.which==
1&&h.metaKey;default:return false}}:function(h,v){return h.which?h.which===v+1:h.button===v};u.Methods={isLeftClick:a,isMiddleClick:b,isRightClick:c,element:e,findElement:g,pointer:j,pointerX:n,pointerY:q,stop:x};var m=Object.keys(u.Methods).inject({},function(h,v){h[v]=u.Methods[v].methodize();return h});if(Prototype.Browser.IE){function w(h){switch(h.type){case "mouseover":h=h.fromElement;break;case "mouseout":h=h.toElement;break;default:return null}return Element.extend(h)}Object.extend(m,{stopPropagation:function(){this.cancelBubble=
true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});u.extend=function(h,v){if(!h)return false;if(h._extendedByPrototype)return h;h._extendedByPrototype=Prototype.emptyFunction;var E=u.pointer(h);Object.extend(h,{target:h.srcElement||v,relatedTarget:w(h),pageX:E.x,pageY:E.y});return Object.extend(h,m)}}else{u.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(u.prototype,m);u.extend=Prototype.K}var o=[];Prototype.Browser.IE&&
window.attachEvent("onunload",C);Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,false);var s=Prototype.K,p={mouseenter:"mouseover",mouseleave:"mouseout"};d||(s=function(h){return p[h]||h});u.Handler=Class.create({initialize:function(h,v,E,L){this.element=$(h);this.eventName=v;this.selector=E;this.callback=L;this.handler=this.handleEvent.bind(this)},start:function(){u.observe(this.element,this.eventName,this.handler);return this},stop:function(){u.stopObserving(this.element,
this.eventName,this.handler);return this},handleEvent:function(h){var v=h.findElement(this.selector);v&&this.callback.call(this.element,h,v)}});Object.extend(u,u.Methods);Object.extend(u,{fire:y,observe:i,stopObserving:r,on:A});Element.addMethods({fire:y,observe:i,stopObserving:r,on:A});Object.extend(document,{fire:y.methodize(),observe:i.methodize(),stopObserving:r.methodize(),on:A.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,u);else window.Event=u})();
(function(){function a(){if(!document.loaded){e&&window.clearTimeout(e);document.loaded=true;document.fire("dom:loaded")}}function b(){if(document.readyState==="complete"){document.stopObserving("readystatechange",b);a()}}function c(){try{document.documentElement.doScroll("left")}catch(g){e=c.defer();return}a()}var e;if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,false);else{document.observe("readystatechange",b);if(window==top)e=c.defer()}Event.observe(window,"load",
a)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||
document.documentElement.scrollTop||document.body.scrollTop||0},within:function(a,b,c){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(a,b,c);this.xcomp=b;this.ycomp=c;this.offset=Element.cumulativeOffset(a);return c>=this.offset[1]&&c<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth},withinIncludingScrolloffsets:function(a,b,c){var e=Element.cumulativeScrollOffset(a);this.xcomp=b+e[0]-this.deltaX;this.ycomp=c+e[1]-this.deltaY;this.offset=Element.cumulativeOffset(a);
return this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if(a=="vertical")return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if(a=="horizontal")return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},
relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(a,b,c){c=c||{};return Element.clonePosition(b,a,c)}};
if(!document.getElementsByClassName)document.getElementsByClassName=function(a){function b(c){return c.blank()?null:"[contains(concat(' ', @class, ' '), ' "+c+" ')]"}a.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(c,e){e=e.toString().strip();return(e=/\s/.test(e)?$w(e).map(b).join(""):b(e))?document._getElementsByXPath(".//*"+e,c):[]}:function(c,e){e=e.toString().strip();var g=[],j=/\s/.test(e)?$w(e):null;if(!j&&!e)return g;c=$(c).getElementsByTagName("*");e=" "+e+" ";for(var n=
0,q,x;q=c[n];n++)if(q.className&&(x=" "+q.className+" ")&&(x.include(e)||j&&j.all(function(F){return!F.toString().blank()&&x.include(" "+F+" ")})))g.push(Element.extend(q));return g};return function(c,e){return $(e||document.body).getElementsByClassName(c)}}(Element.Methods);Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){this.include(a)||this.set($A(this).concat(a).join(" "))},remove:function(a){this.include(a)&&this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(a,b){for(var c=Prototype.Selector.match,e=[],g=0,j=a.length;g<j;g++){var n=a[g];c(n,b)&&e.push(Element.extend(n))}return e},
findElement:function(a,b,c){c=c||0;for(var e=0,g,j=0,n=a.length;j<n;j++){g=a[j];if(Prototype.Selector.match(g,b)&&c===e++)return Element.extend(g)}},findChildElements:function(a,b){b=b.toArray().join(", ");return Prototype.Selector.select(b,a||document)}})})();
document.observe("dom:loaded",function(){function a(c){var e,g,j;if(c.tagName.toLowerCase()==="form"){e=c.readAttribute("method")||"post";g=c.readAttribute("action");j=c.serialize(true)}else{e=c.readAttribute("data-method")||"get";g=c.readAttribute("href");j={}}if(c.fire("ajax:before").stopped)return false;new Ajax.Request(g,{method:e,parameters:j,asynchronous:true,evalScripts:true,onLoading:function(n){c.fire("ajax:loading",{request:n})},onLoaded:function(n){c.fire("ajax:loaded",{request:n})},onInteractive:function(n){c.fire("ajax:interactive",
{request:n})},onComplete:function(n){c.fire("ajax:complete",{request:n})},onSuccess:function(n){c.fire("ajax:success",{request:n})},onFailure:function(n){c.fire("ajax:failure",{request:n})}});c.fire("ajax:after")}function b(c){var e,g;e=c.readAttribute("data-method");g=c.readAttribute("href");csrf_param=$$("meta[name=csrf-param]").first();csrf_token=$$("meta[name=csrf-token]").first();g=new Element("form",{method:"POST",action:g,style:"display: none;"});c.parentNode.appendChild(g);if(e!="post"){c=
new Element("input",{type:"hidden",name:"_method",value:e});g.appendChild(c)}if(csrf_param){e=csrf_param.readAttribute("content");c=csrf_token.readAttribute("content");c=new Element("input",{type:"hidden",name:e,value:c});g.appendChild(c)}g.submit()}$(document.body).observe("click",function(c){var e=c.findElement().readAttribute("data-confirm");if(e&&!confirm(e)){c.stop();return false}if(e=c.findElement("a[data-remote]")){a(e);c.stop();return true}if(e=c.findElement("a[data-method]")){b(e);c.stop();
return true}});$(document.body).observe("submit",function(c){var e=c.findElement(),g=e.readAttribute("data-confirm");if(g&&!confirm(g)){c.stop();return false}e.select("input[type=submit][data-disable-with]").each(function(j){j.disabled=true;j.writeAttribute("data-original-value",j.value);j.value=j.readAttribute("data-disable-with")});if(e=c.findElement("form[data-remote]")){a(e);c.stop()}});$(document.body).observe("ajax:after",function(c){c=c.findElement();c.tagName.toLowerCase()==="form"&&c.select("input[type=submit][disabled=true][data-disable-with]").each(function(e){e.value=
e.readAttribute("data-original-value");e.writeAttribute("data-original-value",null);e.disabled=false})})});var S2={Version:"2.0.0_a6",Extensions:{}};Function.prototype.optionize=function(){var a=this,b=a.argumentNames(),c=this.length-1,e=function(){var g=$A(arguments),j=typeof g.last()==="object"?g.pop():{},n=[];if(c>0)n=(g.length>0?g:[null]).inGroupsOf(c).flatten().concat(j);return a.apply(this,n)};e.argumentNames=function(){return b};return e};
Function.ABSTRACT=function(){throw"Abstract method. Implement in subclass.";};Object.extend(Number.prototype,{constrain:function(a,b){var c=a<b?a:b;a=a<b?b:a;b=Number(this);if(b<c)b=c;if(b>a)b=a;return b},nearer:function(a,b){var c=Number(this),e=Math.abs(c-a);c=Math.abs(c-b);return e<c?a:b},tween:function(a,b){return this+(a-this)*b}});Object.propertize=function(a,b){return Object.isString(a)?b[a]:a};
S2.CSS={PROPERTY_MAP:{backgroundColor:"color",borderBottomColor:"color",borderBottomWidth:"length",borderLeftColor:"color",borderLeftWidth:"length",borderRightColor:"color",borderRightWidth:"length",borderSpacing:"length",borderTopColor:"color",borderTopWidth:"length",bottom:"length",color:"color",fontSize:"length",fontWeight:"integer",height:"length",left:"length",letterSpacing:"length",lineHeight:"length",marginBottom:"length",marginLeft:"length",marginRight:"length",marginTop:"length",maxHeight:"length",
maxWidth:"length",minHeight:"length",minWidth:"length",opacity:"number",outlineColor:"color",outlineOffset:"length",outlineWidth:"length",paddingBottom:"length",paddingLeft:"length",paddingRight:"length",paddingTop:"length",right:"length",textIndent:"length",top:"length",width:"length",wordSpacing:"length",zIndex:"integer",zoom:"number"},LENGTH:/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/,NUMBER:/([\+-]*\d+\.?\d*)/,__parseStyleElement:document.createElement("div"),parseStyle:function(a){S2.CSS.__parseStyleElement.innerHTML=
'<div style="'+a+'"></div>';var b=S2.CSS.__parseStyleElement.childNodes[0].style,c={};S2.CSS.NUMERIC_PROPERTIES.each(function(e){if(b[e])c[e]=b[e]});S2.CSS.COLOR_PROPERTIES.each(function(e){if(b[e])c[e]=S2.CSS.colorFromString(b[e])});if(Prototype.Browser.IE&&a.include("opacity"))c.opacity=a.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1];return c},normalizeColor:function(a){if(!a||a=="rgba(0, 0, 0, 0)"||a=="transparent")a="#ffffff";a=S2.CSS.colorFromString(a);return[parseInt(a.slice(1,3),16),parseInt(a.slice(3,
5),16),parseInt(a.slice(5,7),16)]},colorFromString:function(a,b){var c="#",e;if(a.slice(0,4)=="rgb("){a=a.slice(4,a.length-1).split(",");for(e=3;e--;)c+=parseInt(a[2-e]).toColorPart()}else if(a.slice(0,1)=="#"){if(a.length==4)for(e=1;e<4;e++)c+=(a.charAt(e)+a.charAt(e)).toLowerCase();if(a.length==7)c=a.toLowerCase()}else c=a;return c.length==7?c:b||c},interpolateColor:function(a,b,c){a=S2.CSS.normalizeColor(a);b=S2.CSS.normalizeColor(b);return"#"+[0,1,2].map(function(e){return Math.max(Math.min(a[e].tween(b[e],
c).round(),255),0).toColorPart()}).join("")},interpolateNumber:function(a,b,c){return 1*(a||0).tween(b,c).toFixed(3)},interpolateLength:function(a,b,c){if(!a||parseFloat(a)===0)a="0"+b.gsub(S2.CSS.NUMBER,"");b.scan(S2.CSS.NUMBER,function(e){b=1*e[1]});return a.gsub(S2.CSS.NUMBER,function(e){return(1*parseFloat(e[1]).tween(b,c).toFixed(3)).toString()})},interpolateInteger:function(a,b,c){return parseInt(a).tween(b,c).round()},interpolate:function(a,b,c,e){return S2.CSS["interpolate"+S2.CSS.PROPERTY_MAP[a.camelize()].capitalize()](b,
c,e)},ElementMethods:{getStyles:function(a){var b=document.defaultView.getComputedStyle($(a),null);return S2.CSS.PROPERTIES.inject({},function(c,e){c[e]=b[e];return c})}}};S2.CSS.PROPERTIES=[];for(property in S2.CSS.PROPERTY_MAP)S2.CSS.PROPERTIES.push(property);S2.CSS.NUMERIC_PROPERTIES=S2.CSS.PROPERTIES.findAll(function(a){return!a.endsWith("olor")});S2.CSS.COLOR_PROPERTIES=S2.CSS.PROPERTIES.findAll(function(a){return a.endsWith("olor")});
if(!(document.defaultView&&document.defaultView.getComputedStyle))S2.CSS.ElementMethods.getStyles=function(a){a=$(a);var b=a.currentStyle,c;c=S2.CSS.PROPERTIES.inject({},function(e,g){e[g]=b[g];return e});if(!c.opacity)c.opacity=a.getOpacity();return c};Element.addMethods(S2.CSS.ElementMethods);
S2.FX=function(){function a(q){j[(n+=q)>0?"start":"stop"]()}function b(){e.invoke("render",j.getTimestamp())}function c(q){if(!g){e.push(g=new S2.FX.Queue);S2.FX.DefaultOptions.queue=g;j=q||new S2.FX.Heartbeat;document.observe("effect:heartbeat",b).observe("effect:queued",a.curry(1)).observe("effect:dequeued",a.curry(-1))}}var e=[],g,j,n=0;return{initialize:c,getQueues:function(){return e},addQueue:function(q){e.push(q)},getHeartbeat:function(){return j},setHeartbeat:function(q){j=q}}}();
Object.extend(S2.FX,{DefaultOptions:{transition:"sinusoidal",position:"parallel",fps:60,duration:0.2},elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},parseOptions:function(a){if(Object.isNumber(a))a={duration:a};else if(Object.isFunction(a))a={after:a};else if(Object.isString(a))a={duration:a=="slow"?1:a=="fast"?0.1:0.2};return a||{}}});
S2.FX.Base=Class.create({initialize:function(a){S2.FX.initialize();this.updateWithoutWrappers=this.update;a&&a.queue&&!S2.FX.getQueues().include(a.queue)&&S2.FX.addQueue(a.queue);this.setOptions(a);this.duration=this.options.duration*1E3;this.state="idle";["after","before"].each(function(b){this[b]=function(c){c(this);return this}},this)},setOptions:function(a){a=S2.FX.parseOptions(a);if(!this.options){this.options=Object.extend(Object.extend({},S2.FX.DefaultOptions),a);if(a.tween)this.options.transition=
a.tween}if(this.options.beforeUpdate||this.options.afterUpdate)this.update=this.updateWithoutWrappers.wrap(function(b,c){this.options.beforeUpdate&&this.options.beforeUpdate(this,c);b(c);this.options.afterUpdate&&this.options.afterUpdate(this,c)}.bind(this));if(this.options.transition===false)this.options.transition=S2.FX.Transitions.linear;this.options.transition=Object.propertize(this.options.transition,S2.FX.Transitions)},play:function(a){this.setOptions(a);this.frameCount=0;this.options.queue.add(this);
this.maxFrames=this.options.fps*this.duration/1E3;return this},render:function(a){if(a>=this.startsAt){if(this.state=="idle"){this.options.before&&this.options.before(this);this.setup&&this.setup();this.state="running";this.update(this.options.transition(0));this.frameCount++;return this}if(a>=this.endsAt&&this.state!="finished"){this.update(this.options.transition(1));this.teardown&&this.teardown();this.options.after&&this.options.after(this);this.state="finished"}else if(this.state=="running"){a=
1-(this.endsAt-a)/this.duration;if((this.maxFrames*a).floor()>this.frameCount){this.update(this.options.transition(a));this.frameCount++}}}return this},cancel:function(a){if(!this.state!="running"){this.teardown&&this.teardown();a&&this.options.after&&this.options.after(this);this.state="finished"}},finish:function(){if(!this.state!="running"){this.update(this.options.transition(1));this.cancel(true)}},inspect:function(){return"#<S2.FX:"+[this.state,this.startsAt,this.endsAt].inspect()+">"},update:Prototype.emptyFunction});
S2.FX.Element=Class.create(S2.FX.Base,{initialize:function($super,b,c){if(!(this.element=$(b)))throw S2.FX.elementDoesNotExistError;this.operators=[];return $super(c)},animate:function(){var a=$A(arguments),b=a.shift();b=b.charAt(0).toUpperCase()+b.substring(1);this.operators.push(new S2.FX.Operators[b](this,a[0],a[1]||{}))},play:function($super,b,c){if(b)this.element=$(b);return $super(c)},update:function(a){this.operators.invoke("render",a)}});
S2.FX.Heartbeat=Class.create({initialize:function(a){this.options=Object.extend({framerate:Prototype.Browser.MobileSafari?20:60},a);this.beat=this.beat.bind(this)},start:function(){if(!this.heartbeatInterval){this.heartbeatInterval=setInterval(this.beat,1E3/this.options.framerate);this.updateTimestamp()}},stop:function(){if(this.heartbeatInterval){clearInterval(this.heartbeatInterval);this.timestamp=this.heartbeatInterval=null}},beat:function(){this.updateTimestamp();document.fire("effect:heartbeat")},
getTimestamp:function(){return this.timestamp||this.generateTimestamp()},generateTimestamp:function(){return(new Date).getTime()},updateTimestamp:function(){this.timestamp=this.generateTimestamp()}});
S2.FX.Queue=function(){return function(){function a(){return n}function b(){return n.length>0}function c(q){j(q);n.push(q);document.fire("effect:queued",this);return this}function e(q){n=n.without(q);delete q;document.fire("effect:dequeued",this);return this}function g(q){n.invoke("render",q);n.select(function(x){return x.state=="finished"}).each(e);return this}function j(q){var x=q.options.position||"parallel",F=S2.FX.getHeartbeat().getTimestamp();if(x=="end")F=n.without(q).pluck("endsAt").max()||
F;q.startsAt=F+(q.options.delay||0)*1E3;q.endsAt=q.startsAt+(q.options.duration||1)*1E3}var n=[];Object.extend(this,{getEffects:a,active:b,add:c,remove:e,render:g})}}();S2.FX.Attribute=Class.create(S2.FX.Base,{initialize:function($super,b,c,e,g,j){b=Object.isString(b)?$(b):b;this.method=Object.isFunction(j)?j.bind(b):Object.isFunction(b[j])?b[j].bind(b):function(n){b[j]=n};this.to=e;this.from=c;return $super(g)},update:function(a){this.method(this.from.tween(this.to,a))}});
S2.FX.Style=Class.create(S2.FX.Element,{setup:function(){this.animate("style",this.element,{style:this.options.style})}});S2.FX.Operators={};
S2.FX.Operators.Base=Class.create({initialize:function(a,b,c){this.effect=a;this.object=b;this.options=Object.extend({transition:Prototype.K},c)},inspect:function(){return"#<S2.FX.Operators.Base:"+this.lastValue+">"},setup:function(){},valueAt:function(){},applyValue:function(){},render:function(a){a=this.valueAt(this.options.transition(a));this.applyValue(a);this.lastValue=a}});
S2.FX.Operators.Style=Class.create(S2.FX.Operators.Base,{initialize:function($super,b,c,e){$super(b,c,e);this.element=$(this.object);this.style=Object.isString(this.options.style)?S2.CSS.parseStyle(this.options.style):this.options.style;this.tweens=[];for(var g in this.style){b=g.underscore().dasherize();c=this.element.getStyle(b);e=this.style[g];if(c!=e)this.tweens.push([b,S2.CSS.interpolate.curry(b,c,e),g in this.options.propertyTransitions?Object.propertize(this.options.propertyTransitions[g],
S2.FX.Transitions):Prototype.K])}},valueAt:function(a){return this.tweens.map(function(b){return b[0]+":"+b[1](b[2](a))}).join(";")},applyValue:function(a){if(this.currentStyle!=a){this.element.setStyle(a);this.currentStyle=a}}});
S2.FX.Morph=Class.create(S2.FX.Element,{setup:function(){if(this.options.change)this.setupWrappers();else if(this.options.style)this.animate("style",this.destinationElement||this.element,{style:this.options.style,propertyTransitions:this.options.propertyTransitions||{}})},teardown:function(){this.options.change&&this.teardownWrappers()},setupWrappers:function(){var a=this.element.getStyle("float"),b,c,e,g;this.transitionElement=(new Element("div")).setStyle({position:"relative",overflow:"hidden",
"float":a});this.element.setStyle({"float":"none"}).insert({before:this.transitionElement});this.sourceElementWrapper=this.element.cloneWithoutIDs().wrap("div");this.destinationElementWrapper=this.element.wrap("div");this.transitionElement.insert(this.sourceElementWrapper).insert(this.destinationElementWrapper);a=this.sourceElementWrapper.getHeight();b=this.sourceElementWrapper.getWidth();this.options.change();c=this.destinationElementWrapper.getHeight();e=this.destinationElementWrapper.getWidth();
this.outerWrapper=new Element("div");this.transitionElement.insert({before:this.outerWrapper});this.outerWrapper.setStyle({overflow:"hidden",height:a+"px",width:b+"px"}).appendChild(this.transitionElement);g=Math.max(c,a);maxWidth=Math.max(e,b);this.transitionElement.setStyle({height:a+"px",width:b+"px"});this.sourceElementWrapper.setStyle({position:"absolute",height:g+"px",width:maxWidth+"px",top:0,left:0});this.destinationElementWrapper.setStyle({position:"absolute",height:g+"px",width:maxWidth+
"px",top:0,left:0,opacity:0,zIndex:2E3});this.outerWrapper.insert({before:this.transitionElement}).remove();this.animate("style",this.transitionElement,{style:"height:"+c+"px; width:"+e+"px"});this.animate("style",this.destinationElementWrapper,{style:"opacity: 1.0"})},teardownWrappers:function(){var a=this.destinationElementWrapper.down();a&&this.transitionElement.insert({before:a});this.transitionElement.remove()}});
S2.FX.Parallel=Class.create(S2.FX.Base,{initialize:function($super,b,c){this.effects=b||[];return $super(c||{})},setup:function(){this.effects.invoke("setup")},update:function(a){this.effects.invoke("update",a)}});S2.FX.Operators.Scroll=Class.create(S2.FX.Operators.Base,{initialize:function($super,b,c,e){$super(b,c,e);this.start=c.scrollTop;this.end=this.options.scrollTo},valueAt:function(a){return this.start+(this.end-this.start)*a},applyValue:function(a){this.object.scrollTop=a.round()}});
S2.FX.Scroll=Class.create(S2.FX.Element,{setup:function(){this.animate("scroll",this.element,{scrollTo:this.options.to})}});
S2.FX.SlideDown=Class.create(S2.FX.Element,{setup:function(){var a=this.destinationElement||this.element,b=a.getLayout();b={height:b.get("height")+"px",paddingTop:b.get("padding-top")+"px",paddingBottom:b.get("padding-bottom")+"px"};a.setStyle({height:"0",paddingTop:"0",paddingBottom:"0",overflow:"hidden"}).show();this.animate("style",a,{style:b,propertyTransitions:{}})},teardown:function(){(this.destinationElement||this.element).setStyle({height:"",paddingTop:"",paddingBottom:"",overflow:"visible"})}});
S2.FX.SlideUp=Class.create(S2.FX.Morph,{setup:function(){var a=this.destinationElement||this.element;a.getLayout();a.setStyle({overflow:"hidden"});this.animate("style",a,{style:{height:"0px",paddingTop:"0px",paddingBottom:"0px"},propertyTransitions:{}})},teardown:function(){(this.destinationElement||this.element).setStyle({height:"",paddingTop:"",paddingBottom:"",overflow:"visible"}).hide()}});
S2.FX.Transitions={linear:Prototype.K,sinusoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},mirror:function(a,b){b=b||S2.FX.Transitions.sinusoidal;return a<0.5?b(a*2):b(1-(a-0.5)*2)},flicker:function(a){a+=(Math.random()-0.5)/5;return S2.FX.Transitions.sinusoidal(a<0?0:a>1?1:a)},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){return-Math.cos(a*((b||5)-0.5)*2*Math.PI)/2+0.5},blink:function(a,b){return Math.round(a*(b||5))%2},spring:function(a){return 1-
Math.cos(a*4.5*Math.PI)*Math.exp(-a*6)},none:Prototype.K.curry(0),full:Prototype.K.curry(1)};
(function(){function a(b,c,e,g,j,n){function q(m){return((A*m+u)*m+z)*m}function x(m){return((d*m+f)*m+l)*m}function F(m){return(3*A*m+2*u)*m+z}function C(m){return 1/(200*m)}function i(m,w){return x(y(m,w))}function r(m){return m>=0?m:0-m}function y(m,w){var o,s,p,h;p=m;for(s=0;s<8;s++){h=q(p)-m;if(r(h)<w)return p;o=F(p);if(r(o)<1.0E-6)break;p-=h/o}o=0;s=1;p=m;if(p<o)return o;if(p>s)return s;for(;o<s;){h=q(p);if(r(h-m)<w)return p;if(m>h)o=p;else s=p;p=(s-o)*0.5+o}return p}var A=0,u=0,z=0,d=0,f=0,
l=0;z=3*c;u=3*(g-c)-z;A=1-z-u;l=3*e;f=3*(j-e)-l;d=1-l-f;return i(b,C(n))}S2.FX.cubicBezierTransition=function(b,c,e,g){return function(j){return a(j,b,c,e,g,1)}}})();S2.FX.Transitions.webkitCubic=S2.FX.cubicBezierTransition(0.25,0.1,0.25,1);S2.FX.Transitions.webkitEaseInOut=S2.FX.cubicBezierTransition(0.42,0,0.58,1);
Object.extend(S2.FX.Transitions,{easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,2);return-0.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,3);return 0.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-
1,4)-1)},easeInOutQuart:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,4);return-0.5*((a-=2)*Math.pow(a,3)-2)},easeInQuint:function(a){return Math.pow(a,5)},easeOutQuint:function(a){return Math.pow(a-1,5)+1},easeInOutQuint:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,5);return 0.5*(Math.pow(a-2,5)+2)},easeInSine:function(a){return-Math.cos(a*(Math.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(Math.PI/2))},easeInOutSine:function(a){return-0.5*(Math.cos(Math.PI*a)-1)},easeInExpo:function(a){return a==
0?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return a==1?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){if(a==0)return 0;if(a==1)return 1;if((a/=0.5)<1)return 0.5*Math.pow(2,10*(a-1));return 0.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){if((a/=0.5)<1)return-0.5*(Math.sqrt(1-a*a)-1);return 0.5*(Math.sqrt(1-(a-=2)*a)+1)},easeOutBounce:function(a){return a<1/2.75?7.5625*
a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375},easeInBack:function(a){return a*a*(2.70158*a-1.70158)},easeOutBack:function(a){return(a-=1)*a*(2.70158*a+1.70158)+1},easeInOutBack:function(a){var b=1.70158;if((a/=0.5)<1)return 0.5*a*a*(((b*=1.525)+1)*a-b);return 0.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},elastic:function(a){return-1*Math.pow(4,-8*a)*Math.sin((a*6-1)*2*Math.PI/2)+1},swingFromTo:function(a){var b=1.70158;return(a/=0.5)<
1?0.5*a*a*(((b*=1.525)+1)*a-b):0.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},swingFrom:function(a){return a*a*(2.70158*a-1.70158)},swingTo:function(a){return(a-=1)*a*(2.70158*a+1.70158)+1},bounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375},bouncePast:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?2-(7.5625*(a-=1.5/2.75)*a+0.75):a<2.5/2.75?2-(7.5625*(a-=2.25/2.75)*a+0.9375):2-(7.5625*(a-=2.625/2.75)*
a+0.984375)},easeFromTo:function(a){if((a/=0.5)<1)return 0.5*Math.pow(a,4);return-0.5*((a-=2)*Math.pow(a,3)-2)},easeFrom:function(a){return Math.pow(a,4)},easeTo:function(a){return Math.pow(a,0.25)}});Prototype.BrowserFeatures.WebkitCSSTransitions=false;S2.Extensions.webkitCSSTransitions=false;
(function(){try{document.createEvent("WebKitTransitionEvent")}catch(a){return}Prototype.BrowserFeatures.WebkitCSSTransitions=true;S2.Extensions.webkitCSSTransitions=true;if(Prototype.BrowserFeatures.WebkitCSSTransitions){$w("webkitBorderTopLeftRadius webkitBorderTopRightRadius webkitBorderBottomLeftRadius webkitBorderBottomRightRadius webkitBackgroundSize").each(function(b){S2.CSS.PROPERTIES.push(b)});S2.CSS.NUMERIC_PROPERTIES=S2.CSS.PROPERTIES.findAll(function(b){return!b.endsWith("olor")});S2.FX.Operators.WebkitCssTransition=
Class.create(S2.FX.Operators.Base,{initialize:function($super,c,e,g){$super(c,e,g);this.element=$(this.object);if(Object.isString(this.options.style))if(this.options.style.include(":"))this.style=$H(S2.CSS.parseStyle(this.options.style));else{this.element.addClassName(g.style);this.style=$H(this.element.getStyles());this.element.removeClassName(g.style);var j=this.element.getStyles();this.style=this.style.reject(function(n){return n.value==j[n.key]})}else this.style=$H(this.options.style);this.properties=
[];this.targetStyle="";this.style.each(function(n){var q=n[0].underscore().dasherize();n=n[1];this.element.getStyle(q);if(q.startsWith("webkit"))q="-"+q;this.properties.push(q);this.targetStyle+=";"+q+":"+n},this)},render:function(){this.element.style.webkitTransitionProperty=this.properties.join(",");this.element.style.webkitTransitionDuration=(this.effect.duration/1E3).toFixed(3)+"s";for(t in S2.FX.Operators.WebkitCssTransition.TIMING_MAP)if(S2.FX.Transitions[t]===this.effect.options.transition)this.element.style.webkitTransitionTimingFunction=
S2.FX.Operators.WebkitCssTransition.TIMING_MAP[t];this.element.setStyle(this.targetStyle);this.render=Prototype.emptyFunction}});S2.FX.Operators.WebkitCssTransition.TIMING_MAP={linear:"linear",sinusoidal:"ease-in-out"};timingFunctionForTransition=function(b){var c=null;for(t in S2.FX.Operators.WebkitCssTransition.TIMING_MAP)if(S2.FX.Transitions[t]===b)c=S2.FX.Operators.WebkitCssTransition.TIMING_MAP[t];return c};isWebkitCSSTransitionCompatible=function(b){return S2.Extensions.webkitCSSTransitions&&
(b.options.engine||"")!="javascript"&&timingFunctionForTransition(b.options.transition)&&!b.options.propertyTransitions};S2.FX.Morph=Class.create(S2.FX.Morph,{setup:function(){if(this.options.change)this.setupWrappers();else if(this.options.style){this.engine=isWebkitCSSTransitionCompatible(this)?"webkit":"javascript";this.animate(this.engine=="webkit"?"webkitCssTransition":"style",this.destinationElement||this.element,{style:this.options.style,propertyTransitions:this.options.propertyTransitions||
{}})}},render:function($super,c){if(this.engine=="webkit"){if(this.options.before)this.element.beforeStartEffect=this.options.before;if(this.options.after){this.element.afterFinishEffect=this.options.after;delete this.options.after}this.element._effect=this}return $super(c)}});Element.addMethods({morph:function(b,c,e){if(Object.isNumber(e))e={duration:e};return b.effect("morph",Object.extend(e,{style:c}))}.optionize()});S2.FX.webkitTransitionStartEvent=document.observe("webkitTransitionStart",function(b){if((b=
b.element())&&b.beforeStartEffect){b.beforeStartEffect();b.beforeStartEffect=null}});S2.FX.webkitTransitionEndEvent=document.observe("webkitTransitionEnd",function(b){var c=b.element();if(c){(function(){c.style.webkitTransitionDuration=""}).defer();if(c.afterFinishEffect){c.afterFinishEffect();c.afterFinishEffect=null}}})}})();
(function(){function a(i){i=i.match(/^(\d+)%?$/i);if(!i)return null;return Number(i[1])/100}function b(i,r){if(Object.isElement(i)){element=i;i=element.getStyle(r)}if(i===null)return null;if(/^\d+(px)?$/i.test(i))return window.parseInt(i,10);if(/\d/.test(i)&&element.runtimeStyle){r=element.style.left;var y=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=i||0;i=element.style.pixelLeft;element.style.left=r;element.runtimeStyle.left=y;return i}if(i.include("%")){i=
a(i);if(r.include("left")||r.include("right")||r.include("width"))y=$(element.parentNode).measure("width");else if(r.include("top")||r.include("bottom")||r.include("height"))y=$(element.parentNode).measure("height");return y*i}return 0}function c(i){for(;i&&i.parentNode;){if(i.getStyle("display")==="none")return false;i=$(i.parentNode)}return true}function e(i){return new Element.Layout(i)}function g(i,r){return $(i).getLayout().get(r)}function j(i){var r=0,y=0;do{r+=i.offsetTop||0;y+=i.offsetLeft||
0;i=i.offsetParent}while(i);return new Element.Offset(y,r)}function n(i){var r=i.getLayout(),y=0,A=0;do{y+=i.offsetTop||0;A+=i.offsetLeft||0;if(i=i.offsetParent){if(F(i))break;if(Element.getStyle(i,"position")!=="static")break}}while(i);A-=r.get("margin-top");y-=r.get("margin-left");return new Element.Offset(A,y)}function q(i){var r=0,y=0;do{r+=i.scrollTop||0;y+=i.scrollLeft||0;i=i.parentNode}while(i);return new Element.Offset(y,r)}function x(i){var r=0,y=0,A=i;do{r+=A.offsetTop||0;y+=A.offsetLeft||
0;if(A.offsetParent==document.body&&Element.getStyle(A,"position")=="absolute")break}while(A=A.offsetParent);A=i;i=A.tagName;var u=Prototype.Browser.Opera;do if(!u||i&&i.toUpperCase()==="BODY"){r-=A.scrollTop||0;y-=A.scrollLeft||0}while(A=A.parentNode);return new Element.Offset(y,r)}function F(i){return $w("BODY HTML").include(i.nodeName.toUpperCase())}var C=Prototype.K;if("currentStyle"in document.documentElement)C=function(i){if(!i.currentStyle.hasLayout)i.style.zoom=1;return i};Element.Layout=
Class.create(Hash,{initialize:function($super,r,y){$super();this.element=$(r);if(y){this._preComputing=true;this._begin()}Element.Layout.PROPERTIES.each(function(A){y?this._compute(A):this._set(A,null)},this);if(y){this._end();this._preComputing=false}},_set:function(i,r){return Hash.prototype.set.call(this,i,r)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,r){var y=$super(r);return y===null?this._compute(r):y},_begin:function(){if(!this._prepared){var i=
this.element;if(!c(i)){i.store("prototype_original_styles",{position:i.style.position||"",width:i.style.width||"",visibility:i.style.visibility||"",display:i.style.display||""});var r=i.getStyle("position"),y=i.getStyle("width");i.setStyle({position:"absolute",visibility:"hidden",display:"block"});var A=i.getStyle("width");r=y&&A===y?window.parseInt(y,10):y&&(r==="absolute"||r==="fixed")?window.parseInt(y,10):$(i.parentNode).getLayout().get("width")-this.get("margin-left")-this.get("border-left")-
this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");i.setStyle({width:r+"px"})}this._prepared=true}},_end:function(){var i=this.element,r=i.retrieve("prototype_original_styles");i.store("prototype_original_styles",null);i.setStyle(r);this._prepared=false},_compute:function(i){var r=Element.Layout.COMPUTATIONS;if(!(i in r))throw"Property not found.";r=r[i].call(this,this.element);this._set(i,r);return r}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),
COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(){this._preComputing||this._begin();var i=this.get("border-box-height");if(i<=0)return 0;var r=this.get("border-top"),y=this.get("border-bottom"),A=this.get("padding-top"),u=this.get("padding-bottom");this._preComputing||this._end();return i-r-y-A-u},width:function(){this._preComputing||this._begin();var i=this.get("border-box-width");
if(i<=0)return 0;var r=this.get("border-left"),y=this.get("border-right"),A=this.get("padding-left"),u=this.get("padding-right");this._preComputing||this._end();return i-r-y-A-u},"padding-box-height":function(){var i=this.get("height"),r=this.get("padding-top"),y=this.get("padding-bottom");return i+r+y},"padding-box-width":function(){var i=this.get("width"),r=this.get("padding-left"),y=this.get("padding-right");return i+r+y},"border-box-height":function(i){return i.offsetHeight},"border-box-width":function(i){return i.offsetWidth},
"margin-box-height":function(){var i=this.get("border-box-height"),r=this.get("margin-top"),y=this.get("margin-bottom");if(i<=0)return 0;return i+r+y},"margin-box-width":function(){var i=this.get("border-box-width"),r=this.get("margin-left"),y=this.get("margin-right");if(i<=0)return 0;return i+r+y},top:function(i){return i.positionedOffset().top},bottom:function(i){var r=i.positionedOffset();i=i.getOffsetParent().measure("height");var y=this.get("border-box-height");return i-y-r.top},left:function(i){return i.positionedOffset().left},
right:function(i){var r=i.positionedOffset();i=i.getOffsetParent().measure("width");var y=this.get("border-box-width");return i-y-r.left},"padding-top":function(i){return b(i,"paddingTop")},"padding-bottom":function(i){return b(i,"paddingBottom")},"padding-left":function(i){return b(i,"paddingLeft")},"padding-right":function(i){return b(i,"paddingRight")},"border-top":function(i){return Object.isNumber(i.clientTop)?i.clientTop:b(i,"borderTopWidth")},"border-bottom":function(i){return Object.isNumber(i.clientBottom)?
i.clientBottom:b(i,"borderBottomWidth")},"border-left":function(i){return Object.isNumber(i.clientLeft)?i.clientLeft:b(i,"borderLeftWidth")},"border-right":function(i){return Object.isNumber(i.clientRight)?i.clientRight:b(i,"borderRightWidth")},"margin-top":function(i){return b(i,"marginTop")},"margin-bottom":function(i){return b(i,"marginBottom")},"margin-left":function(i){return b(i,"marginLeft")},"margin-right":function(i){return b(i,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&
Object.extend(Element.Layout.COMPUTATIONS,{right:function(i){var r=C(i.getOffsetParent());i=i.getBoundingClientRect();return(r.getBoundingClientRect().right-i.right).round()},bottom:function(i){var r=C(i.getOffsetParent());i=i.getBoundingClientRect();return(r.getBoundingClientRect().bottom-i.bottom).round()}});Element.Offset=Class.create({initialize:function(i,r){this.left=i.round();this.top=r.round();this[0]=this.left;this[1]=this.top},relativeTo:function(i){return new Element.Offset(this.left-i.left,
this.top-i.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});Element.addMethods({getLayout:e,measure:g,cumulativeOffset:j,positionedOffset:n,cumulativeScrollOffset:q,viewportOffset:x});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(i){i=$(i);i=i.getBoundingClientRect();return new Element.Offset(i.left,
i.top)},cumulativeOffset:function(i){i=$(i);var r=$(document.documentElement).viewportOffset();return i.viewportOffset().relativeTo(r)},positionedOffset:function(i){i=$(i);var r=i.getOffsetParent();if(r.nodeName.toUpperCase()==="HTML")return n(i);var y=i.viewportOffset();r=F(r)?x(r):r.viewportOffset();y=y.relativeTo(r);r=i.getLayout();i=y.top-r.get("margin-top");y=y.left-r.get("margin-left");return new Element.Offset(y,i)}})})();S2.UI={};
Object.deepExtend=function(a,b){for(var c in b)if(b[c]&&b[c].constructor&&b[c].constructor===Object){a[c]=a[c]||{};arguments.callee(a[c],b[c])}else a[c]=b[c];return a};S2.UI.Mixin={};
S2.UI.Mixin.Configurable={setOptions:function(a){if(!this.options){this.options={};var b=this.constructor;if(b.superclass){for(var c=[],e=b;e=e.superclass;)c.push(e);c=c.reverse();e=0;for(var g=c.length;e<g;e++)Object.deepExtend(this.options,c[e].DEFAULT_OPTIONS||{})}Object.deepExtend(this.options,b.DEFAULT_OPTIONS||{})}return Object.deepExtend(this.options,a||{})}};
S2.UI.Mixin.Trackable={register:function(){var a=this.constructor;if(!a.instances)a.instances=[];a.instances.include(this)||a.instances.push(this);Object.isFunction(a.onRegister)&&a.onRegister.call(a,this)},unregister:function(){var a=this.constructor;a.instances=a.instances.without(this);Object.isFunction(a.onRegister)&&a.onUnregister.call(a,this)}};
S2.UI.Mixin.Shim={__SHIM_TEMPLATE:new Template("<iframe frameborder='0' tabindex='-1' src='javascript:false;' style='display:block;position:absolute;z-index:-1;overflow:hidden; filter:Alpha(Opacity=\"0\");top:expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px');left:expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px');width:expression(this.parentNode.offsetWidth+'px');height:expression(this.parentNode.offsetHeight+'px');' id='#{0}'></iframe>"),createShim:function(a){if(this.__shim_isie6=
Prototype.Browser.IE&&/6.0/.test(navigator.userAgent))if(a=$(a||this.element)){this.__shimmed=a;var b=a.identify()+"_iframeshim",c=$(b);c&&c.remove();a.insert({top:this.__SHIM_TEMPLATE.evaluate([b])});this.__shim_id=b}},adjustShim:function(){if(this.__shim_isie6){var a=this.__shimmed.down("iframe#"+this.__shim_id),b=this.__shimmed;a&&a.setStyle({width:b.offsetWidth+"px",height:b.offsetHeight+"px"})}},destroyShim:function(){if(this.__shim_isie6){var a=this.__shimmed.down("iframe#"+this.__shim_id);
a&&a.remove();this.__shimmed=null}}};
Object.extend(S2.UI,{addClassNames:function(a,b){if(Object.isElement(a))a=[a];if(Object.isString(b))b=b.split(" ");for(var c,e,g=0,j;j=a[g];g++)for(c=0;e=b[c];c++)j.addClassName(e);return a},removeClassNames:function(a,b){if(Object.isElement(a))a=[a];if(Object.isString(b))b=b.split(" ");for(var c,e,g=0,j;j=a[g];g++)for(c=0;e=b[c];c++)j.removeClassName(e)},FOCUSABLE_ELEMENTS:$w("input select textarea button object"),isFocusable:function(a){var b=a.nodeName.toLowerCase(),c=a.readAttribute("tabIndex"),
e=false;e=S2.UI.FOCUSABLE_ELEMENTS.include(b)?!a.disabled:$w("a area").include(b)?a.href||c&&!isNaN(c):c&&!isNaN(c);return!!e&&S2.UI.isVisible(a)},findFocusables:function(a){return $(a).descendants().select(S2.UI.isFocusable)},isVisible:function(a){for(a=$(a);a&&a.parentNode;){var b=a.getStyle("display"),c=a.getStyle("visibility");if(b==="none"||c==="hidden")return false;a=$(a.parentNode)}return true},makeVisible:function(a,b){if(Object.isElement(a))a=[a];b=b?"visible":"hidden";for(var c=0,e;e=a[c];c++)e.setStyle({visibility:b});
return a},modifierUsed:function(a){return a.metaKey||a.ctrlKey||a.altKey}});
(function(){function a(c){var e=Event.element(c);if(e)for(var g=0,j;j=b[g];g++)if(e===j||e.descendantOf(j)){Event.stop(c);break}}var b=[];if(document.attachEvent)document.onselectstart=a.bindAsEventListener(window);else document.observe("mousedown",a);Object.extend(S2.UI,{enableTextSelection:function(c){c.setStyle({"-moz-user-select":"","-webkit-user-select":""});b=b.without(c);return c},disableTextSelection:function(c){c.setStyle({"-moz-user-select":"none","-webkit-user-select":"none"});b.include(c)||
b.push(c);return c}})})();
S2.UI.Behavior=Class.create(S2.UI.Mixin.Configurable,{initialize:function(a,b){function c(j){return j.startsWith("on")||j.include("/on")}this.element=a;this.setOptions(b);Object.extend(this,b);this._observers={};var e;for(var g in this)if(c(g)){b=g.split("/");a=b.length===2?this[b.first()]||this.element:this.element;b=b.last();e=this._observers[b]=this[g].bind(this);a.observe(b.substring(2),e)}},destroy:function(){var a=this.options.proxy||this.element,b;for(var c in this._observers){b=this._observers[c];
a.stopObserving(c.substring(2),b)}}});
Object.extend(S2.UI,{addBehavior:function(a,b,c){var e=arguments.callee;if(Object.isArray(a))a.each(function(j){e(j,b,c)});else if(Object.isArray(b))b.each(function(j){e(a,j,c)});else{var g=new b(a,c||{});$(a).retrieve("ui.behaviors",[]).push(g)}},removeBehavior:function(a,b){var c=arguments.callee;if(Object.isArray(a))a.each(function(q){c(q,b)});else if(Object.isArray(b))b.each(function(q){c(a,q)});else{for(var e=$(a).retrieve("ui.behaviors",[]),g=[],j=0,n;n=e[j];j++)if(!(!n instanceof b)){n.destroy();
g.push(n)}$(a).store("ui.behaviors",e.without(g))}},getBehavior:function(a,b){a=$(a);a=a.retrieve("ui.behaviors",[]);for(var c=0,e=a.length,g;c<e;c++){g=a[c];if(g.constructor===b)return g}return null}});
S2.UI.Behavior.Drag=Class.create(S2.UI.Behavior,{initialize:function($super,b,c){this.__onmousemove=this._onmousemove.bind(this);$super(b,c);this.element.addClassName("ui-draggable")},destroy:function($super){this.element.removeClassName("ui-draggable");$super()},"handle/onmousedown":function(a){var b=this.element;this._startPointer=a.pointer();this._startPosition={left:window.parseInt(b.getStyle("left"),10),top:window.parseInt(b.getStyle("top"),10)};document.observe("mousemove",this.__onmousemove)},
"handle/onmouseup":function(){this._startPosition=this._startPointer=null;document.stopObserving("mousemove",this.__onmousemove)},_onmousemove:function(a){a=a.pointer();if(this._startPointer){a={x:a.x-this._startPointer.x,y:a.y-this._startPointer.y};this.element.setStyle({left:this._startPosition.left+a.x+"px",top:this._startPosition.top+a.y+"px"})}}});
S2.UI.Behavior.Focus=Class.create(S2.UI.Behavior,{onfocus:function(){this.element.hasClassName("ui-state-disabled")||this.element.addClassName("ui-state-focus")},onblur:function(){this.element.hasClassName("ui-state-disabled")||this.element.removeClassName("ui-state-focus")}});
S2.UI.Behavior.Hover=Class.create(S2.UI.Behavior,{onmouseenter:function(){this.element.hasClassName("ui-state-disabled")||this.element.addClassName("ui-state-hover")},onmouseleave:function(){this.element.hasClassName("ui-state-disabled")||this.element.removeClassName("ui-state-hover")}});S2.UI.Behavior.Resize=Class.create(S2.UI.Behavior,{initialize:function(){}});
S2.UI.Behavior.Down=Class.create(S2.UI.Behavior,{onmousedown:function(){this._down=true;this.element.hasClassName("ui-state-disabled")||this.element.addClassName("ui-state-down")},onmouseup:function(){this._down=false;this.element.hasClassName("ui-state-disabled")||this.element.removeClassName("ui-state-down")},onmouseleave:function(a){return this.onmouseup(a)},onmouseenter:function(a){if(this._down)return this.onmousedown(a)}});
(function(a){a.Base=Class.create(a.Mixin.Configurable,{NAME:"S2.UI.Base",addObservers:Function.ABSTRACT,removeObservers:Function.ABSTRACT,destroy:function(){this.removeObservers()},toElement:function(){return this.element},inspect:function(){return"#<#{NAME}>".interpolate(this)}})})(S2.UI);Object.extend(Event,{KEY_SPACE:32});
(function(a){a.Accordion=Class.create(a.Base,{NAME:"S2.UI.Accordion",initialize:function(b,c){this.element=$(b);var e=this.setOptions(c);a.addClassNames(this.element,"ui-accordion ui-widget ui-helper-reset");if(this.element.nodeName.toUpperCase()==="UL"){b=this.element.childElements().grep(new Selector("li"));a.addClassNames(b,"ui-accordion-li-fix")}this.headers=this.element.select(e.headerSelector);if(!(!this.headers||this.headers.length===0)){a.addClassNames(this.headers,"ui-accordion-header ui-helper-reset ui-state-default ui-corner-all");
a.addBehavior(this.headers,[a.Behavior.Hover,a.Behavior.Focus]);this.content=this.headers.map(function(g){return g.next()});a.addClassNames(this.content,"ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");this.headers.each(function(g){var j=new Element("span");a.addClassNames(j,"ui-icon "+e.icons.header);g.insert({top:j})});this._markActive(e.active||this.headers.first(),false);this.element.writeAttribute({role:"tablist","aria-multiselectable":e.multiple.toString()});this.headers.invoke("writeAttribute",
"role","tab");this.content.invoke("writeAttribute","role","tabpanel");this.headers.map(function(g){return g.down("a")}).invoke("observe","click",function(g){g.preventDefault()});this.observers={click:this.click.bind(this),keypress:this.keypress.bind(this)};this.addObservers()}},addObservers:function(){this.headers.invoke("observe","click",this.observers.click);Prototype.Browser.WebKit?this.headers.invoke("observe","keydown",this.observers.keypress):this.headers.invoke("observe","keypress",this.observers.keypress)},
click:function(b){(b=b.findElement(this.options.headerSelector))&&this.headers.include(b)&&this._toggleActive(b)},keypress:function(b){if(!(b.shiftKey||b.metaKey||b.altKey||b.ctrlKey)){var c=b.findElement(this.options.headerSelector);switch(b.keyCode===0?b.charCode:b.keyCode){case Event.KEY_SPACE:this._toggleActive(c);b.stop();return;case Event.KEY_DOWN:case Event.KEY_RIGHT:this._focusHeader(c,1);b.stop();return;case Event.KEY_UP:case Event.KEY_LEFT:this._focusHeader(c,-1);b.stop();return;case Event.KEY_HOME:this._focusHeader(this.headers.first());
b.stop();return;case Event.KEY_END:this._focusHeader(this.headers.last());b.stop();return}}},_focusHeader:function(b,c){if(Object.isNumber(c)){var e=this.headers.indexOf(b);e+=c;if(e>this.headers.length-1)e=this.headers.length-1;else if(e<0)e=0;b=this.headers[e]}(function(){b.down("a").focus()}).defer()},_toggleActive:function(b){if(b.hasClassName("ui-state-active")){if(this.options.multiple){this._removeActive(b);this._activatePanel(null,b.next(),true)}}else this._markActive(b)},_removeActive:function(b){var c=
this.options;a.removeClassNames(b,"ui-state-active ui-corner-top");a.addClassNames(b,"ui-state-default ui-corner-all");b.writeAttribute("aria-expanded","false");b=b.down(".ui-icon");b.removeClassName(c.icons.headerSelected);b.addClassName(c.icons.header)},_markActive:function(b,c){if(Object.isUndefined(c))c=true;var e=this.options,g=null;if(!e.multiple){g=this.element.down(".ui-accordion-content-active");this.headers.each(this._removeActive.bind(this))}if(b){a.removeClassNames(b,"ui-state-default ui-corner-all");
a.addClassNames(b,"ui-state-active ui-corner-top");b.writeAttribute("aria-expanded","true");this._activatePanel(b.next(),g,c);c=b.down(".ui-icon");c.removeClassName(e.icons.header);c.addClassName(e.icons.headerSelected);return b}},_activatePanel:function(b,c,e){if(e)this.options.transition(b,c);else{c&&c.removeClassName("ui-accordion-content-active");b&&b.addClassName("ui-accordion-content-active")}}});Object.extend(a.Accordion,{DEFAULT_OPTIONS:{multiple:false,headerSelector:"h3",icons:{header:"ui-icon-triangle-1-e",
headerSelected:"ui-icon-triangle-1-s"},transition:function(b,c){var e=[],g;if(c){g=new S2.FX.SlideUp(c,{duration:0.2,after:function(){c.removeClassName("ui-accordion-content-active")}});e.push(g)}if(b){g=new S2.FX.SlideDown(b,{duration:0.2,before:function(){b.addClassName("ui-accordion-content-active")}});e.push(g)}e.invoke("play")}}})})(S2.UI);
(function(a){a.Button=Class.create(a.Base,{NAME:"S2.UI.Button",initialize:function(b,c){this.element=$(b);this.element.store("ui.button",this);b=this.setOptions(c);a.addClassNames(this.element,"ui-state-default ui-corner-all");a.addBehavior(this.element,[a.Behavior.Hover,a.Behavior.Focus,a.Behavior.Down]);b.primary&&this.element.addClassName("ui-priority-primary");this.element.writeAttribute("role","button");this.enabled=true;this.setEnabled(this.element.disabled===true||!this.element.hasClassName("ui-state-disabled"))},
setEnabled:function(b){if(this.enabled!==b){(this.enabled=b)?this.element.removeClassName("ui-state-disabled"):this.element.addClassName("ui-state-disabled");this.element.disabled=!b}},toElement:function(){return this.element},toHTML:function(){return this.element.toHTML()},toString:function(){return this.element.toHTML()},inspect:function(){return this.element.inspect()}});Object.extend(a.Button,{DEFAULT_OPTIONS:{primary:false}})})(S2.UI);
(function(a){a.Tabs=Class.create(a.Base,{NAME:"S2.UI.Tabs",initialize:function(b,c){this.element=$(b);a.addClassNames(this.element,"ui-widget ui-widget-content ui-tabs ui-corner-all");this.setOptions(c);b=this.options;this.anchors=[];this.panels=[];this.list=this.element.down("ul");this.list.cleanWhitespace();this.nav=this.list;a.addClassNames(this.nav,"ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.tabs=this.list.select("li");a.addClassNames(this.tabs,"ui-state-default ui-corner-top");
a.addBehavior(this.tabs,[a.Behavior.Hover,a.Behavior.Down]);this.element.writeAttribute({role:"tablist","aria-multiselectable":"false"});this.tabs.each(function(g){var j=g.down("a");if(j){var n=j.readAttribute("href");if(n.include("#")){n=n.split("#").last();n=$(n);g.writeAttribute("tabIndex","0");if(n){n.store("ui.tab",g);g.store("ui.panel",n);this.anchors.push(j);this.panels.push(n)}}}},this);this.anchors.invoke("writeAttribute","role","tab");this.panels.invoke("writeAttribute","role","tabpanel");
this.tabs.first().addClassName("ui-position-first");this.tabs.last().addClassName("ui-position-last");a.addClassNames(this.panels,"ui-tabs-panel ui-tabs-hide ui-widget-content ui-corner-bottom");this.observers={onKeyPress:this.onKeyPress.bind(this),onTabClick:this.onTabClick.bind(this)};this.addObservers();c=window.location.hash.substring(1);var e;c.empty()||(e=$(c));this.setSelectedTab(e&&this.panels.include(e)?e.retrieve("ui.tab"):b.selectedTab?$(b.selectedTab):this.tabs.first())},addObservers:function(){this.anchors.invoke("observe",
"click",this.observers.onTabClick);this.tabs.invoke("observe","keypress",this.observers.onKeyPress)},_setSelected:function(b){b=$(b);var c=b.retrieve("ui.tab"),e=this.list.down(".ui-tabs-selected"),g=e?e.retrieve("ui.panel"):null;a.removeClassNames(this.tabs,"ui-tabs-selected ui-state-active");a.addClassNames(this.tabs,"ui-state-default");c.removeClassName("ui-state-default").addClassName("ui-tabs-selected ui-state-active");this.element.fire("ui:tabs:change",{from:{tab:e,panel:g},to:{tab:c,panel:b}});
this.options.panel.transition(g,b)},setSelectedTab:function(b){this.setSelectedPanel(b.retrieve("ui.panel"))},setSelectedPanel:function(b){this._setSelected(b.readAttribute("id"))},onTabClick:function(b){b.stop();b.findElement("a");this.setSelectedTab(b.findElement("li"))},onKeyPress:function(b){if(!a.modifierUsed(b)){var c=b.findElement("li");switch(b.keyCode||b.charCode){case Event.KEY_SPACE:case Event.KEY_RETURN:this.setSelectedTab(c);b.stop();return;case Event.KEY_UP:case Event.KEY_LEFT:this._focusTab(c,
-1);return;case Event.KEY_DOWN:case Event.KEY_RIGHT:this._focusTab(c,1);return}}},_focusTab:function(b,c){if(Object.isNumber(c)){var e=this.tabs.indexOf(b);e+=c;if(e>this.tabs.length-1)e=this.tabs.length-1;else if(e<0)e=0;b=this.tabs[e]}(function(){b.focus()}).defer()}});Object.extend(a.Tabs,{DEFAULT_OPTIONS:{panel:{transition:function(b,c){b&&b.addClassName("ui-tabs-hide");c.removeClassName("ui-tabs-hide")}}}})})(S2.UI);
(function(a){a.Overlay=Class.create(a.Base,a.Mixin.Trackable,a.Mixin.Shim,{NAME:"S2.UI.Overlay",initialize:function(b){this.setOptions(b);this.element=new Element("div",{"class":"ui-widget-overlay"});this.register();this.createShim();this.adjustShim();this.constructor.onResize()},destroy:function(){this.element.remove();this.unregister()},toElement:function(){return this.element}});Object.extend(a.Overlay,{onRegister:function(){if(this.instances.length===1){this._resizeObserver=this._resizeObserver||
this.onResize.bind(this);Event.observe(window,"resize",this._resizeObserver);Event.observe(window,"scroll",this._resizeObserver)}},onUnregister:function(){if(this.instances.length===0){Event.stopObserving(window,"resize",this._resizeObserver);Event.stopObserving(window,"scroll",this._resizeObserver)}},onResize:function(){var b=document.viewport.getDimensions(),c=document.viewport.getScrollOffsets();this.instances.each(function(e){e.element.setStyle({width:b.width+"px",height:b.height+"px",left:c.left+
"px",top:c.top+"px"})});(function(){this.instances.invoke("adjustShim")}).bind(this).defer()}})})(S2.UI);
(function(a){a.Dialog=Class.create(a.Base,{NAME:"S2.UI.Dialog",initialize:function(b,c){if(Object.isElement(b))b=$(b);else{c=b;b=null}c=this.setOptions(c);this.element=b||new Element("div");a.addClassNames(this.element,"ui-dialog ui-widget ui-widget-content ui-corner-all");this.element.hide().setStyle({position:"absolute",overflow:"hidden",zIndex:c.zIndex,outline:"0"});this.element.writeAttribute({tabIndex:"-1",role:"dialog"});this.content=c.content?Object.isElement(c.content)?c.content:(new Element("div")).update(c.content):
new Element("div");a.addClassNames(this.content,"ui-dialog-content ui-widget-content");this.element.insert(this.content);this.titleBar=this.options.titleBar||new Element("div");a.addClassNames(this.titleBar,"ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix");this.element.insert({top:this.titleBar});this.closeButton=new Element("a",{href:"#"});a.addClassNames(this.closeButton,"ui-dialog-titlebar-close ui-corner-all");new a.Button(this.closeButton);this.closeButton.observe("mousedown",
Event.stop);this.closeButton.observe("click",function(e){e.stop();this.close(false)}.bind(this));this.titleBar.insert(this.closeButton);this.closeText=new Element("span");a.addClassNames(this.closeText,"ui-icon ui-icon-closethick");this.closeButton.insert(this.closeText);this.titleText=new Element("span",{"class":"ui-dialog-title"});this.titleText.update(this.options.title).identify();this.element.writeAttribute("aria-labelledby",this.titleText.readAttribute("id"));this.titleBar.insert({top:this.titleText});
a.disableTextSelection(this.element);this.options.draggable&&a.addBehavior(this.element,a.Behavior.Drag,{handle:this.titleBar});(b=this.options.buttons)&&b.length&&this._createButtons();this.observers={keypress:this.keypress.bind(this)}},toElement:function(){return this.element},_createButtons:function(){var b=this.options.buttons;this.buttonPane&&this.buttonPane.remove();this.buttonPane=new Element("div");a.addClassNames(this.buttonPane,"ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");
b.each(function(c){var e=new Element("button",{type:"button"});a.addClassNames(e,"ui-state-default ui-corner-all");c.primary&&e.addClassName("ui-priority-primary");c.secondary&&e.addClassName("ui-priority-secondary");e.update(c.label);new a.Button(e);e.observe("click",c.action.bind(this,this));this.buttonPane.insert(e)},this);this.element.insert(this.buttonPane)},_position:function(){var b=document.viewport.getDimensions(),c=this.element;c={width:parseInt(c.getStyle("width"),10),height:parseInt(c.getStyle("height"),
10)};b={left:(b.width/2-c.width/2).round(),top:(b.height/2-c.height/2).round()};c=document.viewport.getScrollOffsets();b.left+=c.left;b.top+=c.top;this.element.setStyle({left:b.left+"px",top:b.top+"px"})},open:function(){if(!this._isOpen)if(!this.element.fire("ui:dialog:before:open",{dialog:this}).stopped){var b=this.options;this.overlay=b.modal?new a.Overlay:null;$(document.body).insert(this.overlay);$(document.body).insert(this.element);this.element.show();this._position();this.focusables=a.findFocusables(this.element);
b.submitForms||this.content.select("form").invoke("observe","submit",Event.stop);var c=this.focusables.without(this.closeButton),e=b.focus;b=false;if(e==="first"){c.first().focus();b=true}else if(e==="last"){c.last().focus();b=true}else if(Object.isElement(e)){e.focus();b=true}else if(this.buttonPane)if(e=this.buttonPane.down(".ui-priority-primary")){e.focus();b=true}!b&&c.length>0&&c.first().focus();Event.observe(window,"keydown",this.observers.keypress);this._isOpen=true;this.element.fire("ui:dialog:after:open",
{dialog:this});return this}},close:function(b){b=!!b;if(!this.element.fire("ui:dialog:before:close",{dialog:this}).stopped){this.overlay&&this.overlay.destroy();this.element.hide();this._isOpen=false;Event.stopObserving(window,"keydown",this.observers.keypress);b={dialog:this,success:b};var c=this.content.down("form");c&&Object.extend(b,{form:c.serialize({hash:true})});this.element.fire("ui:dialog:after:close",b);a.enableTextSelection(this.element,true);return this}},keypress:function(b){if(!a.modifierUsed(b)){var c=
this.focusables,e=this.options;if(b.keyCode===Event.KEY_ESC)e.closeOnEscape&&this.close(false);else if(b.keyCode===Event.KEY_RETURN)this.close(true);else if(b.keyCode===Event.KEY_TAB)if(this.options.modal)if(c){var g;e=b.findElement();e=c.indexOf(e);if(g=e===-1?c.first():b.shiftKey?e===0?c.last():c[e-1]:e===c.length-1?c.first():c[e+1]){b.stop();(function(){g.focus()}).defer()}}}}});Object.extend(a.Dialog,{DEFAULT_OPTIONS:{zIndex:1E3,title:"Dialog",content:null,modal:true,focus:"auto",submitForms:false,
closeOnEscape:true,draggable:true,resizable:false,buttons:[{label:"OK",primary:true,action:function(b){b.close(true)}}]}})})(S2.UI);
(function(a){a.Slider=Class.create(a.Base,{NAME:"S2.UI.Slider",initialize:function(b,c){this.element=$(b);b=this.setOptions(c);a.addClassNames(this.element,"ui-slider ui-widget ui-widget-content ui-corner-all");this.orientation=b.orientation;this.element.addClassName("ui-slider-"+this.orientation);this._computeTrackLength();c=b.value.initial;Object.isArray(c)||(c=[c]);this.values=c;this.handles=[];this.values.each(function(g,j){g=new Element("a",{href:"#"});g.store("ui.slider.handle",j);this.handles.push(g);
this.element.insert(g)},this);a.addClassNames(this.handles,"ui-slider-handle ui-state-default ui-corner-all");this.handles.invoke("writeAttribute","tabIndex","0");this.activeHandle=this.handles.first();this.handles.invoke("observe","click",Event.stop);a.addBehavior(this.handles,[a.Behavior.Hover,a.Behavior.Focus]);this.observers={focus:this.focus.bind(this),blur:this.blur.bind(this),keydown:this.keydown.bind(this),keyup:this.keyup.bind(this),mousedown:this.mousedown.bind(this),mouseup:this.mouseup.bind(this),
mousemove:this.mousemove.bind(this),rangeMouseDown:this.rangeMouseDown.bind(this),rangeMouseMove:this.rangeMouseMove.bind(this),rangeMouseUp:this.rangeMouseUp.bind(this)};c=b.value;if(c.step!==null){this._possibleValues=[];for(var e=c.min;e<c.max;e+=c.step)this._possibleValues.push(e);this._possibleValues.push(c.max);this.keyboardStep=c.step}else if(b.possibleValues){this._possibleValues=b.possibleValues.clone();this.keyboardStep=null}else this.keyboardStep=(c.max-c.min)/100;this.range=null;if(b.range&&
this.values.length===2){this.restricted=true;this.range=new Element("div",{"class":"ui-slider-range"});this.element.insert(this.range);this.range.addClassName("ui-widget-header")}this._computeTrackLength();this._computeHandleLength();this.disabled=this.dragging=this.active=false;this.addObservers();this.values.each(this.setValue,this);this.initialized=true},addObservers:function(){this.element.observe("mousedown",this.observers.mousedown);this.range&&this.range.observe("mousedown",this.observers.rangeMouseDown);
this.handles.invoke("observe","keydown",this.observers.keydown);this.handles.invoke("observe","keyup",this.observers.keyup)},_computeTrackLength:function(){var b;if(this.orientation==="vertical"){b=this.element.offsetHeight;b=b!==0?b:window.parseInt(this.element.getStyle("height"),10)}else{b=this.element.offsetWidth;b=b!==0?b:window.parseInt(this.element.getStyle("width"),10)}return this._trackLength=b},_computeHandleLength:function(){var b=this.handles.first(),c;if(b){if(this.orientation==="vertical"){c=
b.offsetHeight;b=c!==0?c:window.parseInt(b.getStyle("height"),10)}else{c=b.offsetWidth;b=c!==0?c:window.parseInt(b.getStyle("width"),10)}return this._handleLength=b}},_nextValue:function(b,c){return this.options.possibleValues?this._possibleValues[this._possibleValues.indexOf(b)+c]:b+this.keyboardStep*c},keydown:function(b){if(!this.options.disabled){var c=b.findElement(),e=c.retrieve("ui.slider.handle"),g=this.options;if(Object.isNumber(e))if([Event.KEY_HOME,Event.KEY_END,Event.KEY_UP,Event.KEY_DOWN,
Event.KEY_LEFT,Event.KEY_RIGHT].include(b.keyCode)){c.addClassName("ui-state-active");var j;c=j=this.values[e];switch(b.keyCode){case Event.KEY_HOME:j=g.value.min;break;case Event.KEY_END:j=g.value.max;break;case Event.KEY_UP:case Event.KEY_RIGHT:if(c===g.value.max)return;j=this._nextValue(c,1);break;case Event.KEY_DOWN:case Event.KEY_LEFT:if(c===g.value.min)return;j=this._nextValue(c,-1);break}this.dragging=true;this.setValue(j,e);if(!Prototype.Browser.WebKit){e=this._timer?0.1:1;this._timer=arguments.callee.bind(this).delay(e,
b)}}}},keyup:function(b){this.dragging=false;if(this._timer){window.clearTimeout(this._timer);this._timer=null}this._updateFinished();b.findElement().removeClassName("ui-state-active")},setValue:function(b,c){if(!this.activeHandle){this.activeHandle=this.handles[c||0];this._updateStyles()}c=c||this.activeHandle.retrieve("ui.slider.handle")||0;if(this.initialized&&this.restricted){if(c>0&&b<this.values[c-1])b=this.values[c-1];if(c<this.handles.length-1&&b>this.values[c+1])b=this.values[c+1]}b=this._getNearestValue(b);
this.values[c]=b;var e={};e[this.orientation==="vertical"?"top":"left"]=this._valueToPx(b)+"px";this.handles[c].setStyle(e);this._drawRange();!this.dragging&&!this.undoing&&!this.initialized&&this._updateFinished();if(this.initialized){this.element.fire("ui:slider:value:changing",{slider:this,values:this.values});this.options.onSlide(this.values,this)}return this},_getNearestValue:function(b){var c=this.options.value;if(b<c.min)b=c.min;if(b>c.max)b=c.max;if(this._possibleValues){var e;for(c=0;c<this._possibleValues.length;c++){e=
this._possibleValues[c];if(e===b)return b;if(e>b)break}b=b.nearer(this._possibleValues[c-1],e)}return b},_valueToPx:function(b){var c=this.options.value,e=(this._trackLength-this._handleLength/2)/(c.max-c.min);e*=b-c.min;if(this.orientation==="vertical")e=this._trackLength-e-this._handleLength;return Math.round(e)},mousedown:function(b){var c=this.options;if(!(!b.isLeftClick()||c.disabled)){b.stop();this._oldValues=this.values.clone();this.active=true;var e=b.findElement();c=b.pointer();if(e===this.element){b=
this.element.cumulativeOffset();this.setValue(this._pxToValue({x:Math.round(c.x-b.left+this._handleLength/4),y:Math.round(c.y-b.top+this._handleLength/4)}));handle=this.activeHandle=this.activeHandle||this.handles.first()}else{handle=b.findElement(".ui-slider-handle");if(!handle)return;this.activeHandle=handle}this._updateStyles();b=handle.cumulativeOffset();this._offsets={x:c.x-b.left,y:c.y-b.top};document.observe("mousemove",this.observers.mousemove);document.observe("mouseup",this.observers.mouseup)}},
mouseup:function(b){if(this.active&&this.dragging){this._updateFinished();b.stop()}this.active=this.dragging=false;this.activeHandle=null;this._updateStyles();document.stopObserving("mousemove",this.observers.mousemove);document.stopObserving("mouseup",this.observers.mouseup)},mousemove:function(b){if(this.active){b.stop();this.dragging=true;this._draw(b);Prototype.Browser.WebKit&&window.scrollBy(0,0)}},rangeMouseDown:function(b){b=b.pointer();var c=this.element.cumulativeOffset();b={x:Math.round(b.x-
c.left),y:Math.round(b.y-c.top)};this._rangeInitialValues=this.values.clone();this._rangePseudoValue=this._pxToValue(b);document.observe("mousemove",this.observers.rangeMouseMove);document.observe("mouseup",this.observers.rangeMouseUp)},rangeMouseMove:function(b){this.dragging=true;b.stop();var c=this.options;b=b.pointer();var e=this.element.cumulativeOffset(),g=this._pxToValue({x:Math.round(b.x-e.left),y:Math.round(b.y-e.top)})-this._rangePseudoValue;b=this._rangeInitialValues.map(function(j){return j+
g});if(b[0]<c.value.min){g=c.value.min-this._rangeInitialValues[0];b=this._rangeInitialValues.map(function(j){return j+g})}else if(b[1]>c.value.max){g=c.value.max-this._rangeInitialValues[1];b=this._rangeInitialValues.map(function(j){return j+g})}b.each(this.setValue,this)},rangeMouseUp:function(){this.dragging=false;document.stopObserving("mousemove",this.observers.rangeMouseMove);document.stopObserving("mouseup",this.observers.rangeMouseUp);this._updateFinished()},_draw:function(b){b=b.pointer();
var c=this.element.cumulativeOffset();b.x-=this._offsets.x+c.left;b.y-=this._offsets.y+c.top;this.setValue(this._pxToValue(b))},_pxToValue:function(b){var c=this.options;b=(this.orientation==="horizontal"?b.x:b.y)/(this._trackLength-this._handleLength)*(c.value.max-c.value.min)+c.value.min;if(this.orientation==="vertical")b=c.value.max-(b-c.value.min);return b},undo:function(){if(this._oldValues){this.values=this._oldValues.clone();this.undoing=true;this._oldValues.each(this.setValue,this);this.undoing=
false}},_updateFinished:function(){if(this.element.fire("ui:slider:value:changed",{slider:this,values:this.values}).stopped)this.undo();else{this.activeHandle=null;this._updateStyles();this.options.onChange(this.values,this)}},_updateStyles:function(){a.removeClassNames(this.handles,"ui-state-active");this.activeHandle&&this.activeHandle.addClassName("ui-state-active")},_drawRange:function(){if(this.range){var b=this.values.map(this._valueToPx,this);this.orientation==="vertical"?this.range.setStyle({top:b[1]+
"px",height:b[0]-b[1]+"px"}):this.range.setStyle({left:b[0]+"px",width:b[1]-b[0]+"px"})}},focus:function(b){if(!this.options.disabled){b=b.findElement();this.element.select(".ui-state-focus").invoke("removeClassName","ui-state-focus");b.addClassName("ui-state-focus")}},blur:function(b){b.findElement().removeClassName("ui-state-focus")}});Object.extend(a.Slider,{DEFAULT_OPTIONS:{range:false,disabled:false,value:{min:0,max:100,initial:0,step:null},possibleValues:null,orientation:"horizontal",onSlide:Prototype.emptyFunction,
onChange:Prototype.emptyFunction}})})(S2.UI);
(function(a){a.ProgressBar=Class.create(a.Base,{NAME:"S2.UI.ProgressBar",initialize:function(b,c){this.element=$(b);b=this.setOptions(c);a.addClassNames(this.element,"ui-progressbar ui-widget ui-widget-content ui-corner-all");this.element.writeAttribute({role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0});this.valueElement=new Element("div",{"class":"ui-progressbar-value ui-widget-header ui-corner-left"});this.value=b.value.initial;this._refreshValue();this.element.insert(this.valueElement);
this.element.store(this.NAME,this)},destroy:function(){a.removeClassNames(this.element,"ui-progressbar ui-widget ui-widget-content ui-corner-all");a.removeAttributes(this.element,"role aria-valuemin aria-valuemax aria-valuenow");this.element.getData().unset(this.NAME)},getValue:function(){var b=this.value,c=this.options.value;if(b<c.min)b=c.min;if(b>c.max)b=c.max;return b},setValue:function(b){this._oldValue=this.getValue();this.value=b;this._refreshValue();return this},undo:function(){this.undoing=
true;this.setValue(this._oldValue);this.undoing=false;return this},_refreshValue:function(){var b=this.getValue();if(!this.undoing)if(this.element.fire("ui:progressbar:value:changed",{progressBar:this,value:b}).stopped){this.undo();return}b===this.options.value.max?this.valueElement.addClassName("ui-corner-right"):this.valueElement.removeClassName("ui-corner-right");var c="width: #{0}px".interpolate([window.parseInt(this.element.getStyle("width"),10)*b/100]);a.makeVisible(this.valueElement,b>this.options.value.min);
this.valueElement.morph(c,{duration:0.7,transition:"linear"});this.element.writeAttribute("aria-valuenow",b)}});Object.extend(a.ProgressBar,{DEFAULT_OPTIONS:{value:{min:0,max:100,initial:0}}})})(S2.UI);
(function(a){a.Menu=Class.create(a.Base,a.Mixin.Shim,{NAME:"S2.UI.Menu",initialize:function(b){this.element=$(b);if(!this.element)this.element=new Element("ul",{"class":"ui-helper-hidden"});this.activeId=this.element.identify()+"_active";b=this.setOptions();a.addClassNames(this.element,"ui-widget ui-widget-content ui-menu ui-corner-"+b.corner);this.choices=this.element.select("li");this._highlightedIndex=-1;this.element.writeAttribute({role:"menu","aria-activedescendant":this.activeId});this.choices.invoke("writeAttribute",
"role","menuitem");this.observers={mouseover:this._mouseover.bind(this),click:this._click.bind(this)};this.addObservers();this._shown=false;this.createShim()},addObservers:function(){this.element.observe("mouseover",this.observers.mouseover);this.element.observe("mousedown",this.observers.click)},removeObservers:function(){this.element.stopObserving("mouseover",this.observers.mouseover);this.element.stopObserving("mousedown",this.observers.click)},clear:function(){this.element.select("li").invoke("remove");
this.choices=[];return this},addChoice:function(b){var c;if(Object.isElement(b))if(b.tagName.toUpperCase()==="LI")c=b;else{c=new Element("li");c.insert(b)}else{c=new Element("li");c.update(b)}c.addClassName("ui-menu-item");c.writeAttribute("role","menuitem");this.element.insert(c);this.choices=this.element.select("li");return c},_mouseover:function(b){(b=b.findElement("li"))&&this.highlightChoice(b)},_click:function(b){(b=b.findElement("li"))&&this.selectChoice(b)},moveHighlight:function(b){this._highlightedIndex=
(this._highlightedIndex+b).constrain(-1,this.choices.length-1);this.highlightChoice();return this},highlightChoice:function(b){var c=this.choices;b=Object.isElement(b)?c.indexOf(b):Object.isNumber(b)?b:this._highlightedIndex;a.removeClassNames(this.choices,"ui-state-active");if(b!==-1){this.choices[b].addClassName("ui-state-active");this._highlightedIndex=b;(c=this.element.down("#"+this.activeId))&&c.writeAttribute("id","");this.choices[b].writeAttribute("id",this.activeId)}},selectChoice:function(b){if(Object.isNumber(b))b=
this.choices[b];else b||(b=this.choices[this._highlightedIndex]);this.element.fire("ui:menu:selected",{instance:this,element:b}).stopped||this.close();return this},open:function(){this.element.fire("ui:menu:opened",{instance:this});this.element.removeClassName("ui-helper-hidden");this._highlightedIndex=-1;Prototype.Browser.IE&&this.adjustShim()},close:function(){this.element.fire("ui:menu:closed",{instance:this});this.element.addClassName("ui-helper-hidden");return this},isOpen:function(){return!this.element.hasClassName("ui-helper-hidden")}});
Object.extend(a.Menu,{DEFAULT_OPTIONS:{corner:"all"}})})(S2.UI);
(function(a){a.Autocompleter=Class.create(a.Base,{NAME:"S2.UI.Autocompleter",initialize:function(b,c){this.element=$(b);b=this.setOptions(c);a.addClassNames(this.element,"ui-widget ui-autocompleter");this.input=this.element.down('input[type="text"]');if(!this.input){this.input=new Element("input",{type:"text"});this.element.insert(this.input)}this.input.insert({before:this.button});this.input.setAttribute("autocomplete","off");this.name=b.parameterName||this.input.readAttribute("name");if(b.choices)this.choices=
b.choices.clone();this.menu=new a.Menu;this.element.insert(this.menu.element);(function(){var e=this.input.getLayout();this.menu.element.setStyle({left:e.get("left")+"px",top:e.get("top")+e.get("margin-box-height")+"px"})}).bind(this).defer();this.observers={blur:this._blur.bind(this),keyup:this._keyup.bind(this),keydown:this._keydown.bind(this),selected:this._selected.bind(this)};this.addObservers()},addObservers:function(){this.input.observe("blur",this.observers.blur);this.input.observe("keyup",
this.observers.keyup);this.input.observe("keydown",this.observers.keydown);this.menu.element.observe("ui:menu:selected",this.observers.selected)},_schedule:function(){this._unschedule();this._timeout=this._change.bind(this).delay(this.options.frequency)},_unschedule:function(){this._timeout&&window.clearTimeout(this._timeout)},_keyup:function(){var b=this.input.getValue();if(b){if(b.blank()||b.length<this.options.minCharacters){this.menu.close();this._unschedule();return}b!==this._value&&this._schedule()}else{this.menu.close();
this._unschedule()}this._value=b},_keydown:function(b){if(!a.modifierUsed(b))if(this.menu.isOpen())switch(b.keyCode){case Event.KEY_UP:this.menu.moveHighlight(-1);b.stop();break;case Event.KEY_DOWN:this.menu.moveHighlight(1);b.stop();break;case Event.KEY_TAB:this.menu.selectChoice();break;case Event.KEY_RETURN:this.menu.selectChoice();this.input.blur();b.stop();break;case Event.KEY_ESC:this.input.setValue("");this.input.blur();break}},_getInput:function(){return this.input.getValue()},_setInput:function(b){this.input.setValue(b)},
_change:function(){this.findChoices()},findChoices:function(){var b=this._getInput();this.setChoices((this.choices||[]).inject([],function(c,e){e.toLowerCase().include(b.toLowerCase())&&c.push(e);return c}))},setChoices:function(b){this.results=b;this._updateMenu(b)},_updateMenu:function(b){var c=this.options;this.menu.clear();for(var e=new RegExp(RegExp.escape(this._value),"i"),g=0,j,n,q;j=b[g];g++){q=c.highlightSubstring?j.replace(e,"<b>$&</b>"):q;n=(new Element("li")).update(q);n.store("ui.autocompleter.value",
j);this.menu.addChoice(n)}b.length===0?this.menu.close():this.menu.open()},_moveMenuChoice:function(b){this.list.down("li");this._selectedIndex=(this._selectedIndex+b).constrain(-1,this.results.length-1);this._highlightMenuChoice()},_highlightMenuChoice:function(b){var c=this.list.select("li");b=Object.isElement(b)?c.indexOf(b):Object.isNumber(b)?b:this._selectedIndex;a.removeClassNames(c,"ui-state-active");if(!(b===-1||b===null)){c[b].addClassName("ui-state-active");this._selectedIndex=b}},_selected:function(b){(b=
b.memo.element)&&this._setInput(b.retrieve("ui.autocompleter.value"));this.menu.close()},_blur:function(){this._unschedule();this.menu.close()}});Object.extend(a.Autocompleter,{DEFAULT_OPTIONS:{tokens:[],frequency:0.4,minCharacters:1,highlightSubstring:true,onShow:Prototype.K,onHide:Prototype.K}})})(S2.UI);
document.observe("dom:loaded",function(){function a(C){C._rotation=C._rotation||0;C._scale=C._scale||1;C._panX=C._panX||0;C._panY=C._panY||0;C._pans=[[0,0],[0,0],[0,0]];C._panidx=1}function b(C,i,r,y,A){C._rotation=i;C._scale=r;C._panX=y;C._panY=A}function c(C,i){C.fire("manipulate:update",Object.extend(i,{id:q}))}function e(){function C(p){for(var h=p.length;h--;)A[p[h].identifier]=p[h];p=[];for(k in A)p.push(k);p=p.sort();if((i=(u=p.length>0?p[0]:null)?A[u].target:null)&&i.nodeType==3)i=i.parentNode;
z=p.length>1?p[1]:null;if(d==0&&u&&z){m=(A[u].pageX-A[z].pageX).abs();w=(A[u].pageY-A[z].pageY).abs();i&&a(i);o=Math.sqrt(m*m+w*w);s=Math.atan2(A[z].pageY-A[u].pageY,A[z].pageX-A[u].pageX);d=1}else if(d==1&&!(u&&z)){i&&b(i,r,y);d=0}}var i,r,y,A={},u=null,z=null,d=0,f,l,m,w,o,s;n.observe("touchstart",function(p){var h=u;C(p.changedTouches);if(h==null&&u){h=i.viewportOffset();f=h.left+(A[u].pageX-h.left);l=h.top+(A[u].pageY-h.top)}p.stop()});n.observe("touchmove",function(p){C(p.changedTouches);if(u&&
!z){c(i,{panX:(i._panX||0)+A[u].pageX-f,panY:(i._panY||0)+A[u].pageY-l,scale:i._scale,rotation:i._rotation});p.stop()}else if(u&&z){var h=A[z].pageX-A[u].pageX,v=A[z].pageY-A[u].pageY,E=(i._panX||0)+A[z].pageX-h/2-f,L=(i._panY||0)+A[z].pageY-v/2-l,I=Math.sqrt(h*h+v*v);y=i._scale*I/o;r=i._rotation+Math.atan2(v,h)-s;c(i,{rotation:r,scale:y,panX:E,panY:L});p.stop()}});["touchcancel","touchend"].each(function(p){n.observe(p,function(h){for(var v=h.changedTouches.length;v--;)delete A[h.changedTouches[v].identifier];
C([]);i&&b(i,r,y)})})}function g(){var C,i,r,y,A,u=false;n.observe("manipulatestart",function(z){z.stop();C=z.element();a(C);u=true});n.observe("manipulatemove",function(z){C=z.element();i=C._rotation+z.rotation;r=C._scale*z.scale;y=C._panX+z.panX;A=C._panY+z.panY;c(C,{rotation:i,scale:r,panX:y,panY:A,clientX:z.clientX,clientY:z.clientY});z.stop()},false);n.observe("manipulateend",function(z){(C=z.element())&&b(C,i,r,y,A);u=false;var d=Math.sqrt(z.panSpeedX*z.panSpeedX+z.panSpeedY*z.panSpeedY);d>
25&&C.fire("manipulate:flick",{speed:d,direction:Math.atan2(z.panSpeedY,z.panSpeedX)})});n.observe("mousemove",function(z){z.stop()});n.observe("mousedown",function(z){z.stop()});n.observe("mouseup",function(z){z.stop()})}function j(){function C(p){var h=u.viewportOffset(),v=p.pageX-h.left-r;p=p.pageY-h.top-y;s=Math.sqrt(v*v+p*p);o=u._scale*s/d;w=u._rotation+Math.atan2(p,v)-f;return{rotation:w,scale:o,panX:u._panX,panY:u._panY}}function i(p){return{rotation:u._rotation,scale:u._scale,panX:u._panX+
p.pageX-l,panY:u._panY+p.pageY-m}}var r,y,A=false,u,z,d,f,l,m,w,o,s;n.observe("mousedown",function(p){z=p.shiftKey?"scale":"pan";if((u=p.element())&&u.fire){q++;A=true;a(u);var h=u.viewportOffset();r=u.offsetWidth/2;y=u.offsetHeight/2;var v=p.pageX-h.left-r,E=p.pageY-h.top-y;d=Math.sqrt(v*v+E*E);f=Math.atan2(E,v);l=h.left+(p.pageX-h.left);m=h.top+(p.pageY-h.top);p.stop()}});n.observe("mousemove",function(p){if(A)c(u,z=="scale"?C(p):i(p))});n.observe("mouseup",function(p){if(A){A=false;if(z=="scale"){p=
C(p);c(u,p);u._rotation=p.rotation;u._scale=p.scale}else{c(u,i(p));u._panX=u._panX+p.pageX-l;u._panY=u._panY+p.pageY-m}}});n.observe("dragstart",function(p){p.stop()})}if(S2.enableMultitouchSupport){var n=$(document.body),q=0;if(navigator.userAgent.match(/SLBrowser/))return g();if(navigator.userAgent.match(/QtLauncher/))return g();if(navigator.userAgent.match(/Starlight/))return g();try{document.createEvent("ManipulateEvent");return g()}catch(x){}try{document.createEvent("TouchEvent");return e()}catch(F){}return j()}});
Element.__scrollTo=Element.scrollTo;Element.addMethods({scrollTo:function(a,b,c){if(arguments.length==1)return Element.__scrollTo(a);(new S2.FX.Scroll(a,Object.extend(c||{},{to:b}))).play();return a}});
Element.addMethods({effect:function(a,b,c){if(Object.isFunction(b))b=new b(a,c);else if(Object.isString(b))b=new (S2.FX[b.capitalize()])(a,c);b.play(a,c);return a},morph:function(a,b,c){c=S2.FX.parseOptions(c);if(!c.queue){c.queue=a.retrieve("S2.FX.Queue");if(!c.queue)a.store("S2.FX.Queue",c.queue=new S2.FX.Queue)}if(!c.position)c.position="end";return a.effect("morph",Object.extend(c,{style:b}))}.optionize(),appear:function(a,b){return a.effect("morph",Object.extend({before:function(){a.show().setStyle({opacity:0})},
style:"opacity:1"},b))},fade:function(a,b){return a.effect("morph",Object.extend({style:"opacity:0",after:a.hide.bind(a)},b))},cloneWithoutIDs:function(a){a=$(a);a=a.cloneNode(true);a.id="";$(a).select("*[id]").each(function(b){b.id=""});return a}});
(function(){Element.addMethods({transform:window.CSSMatrix?function(a,b){a.style.transform="scale("+(b.scale||1)+") rotate("+(b.rotation||0)+"rad)";return a}:window.WebKitCSSMatrix?function(a,b){a.style.webkitTransform="scale("+(b.scale||1)+") rotate("+(b.rotation||0)+"rad)";return a}:Prototype.Browser.Gecko?function(a,b){a.style.MozTransform="scale("+(b.scale||1)+") rotate("+(b.rotation||0)+"rad)";return a}:Prototype.Browser.IE?function(a,b){if(!a._oDims)a._oDims=[a.offsetWidth,a.offsetHeight];var c=
Math.cos(b.rotation||0)*1;b=Math.sin(b.rotation||0)*1;a.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',M11="+c+",M12="+-b+",M21="+b+",M22="+c+")";a.style.marginLeft=(a._oDims[0]-a.offsetWidth)/2+"px";a.style.marginTop=(a._oDims[1]-a.offsetHeight)/2+"px";return a}:function(a){return a}})})();
S2.viewportOverlay=function(){var a=document.viewport.getDimensions(),b=document.viewport.getScrollOffsets();return(new Element("div")).setStyle({position:"absolute",left:b.left+"px",top:b.top+"px",width:a.width+"px",height:a.height+"px"})};S2.FX.Helpers={fitIntoRectangle:function(a,b,c,e){return a/b<c/e?[(c-a*(e/b))/2,0,a*(e/b),e]:[0,(e-b*(c/a))/2,c,b*(c/a)]}};
S2.FX.Operators.Zoom=Class.create(S2.FX.Operators.Style,{initialize:function($super,b,c,e){var g=document.viewport.getDimensions(),j=document.viewport.getScrollOffsets(),n=c.getDimensions();g=S2.FX.Helpers.fitIntoRectangle(n.width,n.height,g.width-(e.borderWidth||0)*2,g.height-(e.borderWidth||0)*2);Object.extend(e,{style:{left:g[0]+(e.borderWidth||0)+j.left+"px",top:g[1]+(e.borderWidth||0)+j.top+"px",width:g[2]+"px",height:g[3]+"px"}});$super(b,c,e)}});
S2.FX.Zoom=Class.create(S2.FX.Element,{setup:function(){this.clone=this.element.cloneWithoutIDs();this.element.insert({before:this.clone});this.clone.absolutize().setStyle({zIndex:9999});this.overlay=S2.viewportOverlay();this.options.overlayClassName?this.overlay.addClassName(this.options.overlayClassName):this.overlay.setStyle({backgroundColor:"#000",opacity:"0.9"});$$("body")[0].insert(this.overlay);this.animate("zoom",this.clone,{borderWidth:this.options.borderWidth,propertyTransitions:this.options.propertyTransitions||
{}})},teardown:function(){this.clone.observe("click",function(){this.overlay.remove();this.clone.morph("opacity:0",{duration:0.2,after:function(){this.clone.remove()}.bind(this)})}.bind(this))}});var MySublimeVideo=MySublimeVideo||{};
document.observe("dom:loaded",function(){S2.Extensions.webkitCSSTransitions=true;$$("input[type=password]").each(function(a,b){new PasswordFieldManager(a,b)});supportsHtml5InputAttribute("placeholder")||$$("input[placeholder]").each(function(a){new PlaceholderManager(a)});$$("form").each(function(a){new FormManager(a)});$$("#flash .notice").each(function(a){MySublimeVideo.hideFlashNoticeDelayed(a)});if($("new_site"))MySublimeVideo.addSiteHandler=new AddSiteHandler;if($("sites"))MySublimeVideo.sitesPoller=
new SitesPoller});MySublimeVideo.flashNotice=function(a){var b=$("flash");b&&b.remove();a=(new Element("div",{className:"notice"})).update(a);b=(new Element("div",{id:"flash"})).insert(a);$("content").insert({top:b});MySublimeVideo.hideFlashNoticeDelayed(a)};MySublimeVideo.hideFlashNoticeDelayed=function(a){setTimeout(function(){a.morph("top:-35px",{duration:0.7})},4E3)};
MySublimeVideo.openPopup=function(a,b,c){MySublimeVideo.closePopup();a=(new Element("div",{id:b+"_"+a,className:"popup loading"})).update("<div class='wrap'><div class='content'></div></div>");b=(new Element("a",{href:"",className:"close",onclick:"return MySublimeVideo.closePopup()"})).update("<span>Close</span>");a.insert({bottom:b});$("global").insert({after:a});new Ajax.Request(c,{method:"get"})};MySublimeVideo.closePopup=function(){$$(".popup").each(function(a){a.remove()});return false};
MySublimeVideo.makeSticky=function(a){$$("#header .active").each(function(b){b.removeClassName("active")});a.addClassName("active")};MySublimeVideo.makeRemoteLinkSticky=function(a){a.up().select("a.active[data-remote]").each(function(b){b.removeClassName("active")});a.addClassName("active")};MySublimeVideo.showTableSpinner=function(){$("table_spinner").show()};MySublimeVideo.showVideoEmbedCode=function(a){MySublimeVideo.openPopup(a,"embed_code_video","/videos/"+a);return false};
MySublimeVideo.showSiteEmbedCode=function(a){MySublimeVideo.openPopup(a,"embed_code_site","/sites/"+a);return false};MySublimeVideo.showSiteSettings=function(a){MySublimeVideo.openPopup(a,"settings","/sites/"+a+"/edit");return false};
var AddSiteHandler=Class.create({initialize:function(){this.setup()},setup:function(){this.element=$("new_site");this.beforeAjaxHandler=this.element.on("ajax:before",function(){this.numberOfRequestsUntilSpinnerHides=1;this.element.next(".spinner").show();this.beforeAjaxHandler.stop()}.bind(this))},reloadAfterAjax:function(){this.hideSpinner();this.setup();supportsHtml5InputAttribute("placeholder")||new PlaceholderManager(this.element.down("input[placeholder]"));new FormManager(this.element)},hideSpinner:function(){this.numberOfRequestsUntilSpinnerHides-=
1;this.numberOfRequestsUntilSpinnerHides==0&&$("new_site_wrap").down(".spinner").hide()}}),FormManager=Class.create({initialize:function(a){a.on("submit",function(){supportsHtml5InputAttribute("placeholder")||a.select("input.placeholder").each(function(b){b.value=""})});a.select("input[type=submit]").each(function(b){b.on("click",function(){a.select("input").each(function(c){if(c.validity)c.validity.valid?c.removeClassName("errors"):c.addClassName("errors")})})})}}),PasswordFieldManager=Class.create({initialize:function(a,
b){this.field=a;this.field.store("passwordFieldManager",this);if(this.field.hasClassName("show_password")){a=new Element("div",{className:"checkbox_wrap"});var c=(new Element("label",{"for":"show_password_"+b})).update("Show password");this.showPasswordCheckbox=new Element("input",{type:"checkbox",id:"show_password_"+b});a.insert(this.showPasswordCheckbox).insert(c);(b=this.field.up().select(".inline_errors").first())?b.insert({after:a}):this.field.insert({after:a});this.showPasswordCheckbox.on("click",
this.toggleShowPassword.bind(this));this.showPasswordCheckbox.checked=false}},isShowingPassword:function(){return this.showPasswordCheckbox?this.showPasswordCheckbox.checked:false},toggleShowPassword:function(){var a=this.field.retrieve("placeholderManager");if(a){if(this.field.value!=this.field.readAttribute("placeholder")){this.replacePasswordField(this.field,this.isShowingPassword());a.passwordFieldDidUpdate(this.field)}}else this.replacePasswordField(this.field,this.isShowingPassword())},replacePasswordField:function(a,
b){b=new Element("input",{id:a.id,name:a.name,value:a.value,size:a.size,placeholder:a.readAttribute("placeholder"),required:a.readAttribute("required"),className:a.className,type:b?"text":"password"});a.purge();a.replace(b);return this.field=b}}),PlaceholderManager=Class.create({initialize:function(a){this.field=a;this.passwordFieldManager=this.field.retrieve("passwordFieldManager");if(this.field.value==this.field.readAttribute("placeholder")){this.field.value="";this.field.removeClassName("placeholder")}this.setupObservers();
this.resetField()},setupObservers:function(){this.field.store("placeholderManager",this);this.field.on("focus",this.clearField.bind(this));this.field.on("blur",this.resetField.bind(this))},clearField:function(){if(this.field.value==this.field.readAttribute("placeholder")){this.field.value="";this.field.removeClassName("placeholder");if(this.passwordFieldManager){this.field=this.passwordFieldManager.replacePasswordField(this.field,this.passwordFieldManager.isShowingPassword());this.field.focus();this.setupObservers()}}},
resetField:function(){if(this.field.value==""){this.field.addClassName("placeholder");this.field.value=this.field.readAttribute("placeholder");if(this.passwordFieldManager){this.field=this.passwordFieldManager.replacePasswordField(this.field,true);this.setupObservers()}}},passwordFieldDidUpdate:function(a){this.field=a;this.setupObservers()}}),VideoEmbedCodeUpdater=Class.create({initialize:function(a,b,c){this.embedVideoTextarea=a;this.originalSizes=[];this.originalSizes.width=b;this.originalSizes.height=
c;this.ratio=b/c;this.currentSizes=[];this.currentSizes.width=this.originalSizes.width;this.currentSizes.height=this.originalSizes.height;this.setupObservers()},setupObservers:function(){var a=null;["width","height"].each(function(b){a=$("video_"+b);a.on("keyup",this.updateSizeHandler.bind(this));a.on("blur",this.cleanupSizeHandler.bind(this))}.bind(this))},updateSizeHandler:function(a){this.updateSizesFromInput(a.element())},cleanupSizeHandler:function(a){a=a.element();a.value==""?this.resetSizeFields():
this.cleanupUnallowedChars(a)},updateSizesFromInput:function(a){if(a.value.match(/^\d{0,5}$/)&&this.currentSizes[a.readAttribute("name")]!=a.value){var b=this.oppositeSizeElement(a);this.updateInputValue(b.readAttribute("name"),a.value);this.updateSizeInEmbed(a);this.updateSizeInEmbed(b);this.currentSizes[a.readAttribute("name")]=a.value;this.currentSizes[b.readAttribute("name")]=b.value}},resetSizeFields:function(){var a=null;["width","height"].each(function(b){a=$("video_"+b);$("video_"+b).value=
this.originalSizes[b];this.updateSizeInEmbed($("video_"+b))}.bind(this));this.updateSizesFromInput($("video_width"))},cleanupUnallowedChars:function(a){var b=a.value.gsub(/[^\d]/,"").substring(0,5);if(b=="")this.resetSizeFields();else if(b!=a.value){a.value=b;this.updateSizesFromInput(a)}},oppositeSizeElement:function(a){var b="width";if(a.readAttribute("name")=="width")b="height";return $("video_"+b)},updateInputValue:function(a,b){b=parseInt(b,10);b=isNaN(b)?"":(a=="height"?b/this.ratio:b*this.ratio).round();
$("video_"+a).value=b;this.currentSizes[a]=b},updateSizeInEmbed:function(a){var b=a.readAttribute("name");this.embedVideoTextarea.value=this.embedVideoTextarea.value.replace(new RegExp(b+"='\\d*'"),b+"='"+a.value+"'")},sizes:function(a){["width","height"].each(function(b,c){a.call(b,c)})}}),SitesPoller=Class.create({initialize:function(){this.pollingDelay=3E3;this.checkForSiteInProgress()},checkForSiteInProgress:function(){var a=$$("#sites .in_progress").first();if(a){this.currentSiteId=parseInt(a.up("tr").id.replace("site_",
""),10);this.startPolling()}},startPolling:function(){this.poll&&this.stopPolling();this.poll=setInterval(this.remoteCheckForStateUpdate.bind(this),this.pollingDelay)},stopPolling:function(){clearInterval(this.poll);this.poll=null},remoteCheckForStateUpdate:function(){new Ajax.Request("/sites/"+this.currentSiteId+"/state",{method:"get"})},updateSite:function(a){this.stopPolling();var b=$$("#site_"+a+" .code").first();if(b){var c=(new Element("a",{href:"/sites/"+a,className:"embed_code",onclick:"return MySublimeVideo.showSiteEmbedCode("+
a+")"})).update("Embed code");b.update(c)}if(b=$$("#site_"+a+" .settings").first()){b.removeClassName("disabled");b.writeAttribute("onclick","return MySublimeVideo.showSiteSettings("+a+")")}this.checkForSiteInProgress()}});function supportsHtml5InputOfType(a){var b=document.createElement("input");b.setAttribute("type",a);return b.type!=="text"}function supportsHtml5InputAttribute(a){var b=document.createElement("input");return a in b}function ddd(){console.log.apply(console,arguments)};
