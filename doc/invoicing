every day invoice rake task at 00:01
  
  ✓ billable users
    ✓ billable_on == today
    ✓ billable_on == nil && site.activated_at + trial_days == today
  
  - for each billable users
    - if billable invoice exists
      - calculate overages amount (saved on invoice items)
    - else
      - create first new billable invoice
      - add existing site(s) plan/addons (create invoice items)
    - flag as ready (calculate definitive amount)
    - delay charge
    
    - create next invoice
    - add existing site(s) addons (create invoice items)
    
    - set billable_on += 1.month
    

all plans cycle should be set to the same as the user billing period

delete plan:
  - archived instantly
  - all tied addons are cancelled
  
addon:
  - addon cycle are tied to their plan cycle
  - addons are billed pro-rated by day using the difference between started_on/canceled_on & canceled_at
  
new addon:
- addon cancelled instantly
- new invoice_item created for the next_invoice with:
  - started_on  = nil
  - ended_on    = next_invoice.ended_on
  - canceled_on = Time.now.utc
  
cancel addon:
  - addon cancelled instantly
  - new invoice_item created for the next_invoice with:
    - started_on  = nil
    - ended_on    = next_invoice.ended_on
    - canceled_on = Time.now.utc
    
le cancel est un invoice_item comme un autre, avec juste un canceled_on et un ended_on au lieu de started_on et ended_on