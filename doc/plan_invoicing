V
Every day at midnight:
    - Sites that renew today are updated: pending_plan_started_at (if applicable), pending_plan_cycle_started_at, pending_plan_cycle_ended_at, pending_plan_id (if applicable, taken from next_cycle_plan_id); next_cycle_plan_id is reset (if applicable)
      -> Creation of the site's invoice
    - Charging of all 'open' and 'failed' invoices (grouped by user) with a maximum of 15 attempts per invoice (after that the user is suspended)
      -> When a transaction:
        - succeed: included invoices are updated to 'paid' (and their paid_at is set)
        - fail: included invoices are updated to 'fail' (and their last_failed_at is set)
      -> When an invoice succeed, Site#apply_pending_attributes is called and set plan_started_at (if applicable), plan_cycle_started_at, plan_cycle_ended_at, plan_id (if applicable) from their respective pending_XXX

-------------------------------------------------------------------------

Site creation:
  - plan_id is set, first_paid_plan_started_at is set if plan is a paid plan
  - pending_plan_id is nil
  
On upgrade:
  IF first_paid_plan_started_at is nil OR first_paid_plan_started_at > 14.days.ago (trial duration):
    - plan_id is set, first_paid_plan_started_at is set if not already
  ELSE
    - pending_plan_id is set

On downgrade:
  - next_cycle_plan_id is set
  
plan_cycle_started_at and plan_cycle_ended_at are set after PAYMENT via pending_plan_cycle_started_at and pending_plan_cycle_ended_at
