Every day at midnight:
  Task 1:
    - Sites that renew today are updated (plan_cycle_started_at, plan_cycle_ended_at, new plan_id if applicable and reset next_cycle_plan_id)
      -> Creation of the site's invoice

  Task 2:
    - Charging of all 'open' and 'failed' invoices (grouped by user)
      -> When a transaction:
        - succeed: included invoices are updated to 'paid' (and their paid_at is set)
        - fail: included invoices are updated to 'fail' (and their last_failed_at is set)


Commit message:

Changed the way we set the plan_id:
- if it's an upgrade or a create, set the pending_plan_id
- pend_plan_changes is triggered before save when pending_plan_id changes
- invoices are created after save, and charged right away
